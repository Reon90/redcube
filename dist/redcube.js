(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("redcube", [], factory);
	else if(typeof exports === 'object')
		exports["redcube"] = factory();
	else
		root["redcube"] = factory();
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/redcube.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/events.ts":
/*!***********************!*\
  !*** ./src/events.ts ***!
  \***********************/
/*! exports provided: Events */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Events\", function() { return Events; });\nclass Events {\r\n    constructor(redraw) {\r\n        this.redraw = redraw;\r\n        this.zoomValue = 0;\r\n        document.addEventListener('wheel', this);\r\n        document.addEventListener('mousedown', this);\r\n        document.addEventListener('mousemove', this);\r\n        document.addEventListener('mouseup', this);\r\n        document.addEventListener('keyup', this);\r\n        document.addEventListener('keydown', this);\r\n        addEventListener('resize', this);\r\n    }\r\n    handleEvent(e) {\r\n        switch (e.type) {\r\n            case 'wheel':\r\n                this.zoom(e);\r\n                break;\r\n            case 'mousedown':\r\n                this.onStart(e);\r\n                break;\r\n            case 'mousemove':\r\n                this.onMove(e);\r\n                break;\r\n            case 'mouseup':\r\n                this.onEnd();\r\n                break;\r\n            case 'keyup':\r\n                this.onKeyUp();\r\n                break;\r\n            case 'keydown':\r\n                this.onKeyDown(e);\r\n                break;\r\n            case 'resize':\r\n                this.onResize();\r\n                break;\r\n        }\r\n    }\r\n    onResize() {\r\n        this.redraw('resize');\r\n    }\r\n    onKeyDown(e) {\r\n        if (e.shiftKey || e.ctrlKey) {\r\n            this.isPan = true;\r\n        }\r\n    }\r\n    onKeyUp() {\r\n        this.isPan = false;\r\n    }\r\n    onStart(e) {\r\n        this.x = e.clientX;\r\n        this.y = e.clientY;\r\n        this.isDrag = true;\r\n    }\r\n    onMove(e) {\r\n        if (this.isDrag) {\r\n            if (this.isPan) {\r\n                this.redraw('pan', [this.x, this.y], [e.clientX, e.clientY]);\r\n            }\r\n            else {\r\n                this.redraw('rotate', [this.x, this.y], [e.clientX, e.clientY]);\r\n            }\r\n            this.x = e.clientX;\r\n            this.y = e.clientY;\r\n        }\r\n    }\r\n    onEnd() {\r\n        this.isDrag = false;\r\n    }\r\n    zoom(e) {\r\n        this.zoomValue = Math.min(this.zoomValue + e.deltaY, 1250);\r\n        this.redraw('zoom', Math.pow(1.001, this.zoomValue));\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZXZlbnRzLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVkY3ViZS8uL3NyYy9ldmVudHMudHM/YTYxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBFdmVudHMge1xyXG4gICAgY29uc3RydWN0b3IocmVkcmF3KSB7XHJcbiAgICAgICAgdGhpcy5yZWRyYXcgPSByZWRyYXc7XHJcbiAgICAgICAgdGhpcy56b29tVmFsdWUgPSAwO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgdGhpcyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMpO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMpO1xyXG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMpO1xyXG4gICAgfVxyXG4gICAgaGFuZGxlRXZlbnQoZSkge1xyXG4gICAgICAgIHN3aXRjaCAoZS50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3doZWVsJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuem9vbShlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdtb3VzZWRvd24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5vblN0YXJ0KGUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ21vdXNlbW92ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uTW92ZShlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdtb3VzZXVwJzpcclxuICAgICAgICAgICAgICAgIHRoaXMub25FbmQoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdrZXl1cCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uS2V5VXAoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdrZXlkb3duJzpcclxuICAgICAgICAgICAgICAgIHRoaXMub25LZXlEb3duKGUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3Jlc2l6ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uUmVzaXplKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvblJlc2l6ZSgpIHtcclxuICAgICAgICB0aGlzLnJlZHJhdygncmVzaXplJyk7XHJcbiAgICB9XHJcbiAgICBvbktleURvd24oZSkge1xyXG4gICAgICAgIGlmIChlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSkge1xyXG4gICAgICAgICAgICB0aGlzLmlzUGFuID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvbktleVVwKCkge1xyXG4gICAgICAgIHRoaXMuaXNQYW4gPSBmYWxzZTtcclxuICAgIH1cclxuICAgIG9uU3RhcnQoZSkge1xyXG4gICAgICAgIHRoaXMueCA9IGUuY2xpZW50WDtcclxuICAgICAgICB0aGlzLnkgPSBlLmNsaWVudFk7XHJcbiAgICAgICAgdGhpcy5pc0RyYWcgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgb25Nb3ZlKGUpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0RyYWcpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNQYW4pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVkcmF3KCdwYW4nLCBbdGhpcy54LCB0aGlzLnldLCBbZS5jbGllbnRYLCBlLmNsaWVudFldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVkcmF3KCdyb3RhdGUnLCBbdGhpcy54LCB0aGlzLnldLCBbZS5jbGllbnRYLCBlLmNsaWVudFldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnggPSBlLmNsaWVudFg7XHJcbiAgICAgICAgICAgIHRoaXMueSA9IGUuY2xpZW50WTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvbkVuZCgpIHtcclxuICAgICAgICB0aGlzLmlzRHJhZyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgem9vbShlKSB7XHJcbiAgICAgICAgdGhpcy56b29tVmFsdWUgPSBNYXRoLm1pbih0aGlzLnpvb21WYWx1ZSArIGUuZGVsdGFZLCAxMjUwKTtcclxuICAgICAgICB0aGlzLnJlZHJhdygnem9vbScsIE1hdGgucG93KDEuMDAxLCB0aGlzLnpvb21WYWx1ZSkpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCB7IEV2ZW50cyB9O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/events.ts\n");

/***/ }),

/***/ "./src/fps.ts":
/*!********************!*\
  !*** ./src/fps.ts ***!
  \********************/
/*! exports provided: FPS */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FPS\", function() { return FPS; });\nclass FPS {\r\n    constructor() {\r\n        this.counterEl = document.createElement('div');\r\n        this.counterEl.setAttribute('style', 'position: absolute; top: 0; right: 0; color: #fff; font-size: 30px; background: #000;');\r\n        document.body.appendChild(this.counterEl);\r\n        this.fps = 0;\r\n        this.elapsedTime = 0;\r\n        this.lastTime = 0;\r\n    }\r\n    tick(time) {\r\n        this.fps++;\r\n        this.elapsedTime += (time - this.lastTime);\r\n        this.lastTime = time;\r\n        if (this.elapsedTime >= 1000) {\r\n            this.counterEl.innerHTML = String(this.fps);\r\n            this.fps = 0;\r\n            this.elapsedTime -= 1000;\r\n        }\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZnBzLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVkY3ViZS8uL3NyYy9mcHMudHM/NTc0YiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgRlBTIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuY291bnRlckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMDsgcmlnaHQ6IDA7IGNvbG9yOiAjZmZmOyBmb250LXNpemU6IDMwcHg7IGJhY2tncm91bmQ6ICMwMDA7Jyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmNvdW50ZXJFbCk7XHJcbiAgICAgICAgdGhpcy5mcHMgPSAwO1xyXG4gICAgICAgIHRoaXMuZWxhcHNlZFRpbWUgPSAwO1xyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSAwO1xyXG4gICAgfVxyXG4gICAgdGljayh0aW1lKSB7XHJcbiAgICAgICAgdGhpcy5mcHMrKztcclxuICAgICAgICB0aGlzLmVsYXBzZWRUaW1lICs9ICh0aW1lIC0gdGhpcy5sYXN0VGltZSk7XHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRpbWU7XHJcbiAgICAgICAgaWYgKHRoaXMuZWxhcHNlZFRpbWUgPj0gMTAwMCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvdW50ZXJFbC5pbm5lckhUTUwgPSBTdHJpbmcodGhpcy5mcHMpO1xyXG4gICAgICAgICAgICB0aGlzLmZwcyA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMuZWxhcHNlZFRpbWUgLT0gMTAwMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/fps.ts\n");

/***/ }),

/***/ "./src/matrix.ts":
/*!***********************!*\
  !*** ./src/matrix.ts ***!
  \***********************/
/*! exports provided: Matrix2, Matrix3, Matrix4, Vector2, Vector3, Vector4, Frustum */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Matrix2\", function() { return Matrix2; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Matrix3\", function() { return Matrix3; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Matrix4\", function() { return Matrix4; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Vector2\", function() { return Vector2; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Vector3\", function() { return Vector3; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Vector4\", function() { return Vector4; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Frustum\", function() { return Frustum; });\n/**\r\n * This is a class treating 4x4 matrix.\r\n * This class contains the function that is equivalent to OpenGL matrix stack.\r\n * The matrix after conversion is calculated by multiplying a conversion matrix from the right.\r\n * The matrix is replaced by the calculated result.\r\n */\r\nclass Matrix2 {\r\n    constructor(opt_src) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        if (opt_src && typeof opt_src === 'object' && opt_src.hasOwnProperty('elements')) {\r\n            s = opt_src.elements;\r\n            d = new Float32Array(4);\r\n            for (i = 0; i < 4; ++i) {\r\n                d[i] = s[i];\r\n            }\r\n            this.elements = d;\r\n        }\r\n        else {\r\n            this.elements = new Float32Array([1, 0, 0, 1]);\r\n        }\r\n    }\r\n    set(src) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        s = src;\r\n        d = this.elements;\r\n        if (s === d) {\r\n            return;\r\n        }\r\n        for (i = 0; i < 4; ++i) {\r\n            d[i] = s[i];\r\n        }\r\n        return this;\r\n    }\r\n}\r\n/**\r\n * Constructor of Matrix3\r\n * If opt_src is specified, new matrix is initialized by opt_src.\r\n * Otherwise, new matrix is initialized by identity matrix.\r\n * @param opt_src source matrix(option)\r\n */\r\nclass Matrix3 {\r\n    constructor(opt_src) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        if (opt_src && typeof opt_src === 'object' && opt_src.hasOwnProperty('elements')) {\r\n            s = opt_src.elements;\r\n            d = new Float32Array(9);\r\n            for (i = 0; i < 9; ++i) {\r\n                d[i] = s[i];\r\n            }\r\n            this.elements = d;\r\n        }\r\n        else {\r\n            this.elements = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);\r\n        }\r\n    }\r\n    set(src) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        s = src;\r\n        d = this.elements;\r\n        if (s === d) {\r\n            return;\r\n        }\r\n        for (i = 0; i < 9; ++i) {\r\n            d[i] = s[i];\r\n        }\r\n        return this;\r\n    }\r\n    normalFromMat4(a) {\r\n        const e = this.elements;\r\n        a = a.elements;\r\n        let a00 = a[0];\r\n        let a01 = a[1];\r\n        let a02 = a[2];\r\n        let a03 = a[3];\r\n        let a10 = a[4];\r\n        let a11 = a[5];\r\n        let a12 = a[6];\r\n        let a13 = a[7];\r\n        let a20 = a[8];\r\n        let a21 = a[9];\r\n        let a22 = a[10];\r\n        let a23 = a[11];\r\n        let a30 = a[12];\r\n        let a31 = a[13];\r\n        let a32 = a[14];\r\n        let a33 = a[15];\r\n        let b00 = a00 * a11 - a01 * a10;\r\n        let b01 = a00 * a12 - a02 * a10;\r\n        let b02 = a00 * a13 - a03 * a10;\r\n        let b03 = a01 * a12 - a02 * a11;\r\n        let b04 = a01 * a13 - a03 * a11;\r\n        let b05 = a02 * a13 - a03 * a12;\r\n        let b06 = a20 * a31 - a21 * a30;\r\n        let b07 = a20 * a32 - a22 * a30;\r\n        let b08 = a20 * a33 - a23 * a30;\r\n        let b09 = a21 * a32 - a22 * a31;\r\n        let b10 = a21 * a33 - a23 * a31;\r\n        let b11 = a22 * a33 - a23 * a32;\r\n        let // Calculate the determinant\r\n        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n        if (!det) {\r\n            return null;\r\n        }\r\n        det = 1.0 / det;\r\n        e[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n        e[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n        e[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n        e[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n        e[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n        e[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n        e[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n        e[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n        e[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n        return this;\r\n    }\r\n}\r\n/**\r\n * Constructor of Matrix4\r\n * If opt_src is specified, new matrix is initialized by opt_src.\r\n * Otherwise, new matrix is initialized by identity matrix.\r\n * @param opt_src source matrix(option)\r\n */\r\nclass Matrix4 {\r\n    constructor(opt_src) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        if (opt_src && typeof opt_src === 'object' && opt_src.hasOwnProperty('elements')) {\r\n            s = opt_src.elements;\r\n            d = new Float32Array(16);\r\n            for (i = 0; i < 16; ++i) {\r\n                d[i] = s[i];\r\n            }\r\n            this.elements = d;\r\n        }\r\n        else {\r\n            this.elements = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);\r\n        }\r\n    }\r\n    /**\r\n     * Copy matrix.\r\n     * @param src source matrix\r\n     * @return this\r\n     */\r\n    set(src) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        s = src;\r\n        d = this.elements;\r\n        if (s === d) {\r\n            return;\r\n        }\r\n        for (i = 0; i < 16; ++i) {\r\n            d[i] = s[i];\r\n        }\r\n        return this;\r\n    }\r\n    multiply(matrix) {\r\n        this.concat(matrix);\r\n        return this;\r\n    }\r\n    /**\r\n     * Multiply the matrix from the right.\r\n     * @param other The multiply matrix\r\n     * @return this\r\n     */\r\n    concat({ elements }) {\r\n        let i;\r\n        let e;\r\n        let a;\r\n        let b;\r\n        let ai0;\r\n        let ai1;\r\n        let ai2;\r\n        let ai3;\r\n        // Calculate e = a * b\r\n        e = this.elements;\r\n        a = this.elements;\r\n        b = elements;\r\n        // If e equals b, copy b to temporary matrix.\r\n        if (e === b) {\r\n            b = new Float32Array(16);\r\n            for (i = 0; i < 16; ++i) {\r\n                b[i] = e[i];\r\n            }\r\n        }\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = a[i];\r\n            ai1 = a[i + 4];\r\n            ai2 = a[i + 8];\r\n            ai3 = a[i + 12];\r\n            e[i] = ai0 * b[0] + ai1 * b[1] + ai2 * b[2] + ai3 * b[3];\r\n            e[i + 4] = ai0 * b[4] + ai1 * b[5] + ai2 * b[6] + ai3 * b[7];\r\n            e[i + 8] = ai0 * b[8] + ai1 * b[9] + ai2 * b[10] + ai3 * b[11];\r\n            e[i + 12] = ai0 * b[12] + ai1 * b[13] + ai2 * b[14] + ai3 * b[15];\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Calculate the inverse matrix of specified matrix, and set to this.\r\n     * @param other The source matrix\r\n     * @return this\r\n     */\r\n    setInverseOf({ elements }) {\r\n        let i;\r\n        let s;\r\n        let d;\r\n        let inv;\r\n        let det;\r\n        s = elements;\r\n        d = this.elements;\r\n        inv = new Float32Array(16);\r\n        inv[0] = s[5] * s[10] * s[15] - s[5] * s[11] * s[14] - s[9] * s[6] * s[15]\r\n            + s[9] * s[7] * s[14] + s[13] * s[6] * s[11] - s[13] * s[7] * s[10];\r\n        inv[4] = -s[4] * s[10] * s[15] + s[4] * s[11] * s[14] + s[8] * s[6] * s[15]\r\n            - s[8] * s[7] * s[14] - s[12] * s[6] * s[11] + s[12] * s[7] * s[10];\r\n        inv[8] = s[4] * s[9] * s[15] - s[4] * s[11] * s[13] - s[8] * s[5] * s[15]\r\n            + s[8] * s[7] * s[13] + s[12] * s[5] * s[11] - s[12] * s[7] * s[9];\r\n        inv[12] = -s[4] * s[9] * s[14] + s[4] * s[10] * s[13] + s[8] * s[5] * s[14]\r\n            - s[8] * s[6] * s[13] - s[12] * s[5] * s[10] + s[12] * s[6] * s[9];\r\n        inv[1] = -s[1] * s[10] * s[15] + s[1] * s[11] * s[14] + s[9] * s[2] * s[15]\r\n            - s[9] * s[3] * s[14] - s[13] * s[2] * s[11] + s[13] * s[3] * s[10];\r\n        inv[5] = s[0] * s[10] * s[15] - s[0] * s[11] * s[14] - s[8] * s[2] * s[15]\r\n            + s[8] * s[3] * s[14] + s[12] * s[2] * s[11] - s[12] * s[3] * s[10];\r\n        inv[9] = -s[0] * s[9] * s[15] + s[0] * s[11] * s[13] + s[8] * s[1] * s[15]\r\n            - s[8] * s[3] * s[13] - s[12] * s[1] * s[11] + s[12] * s[3] * s[9];\r\n        inv[13] = s[0] * s[9] * s[14] - s[0] * s[10] * s[13] - s[8] * s[1] * s[14]\r\n            + s[8] * s[2] * s[13] + s[12] * s[1] * s[10] - s[12] * s[2] * s[9];\r\n        inv[2] = s[1] * s[6] * s[15] - s[1] * s[7] * s[14] - s[5] * s[2] * s[15]\r\n            + s[5] * s[3] * s[14] + s[13] * s[2] * s[7] - s[13] * s[3] * s[6];\r\n        inv[6] = -s[0] * s[6] * s[15] + s[0] * s[7] * s[14] + s[4] * s[2] * s[15]\r\n            - s[4] * s[3] * s[14] - s[12] * s[2] * s[7] + s[12] * s[3] * s[6];\r\n        inv[10] = s[0] * s[5] * s[15] - s[0] * s[7] * s[13] - s[4] * s[1] * s[15]\r\n            + s[4] * s[3] * s[13] + s[12] * s[1] * s[7] - s[12] * s[3] * s[5];\r\n        inv[14] = -s[0] * s[5] * s[14] + s[0] * s[6] * s[13] + s[4] * s[1] * s[14]\r\n            - s[4] * s[2] * s[13] - s[12] * s[1] * s[6] + s[12] * s[2] * s[5];\r\n        inv[3] = -s[1] * s[6] * s[11] + s[1] * s[7] * s[10] + s[5] * s[2] * s[11]\r\n            - s[5] * s[3] * s[10] - s[9] * s[2] * s[7] + s[9] * s[3] * s[6];\r\n        inv[7] = s[0] * s[6] * s[11] - s[0] * s[7] * s[10] - s[4] * s[2] * s[11]\r\n            + s[4] * s[3] * s[10] + s[8] * s[2] * s[7] - s[8] * s[3] * s[6];\r\n        inv[11] = -s[0] * s[5] * s[11] + s[0] * s[7] * s[9] + s[4] * s[1] * s[11]\r\n            - s[4] * s[3] * s[9] - s[8] * s[1] * s[7] + s[8] * s[3] * s[5];\r\n        inv[15] = s[0] * s[5] * s[10] - s[0] * s[6] * s[9] - s[4] * s[1] * s[10]\r\n            + s[4] * s[2] * s[9] + s[8] * s[1] * s[6] - s[8] * s[2] * s[5];\r\n        det = s[0] * inv[0] + s[1] * inv[4] + s[2] * inv[8] + s[3] * inv[12];\r\n        if (det === 0) {\r\n            return this;\r\n        }\r\n        det = 1 / det;\r\n        for (i = 0; i < 16; i++) {\r\n            d[i] = inv[i] * det;\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Calculate the inverse matrix of this, and set to this.\r\n     * @return this\r\n     */\r\n    invert() {\r\n        return this.setInverseOf(this);\r\n    }\r\n    /**\r\n     * Set the orthographic projection matrix.\r\n     * @param left The coordinate of the left of clipping plane.\r\n     * @param right The coordinate of the right of clipping plane.\r\n     * @param bottom The coordinate of the bottom of clipping plane.\r\n     * @param top The coordinate of the top top clipping plane.\r\n     * @param near The distances to the nearer depth clipping plane. This value is minus if the plane is to be behind the viewer.\r\n     * @param far The distances to the farther depth clipping plane. This value is minus if the plane is to be behind the viewer.\r\n     * @return this\r\n     */\r\n    setOrtho(r, t, near, far) {\r\n        let e;\r\n        let rw;\r\n        let rh;\r\n        let rd;\r\n        rw = 1 / r;\r\n        rh = 1 / t;\r\n        rd = 2 / (near - far);\r\n        e = this.elements;\r\n        e[0] = rw;\r\n        e[1] = 0;\r\n        e[2] = 0;\r\n        e[3] = 0;\r\n        e[4] = 0;\r\n        e[5] = rh;\r\n        e[6] = 0;\r\n        e[7] = 0;\r\n        e[8] = 0;\r\n        e[9] = 0;\r\n        e[10] = rd;\r\n        e[11] = (far + near) / (near - far);\r\n        e[12] = 0;\r\n        e[13] = 0;\r\n        e[14] = 0;\r\n        e[15] = 1;\r\n        return this;\r\n    }\r\n    /**\r\n     * Set the perspective projection matrix by fovy and aspect.\r\n     * @param fovy The angle between the upper and lower sides of the frustum.\r\n     * @param aspect The aspect ratio of the frustum. (width/height)\r\n     * @param near The distances to the nearer depth clipping plane. This value must be plus value.\r\n     * @param far The distances to the farther depth clipping plane. This value must be plus value.\r\n     * @return this\r\n     */\r\n    setPerspective(fovy, aspect, near, far) {\r\n        let e;\r\n        let rd;\r\n        let s;\r\n        let ct;\r\n        if (near === far || aspect === 0) {\r\n            throw 'null frustum';\r\n        }\r\n        if (near <= 0) {\r\n            throw 'near <= 0';\r\n        }\r\n        if (far <= 0) {\r\n            throw 'far <= 0';\r\n        }\r\n        fovy = Math.PI * fovy / 180 / 2;\r\n        s = Math.sin(fovy);\r\n        if (s === 0) {\r\n            throw 'null frustum';\r\n        }\r\n        rd = 1 / (far - near);\r\n        ct = Math.cos(fovy) / s;\r\n        e = this.elements;\r\n        e[0] = ct / aspect;\r\n        e[1] = 0;\r\n        e[2] = 0;\r\n        e[3] = 0;\r\n        e[4] = 0;\r\n        e[5] = ct;\r\n        e[6] = 0;\r\n        e[7] = 0;\r\n        e[8] = 0;\r\n        e[9] = 0;\r\n        e[10] = -(far + near) * rd;\r\n        e[11] = -1;\r\n        e[12] = 0;\r\n        e[13] = 0;\r\n        e[14] = -2 * near * far * rd;\r\n        e[15] = 0;\r\n        return this;\r\n    }\r\n    /**\r\n     * Multiply the perspective projection matrix from the right.\r\n     * @param fovy The angle between the upper and lower sides of the frustum.\r\n     * @param aspect The aspect ratio of the frustum. (width/height)\r\n     * @param near The distances to the nearer depth clipping plane. This value must be plus value.\r\n     * @param far The distances to the farther depth clipping plane. This value must be plus value.\r\n     * @return this\r\n     */\r\n    perspective(fovy, aspect, near, far) {\r\n        return this.concat(new Matrix4().setPerspective(fovy, aspect, near, far));\r\n    }\r\n    /**\r\n     * Multiply the four-dimensional vector.\r\n     * @param pos  The multiply vector\r\n     * @return The result of multiplication(Float32Array)\r\n     */\r\n    multiplyVector4({ elements }) {\r\n        const e = this.elements;\r\n        const p = elements;\r\n        const v = new Vector4();\r\n        const result = v.elements;\r\n        result[0] = p[0] * e[0] + p[1] * e[4] + p[2] * e[8] + p[3] * e[12];\r\n        result[1] = p[0] * e[1] + p[1] * e[5] + p[2] * e[9] + p[3] * e[13];\r\n        result[2] = p[0] * e[2] + p[1] * e[6] + p[2] * e[10] + p[3] * e[14];\r\n        result[3] = p[0] * e[3] + p[1] * e[7] + p[2] * e[11] + p[3] * e[15];\r\n        return v;\r\n    }\r\n    scale(vec3) {\r\n        const x = vec3.elements[0];\r\n        const y = vec3.elements[1];\r\n        const z = vec3.elements[2];\r\n        const e = this.elements;\r\n        e[0] *= x;\r\n        e[4] *= y;\r\n        e[8] *= z;\r\n        e[1] *= x;\r\n        e[5] *= y;\r\n        e[9] *= z;\r\n        e[2] *= x;\r\n        e[6] *= y;\r\n        e[10] *= z;\r\n        e[3] *= x;\r\n        e[7] *= y;\r\n        e[11] *= z;\r\n        return this;\r\n    }\r\n    setTranslate(vec3) {\r\n        const e = this.elements;\r\n        const x = vec3.elements[0];\r\n        const y = vec3.elements[1];\r\n        const z = vec3.elements[2];\r\n        e[12] = x;\r\n        e[13] = y;\r\n        e[14] = z;\r\n        e[15] = 1;\r\n        return this;\r\n    }\r\n    /**\r\n     * Multiply the matrix for translation from the right.\r\n     * @param x The X value of a translation.\r\n     * @param y The Y value of a translation.\r\n     * @param z The Z value of a translation.\r\n     * @return this\r\n     */\r\n    translate(x, y, z) {\r\n        const e = this.elements;\r\n        e[12] += e[0] * x + e[4] * y + e[8] * z;\r\n        e[13] += e[1] * x + e[5] * y + e[9] * z;\r\n        e[14] += e[2] * x + e[6] * y + e[10] * z;\r\n        e[15] += e[3] * x + e[7] * y + e[11] * z;\r\n        return this;\r\n    }\r\n    getMaxScaleOnAxis() {\r\n        const te = this.elements;\r\n        const scaleXSq = te[0] * te[0] + te[1] * te[1] + te[2] * te[2];\r\n        const scaleYSq = te[4] * te[4] + te[5] * te[5] + te[6] * te[6];\r\n        const scaleZSq = te[8] * te[8] + te[9] * te[9] + te[10] * te[10];\r\n        return Math.sqrt(Math.max(scaleXSq, scaleYSq, scaleZSq));\r\n    }\r\n    makeRotationFromQuaternion(q) {\r\n        const te = this.elements;\r\n        let x = q[0];\r\n        let y = q[1];\r\n        let z = q[2];\r\n        let w = q[3];\r\n        let x2 = x + x;\r\n        let y2 = y + y;\r\n        let z2 = z + z;\r\n        let xx = x * x2;\r\n        let xy = x * y2;\r\n        let xz = x * z2;\r\n        let yy = y * y2;\r\n        let yz = y * z2;\r\n        let zz = z * z2;\r\n        let wx = w * x2;\r\n        let wy = w * y2;\r\n        let wz = w * z2;\r\n        te[0] = 1 - (yy + zz);\r\n        te[4] = xy - wz;\r\n        te[8] = xz + wy;\r\n        te[1] = xy + wz;\r\n        te[5] = 1 - (xx + zz);\r\n        te[9] = yz - wx;\r\n        te[2] = xz - wy;\r\n        te[6] = yz + wx;\r\n        te[10] = 1 - (xx + yy);\r\n        return this;\r\n    }\r\n    transpose() {\r\n        let e;\r\n        let t;\r\n        e = this.elements;\r\n        t = e[1];\r\n        e[1] = e[4];\r\n        e[4] = t;\r\n        t = e[2];\r\n        e[2] = e[8];\r\n        e[8] = t;\r\n        t = e[3];\r\n        e[3] = e[12];\r\n        e[12] = t;\r\n        t = e[6];\r\n        e[6] = e[9];\r\n        e[9] = t;\r\n        t = e[7];\r\n        e[7] = e[13];\r\n        e[13] = t;\r\n        t = e[11];\r\n        e[11] = e[14];\r\n        e[14] = t;\r\n        return this;\r\n    }\r\n}\r\n/**\r\n * Constructor of Vector3\r\n * If opt_src is specified, new vector is initialized by opt_src.\r\n * @param opt_src source vector(option)\r\n */\r\nclass Vector3 {\r\n    constructor(opt_src) {\r\n        const v = new Float32Array(3);\r\n        if (opt_src && typeof opt_src === 'object') {\r\n            v[0] = opt_src[0];\r\n            v[1] = opt_src[1];\r\n            v[2] = opt_src[2];\r\n        }\r\n        this.elements = v;\r\n    }\r\n    applyQuaternion({ elements }) {\r\n        const x = this.elements[0];\r\n        const y = this.elements[1];\r\n        const z = this.elements[2];\r\n        const qx = elements[0];\r\n        const qy = elements[1];\r\n        const qz = elements[2];\r\n        const qw = elements[3];\r\n        // calculate quat * vector\r\n        const ix = qw * x + qy * z - qz * y;\r\n        const iy = qw * y + qz * x - qx * z;\r\n        const iz = qw * z + qx * y - qy * x;\r\n        const iw = -qx * x - qy * y - qz * z;\r\n        // calculate result * inverse quat\r\n        this.elements[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n        this.elements[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n        this.elements[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n        return this;\r\n    }\r\n    /**\r\n      * Normalize.\r\n      * @return this\r\n      */\r\n    normalize() {\r\n        const v = this.elements;\r\n        let c = v[0];\r\n        let d = v[1];\r\n        let e = v[2];\r\n        let g = Math.sqrt(c * c + d * d + e * e);\r\n        if (g) {\r\n            if (g == 1) {\r\n                return this;\r\n            }\r\n        }\r\n        else {\r\n            v[0] = 0;\r\n            v[1] = 0;\r\n            v[2] = 0;\r\n            return this;\r\n        }\r\n        g = 1 / g;\r\n        v[0] = c * g;\r\n        v[1] = d * g;\r\n        v[2] = e * g;\r\n        return this;\r\n    }\r\n    /**\r\n         * Scales a vec3 by a scalar number\r\n         *\r\n         * @param {vec3} out the receiving vector\r\n         * @param {vec3} a the vector to scale\r\n         * @param {Number} b amount to scale the vector by\r\n         * @returns {vec3} out\r\n         */\r\n    add(b) {\r\n        const a = this.elements;\r\n        b = b.elements;\r\n        a[0] = a[0] + b[0];\r\n        a[1] = a[1] + b[1];\r\n        a[2] = a[2] + b[2];\r\n        return this;\r\n    }\r\n    addS(b) {\r\n        const a = this.elements;\r\n        a[0] = a[0] + b;\r\n        a[1] = a[1] + b;\r\n        a[2] = a[2] + b;\r\n        return this;\r\n    }\r\n    scale(b) {\r\n        const a = this.elements;\r\n        a[0] = a[0] * b;\r\n        a[1] = a[1] * b;\r\n        a[2] = a[2] * b;\r\n        return this;\r\n    }\r\n    distanceToSquared(x, y, z) {\r\n        let dx = this.elements[0] - x;\r\n        let dy = this.elements[1] - y;\r\n        let dz = this.elements[2] - z;\r\n        return dx * dx + dy * dy + dz * dz;\r\n    }\r\n    subtract(b) {\r\n        const out = this.elements;\r\n        b = b.elements;\r\n        out[0] = out[0] - b[0];\r\n        out[1] = out[1] - b[1];\r\n        out[2] = out[2] - b[2];\r\n        return this;\r\n    }\r\n    divideScalar(scalar) {\r\n        return this.scale(1 / scalar);\r\n    }\r\n    applyMatrix4({ elements }) {\r\n        let x = this.elements[0];\r\n        let y = this.elements[1];\r\n        let z = this.elements[2];\r\n        const e = elements;\r\n        this.elements[0] = e[0] * x + e[4] * y + e[8] * z + e[12];\r\n        this.elements[1] = e[1] * x + e[5] * y + e[9] * z + e[13];\r\n        this.elements[2] = e[2] * x + e[6] * y + e[10] * z + e[14];\r\n        const w = e[3] * x + e[7] * y + e[11] * z + e[15];\r\n        return this.divideScalar(w);\r\n    }\r\n    lerp(a, b, t) {\r\n        const out = this.elements;\r\n        let ax = a[0];\r\n        let ay = a[1];\r\n        let az = a[2];\r\n        out[0] = ax + t * (b[0] - ax);\r\n        out[1] = ay + t * (b[1] - ay);\r\n        out[2] = az + t * (b[2] - az);\r\n        return this;\r\n    }\r\n    lengthSq() {\r\n        return this.elements[0] * this.elements[0] + this.elements[1] * this.elements[1] + this.elements[2] * this.elements[2];\r\n    }\r\n    multiply({ elements }) {\r\n        this.elements[0] *= elements[0];\r\n        this.elements[1] *= elements[1];\r\n        this.elements[2] *= elements[2];\r\n        return this;\r\n    }\r\n    static angle(a, b) {\r\n        const tempA = new Vector3(a.elements);\r\n        const tempB = new Vector3(b.elements);\r\n        tempA.normalize();\r\n        tempB.normalize();\r\n        const cosine = Vector3.dot(tempA, tempB);\r\n        if (cosine > 1.0) {\r\n            return 0;\r\n        }\r\n        else {\r\n            return Math.acos(cosine);\r\n        }\r\n    }\r\n    static cross(a, b) {\r\n        a = a.elements;\r\n        b = b.elements;\r\n        let ax = a[0];\r\n        let ay = a[1];\r\n        let az = a[2];\r\n        let bx = b[0];\r\n        let by = b[1];\r\n        let bz = b[2];\r\n        const out = new Vector3();\r\n        out.elements[0] = ay * bz - az * by;\r\n        out.elements[1] = az * bx - ax * bz;\r\n        out.elements[2] = ax * by - ay * bx;\r\n        return out;\r\n    }\r\n    static dot(a, b) {\r\n        a = a.elements;\r\n        b = b.elements;\r\n        return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n    }\r\n    ;\r\n}\r\n/**\r\n * Constructor of Vector4\r\n * If opt_src is specified, new vector is initialized by opt_src.\r\n * @param opt_src source vector(option)\r\n */\r\nclass Vector4 {\r\n    constructor(opt_src) {\r\n        const v = new Float32Array(4);\r\n        if (opt_src && typeof opt_src === 'object') {\r\n            v[0] = opt_src[0];\r\n            v[1] = opt_src[1];\r\n            v[2] = opt_src[2];\r\n            v[3] = opt_src[3];\r\n        }\r\n        this.elements = v;\r\n    }\r\n    set(e) {\r\n        const a = this.elements;\r\n        a[0] = e[0];\r\n        a[1] = e[1];\r\n        a[2] = e[2];\r\n        a[3] = e[3];\r\n        return this;\r\n    }\r\n    add(b) {\r\n        const a = this.elements;\r\n        b = b.elements;\r\n        a[0] = b[0];\r\n        a[1] = b[1];\r\n        a[2] = b[2];\r\n        a[3] = a[3] + b[3];\r\n        return this;\r\n    }\r\n    normalize() {\r\n        let x = this.elements[0];\r\n        let y = this.elements[1];\r\n        let z = this.elements[2];\r\n        let w = this.elements[3];\r\n        let len = x * x + y * y + z * z + w * w;\r\n        if (len > 0) {\r\n            len = 1 / Math.sqrt(len);\r\n            this.elements[0] = x * len;\r\n            this.elements[1] = y * len;\r\n            this.elements[2] = z * len;\r\n            this.elements[3] = w * len;\r\n        }\r\n        return this;\r\n    }\r\n    setFromRotationMatrix({ elements }) {\r\n        const te = elements;\r\n        const m11 = te[0];\r\n        const m12 = te[4];\r\n        const m13 = te[8];\r\n        const m21 = te[1];\r\n        const m22 = te[5];\r\n        const m23 = te[9];\r\n        const m31 = te[2];\r\n        const m32 = te[6];\r\n        const m33 = te[10];\r\n        const trace = m11 + m22 + m33;\r\n        let s;\r\n        if (trace > 0) {\r\n            s = 0.5 / Math.sqrt(trace + 1.0);\r\n            this.elements[3] = 0.25 / s;\r\n            this.elements[0] = (m32 - m23) * s;\r\n            this.elements[1] = (m13 - m31) * s;\r\n            this.elements[2] = (m21 - m12) * s;\r\n        }\r\n        else if (m11 > m22 && m11 > m33) {\r\n            s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\r\n            this.elements[3] = (m32 - m23) / s;\r\n            this.elements[0] = 0.25 * s;\r\n            this.elements[1] = (m12 + m21) / s;\r\n            this.elements[2] = (m13 + m31) / s;\r\n        }\r\n        else if (m22 > m33) {\r\n            s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\r\n            this.elements[3] = (m13 - m31) / s;\r\n            this.elements[0] = (m12 + m21) / s;\r\n            this.elements[1] = 0.25 * s;\r\n            this.elements[2] = (m23 + m32) / s;\r\n        }\r\n        else {\r\n            s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\r\n            this.elements[3] = (m21 - m12) / s;\r\n            this.elements[0] = (m13 + m31) / s;\r\n            this.elements[1] = (m23 + m32) / s;\r\n            this.elements[2] = 0.25 * s;\r\n        }\r\n        return this;\r\n    }\r\n    lerp(a, b, t) {\r\n        const out = this.elements;\r\n        let ax = a[0];\r\n        let ay = a[1];\r\n        let az = a[2];\r\n        let aw = a[3];\r\n        out[0] = ax + t * (b[0] - ax);\r\n        out[1] = ay + t * (b[1] - ay);\r\n        out[2] = az + t * (b[2] - az);\r\n        out[3] = aw + t * (b[3] - aw);\r\n        return this;\r\n    }\r\n}\r\nclass Vector2 {\r\n    constructor(opt_src) {\r\n        const v = new Float32Array(2);\r\n        if (opt_src && typeof opt_src === 'object') {\r\n            v[0] = opt_src[0];\r\n            v[1] = opt_src[1];\r\n        }\r\n        this.elements = v;\r\n    }\r\n    subtract(b) {\r\n        const out = this.elements;\r\n        b = b.elements;\r\n        out[0] = out[0] - b[0];\r\n        out[1] = out[1] - b[1];\r\n        return this;\r\n    }\r\n    lerp(a, b, t) {\r\n        const out = this.elements;\r\n        let ax = a[0];\r\n        let ay = a[1];\r\n        out[0] = ax + t * (b[0] - ax);\r\n        out[1] = ay + t * (b[1] - ay);\r\n        return this;\r\n    }\r\n}\r\n// { 0: right, 1: left, 2: bottom. 3: top, 4: far, 5: near }\r\nfunction Frustum(m) {\r\n    const planes = [new Vector4, new Vector4, new Vector4, new Vector4, new Vector4, new Vector4];\r\n    const me = m.elements;\r\n    let me0 = me[0], me1 = me[1], me2 = me[2], me3 = me[3];\r\n    let me4 = me[4], me5 = me[5], me6 = me[6], me7 = me[7];\r\n    let me8 = me[8], me9 = me[9], me10 = me[10], me11 = me[11];\r\n    let me12 = me[12], me13 = me[13], me14 = me[14], me15 = me[15];\r\n    planes[0].set([me3 - me0, me7 - me4, me11 - me8, me15 - me12]).normalize();\r\n    planes[1].set([me3 + me0, me7 + me4, me11 + me8, me15 + me12]).normalize();\r\n    planes[2].set([me3 + me1, me7 + me5, me11 + me9, me15 + me13]).normalize();\r\n    planes[3].set([me3 - me1, me7 - me5, me11 - me9, me15 - me13]).normalize();\r\n    planes[4].set([me3 - me2, me7 - me6, me11 - me10, me15 - me14]).normalize();\r\n    planes[5].set([me3 + me2, me7 + me6, me11 + me10, me15 + me14]).normalize();\r\n    return planes;\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbWF0cml4LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVkY3ViZS8uL3NyYy9tYXRyaXgudHM/NDI0MiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVGhpcyBpcyBhIGNsYXNzIHRyZWF0aW5nIDR4NCBtYXRyaXguXHJcbiAqIFRoaXMgY2xhc3MgY29udGFpbnMgdGhlIGZ1bmN0aW9uIHRoYXQgaXMgZXF1aXZhbGVudCB0byBPcGVuR0wgbWF0cml4IHN0YWNrLlxyXG4gKiBUaGUgbWF0cml4IGFmdGVyIGNvbnZlcnNpb24gaXMgY2FsY3VsYXRlZCBieSBtdWx0aXBseWluZyBhIGNvbnZlcnNpb24gbWF0cml4IGZyb20gdGhlIHJpZ2h0LlxyXG4gKiBUaGUgbWF0cml4IGlzIHJlcGxhY2VkIGJ5IHRoZSBjYWxjdWxhdGVkIHJlc3VsdC5cclxuICovXHJcbmNsYXNzIE1hdHJpeDIge1xyXG4gICAgY29uc3RydWN0b3Iob3B0X3NyYykge1xyXG4gICAgICAgIGxldCBpO1xyXG4gICAgICAgIGxldCBzO1xyXG4gICAgICAgIGxldCBkO1xyXG4gICAgICAgIGlmIChvcHRfc3JjICYmIHR5cGVvZiBvcHRfc3JjID09PSAnb2JqZWN0JyAmJiBvcHRfc3JjLmhhc093blByb3BlcnR5KCdlbGVtZW50cycpKSB7XHJcbiAgICAgICAgICAgIHMgPSBvcHRfc3JjLmVsZW1lbnRzO1xyXG4gICAgICAgICAgICBkID0gbmV3IEZsb2F0MzJBcnJheSg0KTtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDQ7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgZFtpXSA9IHNbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50cyA9IGQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzID0gbmV3IEZsb2F0MzJBcnJheShbMSwgMCwgMCwgMV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHNldChzcmMpIHtcclxuICAgICAgICBsZXQgaTtcclxuICAgICAgICBsZXQgcztcclxuICAgICAgICBsZXQgZDtcclxuICAgICAgICBzID0gc3JjO1xyXG4gICAgICAgIGQgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGlmIChzID09PSBkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDQ7ICsraSkge1xyXG4gICAgICAgICAgICBkW2ldID0gc1tpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIENvbnN0cnVjdG9yIG9mIE1hdHJpeDNcclxuICogSWYgb3B0X3NyYyBpcyBzcGVjaWZpZWQsIG5ldyBtYXRyaXggaXMgaW5pdGlhbGl6ZWQgYnkgb3B0X3NyYy5cclxuICogT3RoZXJ3aXNlLCBuZXcgbWF0cml4IGlzIGluaXRpYWxpemVkIGJ5IGlkZW50aXR5IG1hdHJpeC5cclxuICogQHBhcmFtIG9wdF9zcmMgc291cmNlIG1hdHJpeChvcHRpb24pXHJcbiAqL1xyXG5jbGFzcyBNYXRyaXgzIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdF9zcmMpIHtcclxuICAgICAgICBsZXQgaTtcclxuICAgICAgICBsZXQgcztcclxuICAgICAgICBsZXQgZDtcclxuICAgICAgICBpZiAob3B0X3NyYyAmJiB0eXBlb2Ygb3B0X3NyYyA9PT0gJ29iamVjdCcgJiYgb3B0X3NyYy5oYXNPd25Qcm9wZXJ0eSgnZWxlbWVudHMnKSkge1xyXG4gICAgICAgICAgICBzID0gb3B0X3NyYy5lbGVtZW50cztcclxuICAgICAgICAgICAgZCA9IG5ldyBGbG9hdDMyQXJyYXkoOSk7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA5OyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGRbaV0gPSBzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHMgPSBkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50cyA9IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDFdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzZXQoc3JjKSB7XHJcbiAgICAgICAgbGV0IGk7XHJcbiAgICAgICAgbGV0IHM7XHJcbiAgICAgICAgbGV0IGQ7XHJcbiAgICAgICAgcyA9IHNyYztcclxuICAgICAgICBkID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBpZiAocyA9PT0gZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCA5OyArK2kpIHtcclxuICAgICAgICAgICAgZFtpXSA9IHNbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgbm9ybWFsRnJvbU1hdDQoYSkge1xyXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGEgPSBhLmVsZW1lbnRzO1xyXG4gICAgICAgIGxldCBhMDAgPSBhWzBdO1xyXG4gICAgICAgIGxldCBhMDEgPSBhWzFdO1xyXG4gICAgICAgIGxldCBhMDIgPSBhWzJdO1xyXG4gICAgICAgIGxldCBhMDMgPSBhWzNdO1xyXG4gICAgICAgIGxldCBhMTAgPSBhWzRdO1xyXG4gICAgICAgIGxldCBhMTEgPSBhWzVdO1xyXG4gICAgICAgIGxldCBhMTIgPSBhWzZdO1xyXG4gICAgICAgIGxldCBhMTMgPSBhWzddO1xyXG4gICAgICAgIGxldCBhMjAgPSBhWzhdO1xyXG4gICAgICAgIGxldCBhMjEgPSBhWzldO1xyXG4gICAgICAgIGxldCBhMjIgPSBhWzEwXTtcclxuICAgICAgICBsZXQgYTIzID0gYVsxMV07XHJcbiAgICAgICAgbGV0IGEzMCA9IGFbMTJdO1xyXG4gICAgICAgIGxldCBhMzEgPSBhWzEzXTtcclxuICAgICAgICBsZXQgYTMyID0gYVsxNF07XHJcbiAgICAgICAgbGV0IGEzMyA9IGFbMTVdO1xyXG4gICAgICAgIGxldCBiMDAgPSBhMDAgKiBhMTEgLSBhMDEgKiBhMTA7XHJcbiAgICAgICAgbGV0IGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMDtcclxuICAgICAgICBsZXQgYjAyID0gYTAwICogYTEzIC0gYTAzICogYTEwO1xyXG4gICAgICAgIGxldCBiMDMgPSBhMDEgKiBhMTIgLSBhMDIgKiBhMTE7XHJcbiAgICAgICAgbGV0IGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMTtcclxuICAgICAgICBsZXQgYjA1ID0gYTAyICogYTEzIC0gYTAzICogYTEyO1xyXG4gICAgICAgIGxldCBiMDYgPSBhMjAgKiBhMzEgLSBhMjEgKiBhMzA7XHJcbiAgICAgICAgbGV0IGIwNyA9IGEyMCAqIGEzMiAtIGEyMiAqIGEzMDtcclxuICAgICAgICBsZXQgYjA4ID0gYTIwICogYTMzIC0gYTIzICogYTMwO1xyXG4gICAgICAgIGxldCBiMDkgPSBhMjEgKiBhMzIgLSBhMjIgKiBhMzE7XHJcbiAgICAgICAgbGV0IGIxMCA9IGEyMSAqIGEzMyAtIGEyMyAqIGEzMTtcclxuICAgICAgICBsZXQgYjExID0gYTIyICogYTMzIC0gYTIzICogYTMyO1xyXG4gICAgICAgIGxldCAvLyBDYWxjdWxhdGUgdGhlIGRldGVybWluYW50XHJcbiAgICAgICAgZGV0ID0gYjAwICogYjExIC0gYjAxICogYjEwICsgYjAyICogYjA5ICsgYjAzICogYjA4IC0gYjA0ICogYjA3ICsgYjA1ICogYjA2O1xyXG4gICAgICAgIGlmICghZGV0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7XHJcbiAgICAgICAgZVswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0O1xyXG4gICAgICAgIGVbMV0gPSAoYTEyICogYjA4IC0gYTEwICogYjExIC0gYTEzICogYjA3KSAqIGRldDtcclxuICAgICAgICBlWzJdID0gKGExMCAqIGIxMCAtIGExMSAqIGIwOCArIGExMyAqIGIwNikgKiBkZXQ7XHJcbiAgICAgICAgZVszXSA9IChhMDIgKiBiMTAgLSBhMDEgKiBiMTEgLSBhMDMgKiBiMDkpICogZGV0O1xyXG4gICAgICAgIGVbNF0gPSAoYTAwICogYjExIC0gYTAyICogYjA4ICsgYTAzICogYjA3KSAqIGRldDtcclxuICAgICAgICBlWzVdID0gKGEwMSAqIGIwOCAtIGEwMCAqIGIxMCAtIGEwMyAqIGIwNikgKiBkZXQ7XHJcbiAgICAgICAgZVs2XSA9IChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0O1xyXG4gICAgICAgIGVbN10gPSAoYTMyICogYjAyIC0gYTMwICogYjA1IC0gYTMzICogYjAxKSAqIGRldDtcclxuICAgICAgICBlWzhdID0gKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIENvbnN0cnVjdG9yIG9mIE1hdHJpeDRcclxuICogSWYgb3B0X3NyYyBpcyBzcGVjaWZpZWQsIG5ldyBtYXRyaXggaXMgaW5pdGlhbGl6ZWQgYnkgb3B0X3NyYy5cclxuICogT3RoZXJ3aXNlLCBuZXcgbWF0cml4IGlzIGluaXRpYWxpemVkIGJ5IGlkZW50aXR5IG1hdHJpeC5cclxuICogQHBhcmFtIG9wdF9zcmMgc291cmNlIG1hdHJpeChvcHRpb24pXHJcbiAqL1xyXG5jbGFzcyBNYXRyaXg0IHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdF9zcmMpIHtcclxuICAgICAgICBsZXQgaTtcclxuICAgICAgICBsZXQgcztcclxuICAgICAgICBsZXQgZDtcclxuICAgICAgICBpZiAob3B0X3NyYyAmJiB0eXBlb2Ygb3B0X3NyYyA9PT0gJ29iamVjdCcgJiYgb3B0X3NyYy5oYXNPd25Qcm9wZXJ0eSgnZWxlbWVudHMnKSkge1xyXG4gICAgICAgICAgICBzID0gb3B0X3NyYy5lbGVtZW50cztcclxuICAgICAgICAgICAgZCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgZFtpXSA9IHNbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50cyA9IGQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzID0gbmV3IEZsb2F0MzJBcnJheShbMSwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ29weSBtYXRyaXguXHJcbiAgICAgKiBAcGFyYW0gc3JjIHNvdXJjZSBtYXRyaXhcclxuICAgICAqIEByZXR1cm4gdGhpc1xyXG4gICAgICovXHJcbiAgICBzZXQoc3JjKSB7XHJcbiAgICAgICAgbGV0IGk7XHJcbiAgICAgICAgbGV0IHM7XHJcbiAgICAgICAgbGV0IGQ7XHJcbiAgICAgICAgcyA9IHNyYztcclxuICAgICAgICBkID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBpZiAocyA9PT0gZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgKytpKSB7XHJcbiAgICAgICAgICAgIGRbaV0gPSBzW2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIG11bHRpcGx5KG1hdHJpeCkge1xyXG4gICAgICAgIHRoaXMuY29uY2F0KG1hdHJpeCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE11bHRpcGx5IHRoZSBtYXRyaXggZnJvbSB0aGUgcmlnaHQuXHJcbiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIG11bHRpcGx5IG1hdHJpeFxyXG4gICAgICogQHJldHVybiB0aGlzXHJcbiAgICAgKi9cclxuICAgIGNvbmNhdCh7IGVsZW1lbnRzIH0pIHtcclxuICAgICAgICBsZXQgaTtcclxuICAgICAgICBsZXQgZTtcclxuICAgICAgICBsZXQgYTtcclxuICAgICAgICBsZXQgYjtcclxuICAgICAgICBsZXQgYWkwO1xyXG4gICAgICAgIGxldCBhaTE7XHJcbiAgICAgICAgbGV0IGFpMjtcclxuICAgICAgICBsZXQgYWkzO1xyXG4gICAgICAgIC8vIENhbGN1bGF0ZSBlID0gYSAqIGJcclxuICAgICAgICBlID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBhID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBiID0gZWxlbWVudHM7XHJcbiAgICAgICAgLy8gSWYgZSBlcXVhbHMgYiwgY29weSBiIHRvIHRlbXBvcmFyeSBtYXRyaXguXHJcbiAgICAgICAgaWYgKGUgPT09IGIpIHtcclxuICAgICAgICAgICAgYiA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgYltpXSA9IGVbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDQ7IGkrKykge1xyXG4gICAgICAgICAgICBhaTAgPSBhW2ldO1xyXG4gICAgICAgICAgICBhaTEgPSBhW2kgKyA0XTtcclxuICAgICAgICAgICAgYWkyID0gYVtpICsgOF07XHJcbiAgICAgICAgICAgIGFpMyA9IGFbaSArIDEyXTtcclxuICAgICAgICAgICAgZVtpXSA9IGFpMCAqIGJbMF0gKyBhaTEgKiBiWzFdICsgYWkyICogYlsyXSArIGFpMyAqIGJbM107XHJcbiAgICAgICAgICAgIGVbaSArIDRdID0gYWkwICogYls0XSArIGFpMSAqIGJbNV0gKyBhaTIgKiBiWzZdICsgYWkzICogYls3XTtcclxuICAgICAgICAgICAgZVtpICsgOF0gPSBhaTAgKiBiWzhdICsgYWkxICogYls5XSArIGFpMiAqIGJbMTBdICsgYWkzICogYlsxMV07XHJcbiAgICAgICAgICAgIGVbaSArIDEyXSA9IGFpMCAqIGJbMTJdICsgYWkxICogYlsxM10gKyBhaTIgKiBiWzE0XSArIGFpMyAqIGJbMTVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ2FsY3VsYXRlIHRoZSBpbnZlcnNlIG1hdHJpeCBvZiBzcGVjaWZpZWQgbWF0cml4LCBhbmQgc2V0IHRvIHRoaXMuXHJcbiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNvdXJjZSBtYXRyaXhcclxuICAgICAqIEByZXR1cm4gdGhpc1xyXG4gICAgICovXHJcbiAgICBzZXRJbnZlcnNlT2YoeyBlbGVtZW50cyB9KSB7XHJcbiAgICAgICAgbGV0IGk7XHJcbiAgICAgICAgbGV0IHM7XHJcbiAgICAgICAgbGV0IGQ7XHJcbiAgICAgICAgbGV0IGludjtcclxuICAgICAgICBsZXQgZGV0O1xyXG4gICAgICAgIHMgPSBlbGVtZW50cztcclxuICAgICAgICBkID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBpbnYgPSBuZXcgRmxvYXQzMkFycmF5KDE2KTtcclxuICAgICAgICBpbnZbMF0gPSBzWzVdICogc1sxMF0gKiBzWzE1XSAtIHNbNV0gKiBzWzExXSAqIHNbMTRdIC0gc1s5XSAqIHNbNl0gKiBzWzE1XVxyXG4gICAgICAgICAgICArIHNbOV0gKiBzWzddICogc1sxNF0gKyBzWzEzXSAqIHNbNl0gKiBzWzExXSAtIHNbMTNdICogc1s3XSAqIHNbMTBdO1xyXG4gICAgICAgIGludls0XSA9IC1zWzRdICogc1sxMF0gKiBzWzE1XSArIHNbNF0gKiBzWzExXSAqIHNbMTRdICsgc1s4XSAqIHNbNl0gKiBzWzE1XVxyXG4gICAgICAgICAgICAtIHNbOF0gKiBzWzddICogc1sxNF0gLSBzWzEyXSAqIHNbNl0gKiBzWzExXSArIHNbMTJdICogc1s3XSAqIHNbMTBdO1xyXG4gICAgICAgIGludls4XSA9IHNbNF0gKiBzWzldICogc1sxNV0gLSBzWzRdICogc1sxMV0gKiBzWzEzXSAtIHNbOF0gKiBzWzVdICogc1sxNV1cclxuICAgICAgICAgICAgKyBzWzhdICogc1s3XSAqIHNbMTNdICsgc1sxMl0gKiBzWzVdICogc1sxMV0gLSBzWzEyXSAqIHNbN10gKiBzWzldO1xyXG4gICAgICAgIGludlsxMl0gPSAtc1s0XSAqIHNbOV0gKiBzWzE0XSArIHNbNF0gKiBzWzEwXSAqIHNbMTNdICsgc1s4XSAqIHNbNV0gKiBzWzE0XVxyXG4gICAgICAgICAgICAtIHNbOF0gKiBzWzZdICogc1sxM10gLSBzWzEyXSAqIHNbNV0gKiBzWzEwXSArIHNbMTJdICogc1s2XSAqIHNbOV07XHJcbiAgICAgICAgaW52WzFdID0gLXNbMV0gKiBzWzEwXSAqIHNbMTVdICsgc1sxXSAqIHNbMTFdICogc1sxNF0gKyBzWzldICogc1syXSAqIHNbMTVdXHJcbiAgICAgICAgICAgIC0gc1s5XSAqIHNbM10gKiBzWzE0XSAtIHNbMTNdICogc1syXSAqIHNbMTFdICsgc1sxM10gKiBzWzNdICogc1sxMF07XHJcbiAgICAgICAgaW52WzVdID0gc1swXSAqIHNbMTBdICogc1sxNV0gLSBzWzBdICogc1sxMV0gKiBzWzE0XSAtIHNbOF0gKiBzWzJdICogc1sxNV1cclxuICAgICAgICAgICAgKyBzWzhdICogc1szXSAqIHNbMTRdICsgc1sxMl0gKiBzWzJdICogc1sxMV0gLSBzWzEyXSAqIHNbM10gKiBzWzEwXTtcclxuICAgICAgICBpbnZbOV0gPSAtc1swXSAqIHNbOV0gKiBzWzE1XSArIHNbMF0gKiBzWzExXSAqIHNbMTNdICsgc1s4XSAqIHNbMV0gKiBzWzE1XVxyXG4gICAgICAgICAgICAtIHNbOF0gKiBzWzNdICogc1sxM10gLSBzWzEyXSAqIHNbMV0gKiBzWzExXSArIHNbMTJdICogc1szXSAqIHNbOV07XHJcbiAgICAgICAgaW52WzEzXSA9IHNbMF0gKiBzWzldICogc1sxNF0gLSBzWzBdICogc1sxMF0gKiBzWzEzXSAtIHNbOF0gKiBzWzFdICogc1sxNF1cclxuICAgICAgICAgICAgKyBzWzhdICogc1syXSAqIHNbMTNdICsgc1sxMl0gKiBzWzFdICogc1sxMF0gLSBzWzEyXSAqIHNbMl0gKiBzWzldO1xyXG4gICAgICAgIGludlsyXSA9IHNbMV0gKiBzWzZdICogc1sxNV0gLSBzWzFdICogc1s3XSAqIHNbMTRdIC0gc1s1XSAqIHNbMl0gKiBzWzE1XVxyXG4gICAgICAgICAgICArIHNbNV0gKiBzWzNdICogc1sxNF0gKyBzWzEzXSAqIHNbMl0gKiBzWzddIC0gc1sxM10gKiBzWzNdICogc1s2XTtcclxuICAgICAgICBpbnZbNl0gPSAtc1swXSAqIHNbNl0gKiBzWzE1XSArIHNbMF0gKiBzWzddICogc1sxNF0gKyBzWzRdICogc1syXSAqIHNbMTVdXHJcbiAgICAgICAgICAgIC0gc1s0XSAqIHNbM10gKiBzWzE0XSAtIHNbMTJdICogc1syXSAqIHNbN10gKyBzWzEyXSAqIHNbM10gKiBzWzZdO1xyXG4gICAgICAgIGludlsxMF0gPSBzWzBdICogc1s1XSAqIHNbMTVdIC0gc1swXSAqIHNbN10gKiBzWzEzXSAtIHNbNF0gKiBzWzFdICogc1sxNV1cclxuICAgICAgICAgICAgKyBzWzRdICogc1szXSAqIHNbMTNdICsgc1sxMl0gKiBzWzFdICogc1s3XSAtIHNbMTJdICogc1szXSAqIHNbNV07XHJcbiAgICAgICAgaW52WzE0XSA9IC1zWzBdICogc1s1XSAqIHNbMTRdICsgc1swXSAqIHNbNl0gKiBzWzEzXSArIHNbNF0gKiBzWzFdICogc1sxNF1cclxuICAgICAgICAgICAgLSBzWzRdICogc1syXSAqIHNbMTNdIC0gc1sxMl0gKiBzWzFdICogc1s2XSArIHNbMTJdICogc1syXSAqIHNbNV07XHJcbiAgICAgICAgaW52WzNdID0gLXNbMV0gKiBzWzZdICogc1sxMV0gKyBzWzFdICogc1s3XSAqIHNbMTBdICsgc1s1XSAqIHNbMl0gKiBzWzExXVxyXG4gICAgICAgICAgICAtIHNbNV0gKiBzWzNdICogc1sxMF0gLSBzWzldICogc1syXSAqIHNbN10gKyBzWzldICogc1szXSAqIHNbNl07XHJcbiAgICAgICAgaW52WzddID0gc1swXSAqIHNbNl0gKiBzWzExXSAtIHNbMF0gKiBzWzddICogc1sxMF0gLSBzWzRdICogc1syXSAqIHNbMTFdXHJcbiAgICAgICAgICAgICsgc1s0XSAqIHNbM10gKiBzWzEwXSArIHNbOF0gKiBzWzJdICogc1s3XSAtIHNbOF0gKiBzWzNdICogc1s2XTtcclxuICAgICAgICBpbnZbMTFdID0gLXNbMF0gKiBzWzVdICogc1sxMV0gKyBzWzBdICogc1s3XSAqIHNbOV0gKyBzWzRdICogc1sxXSAqIHNbMTFdXHJcbiAgICAgICAgICAgIC0gc1s0XSAqIHNbM10gKiBzWzldIC0gc1s4XSAqIHNbMV0gKiBzWzddICsgc1s4XSAqIHNbM10gKiBzWzVdO1xyXG4gICAgICAgIGludlsxNV0gPSBzWzBdICogc1s1XSAqIHNbMTBdIC0gc1swXSAqIHNbNl0gKiBzWzldIC0gc1s0XSAqIHNbMV0gKiBzWzEwXVxyXG4gICAgICAgICAgICArIHNbNF0gKiBzWzJdICogc1s5XSArIHNbOF0gKiBzWzFdICogc1s2XSAtIHNbOF0gKiBzWzJdICogc1s1XTtcclxuICAgICAgICBkZXQgPSBzWzBdICogaW52WzBdICsgc1sxXSAqIGludls0XSArIHNbMl0gKiBpbnZbOF0gKyBzWzNdICogaW52WzEyXTtcclxuICAgICAgICBpZiAoZGV0ID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZXQgPSAxIC8gZGV0O1xyXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGRbaV0gPSBpbnZbaV0gKiBkZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxjdWxhdGUgdGhlIGludmVyc2UgbWF0cml4IG9mIHRoaXMsIGFuZCBzZXQgdG8gdGhpcy5cclxuICAgICAqIEByZXR1cm4gdGhpc1xyXG4gICAgICovXHJcbiAgICBpbnZlcnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0SW52ZXJzZU9mKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIG9ydGhvZ3JhcGhpYyBwcm9qZWN0aW9uIG1hdHJpeC5cclxuICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBjb29yZGluYXRlIG9mIHRoZSBsZWZ0IG9mIGNsaXBwaW5nIHBsYW5lLlxyXG4gICAgICogQHBhcmFtIHJpZ2h0IFRoZSBjb29yZGluYXRlIG9mIHRoZSByaWdodCBvZiBjbGlwcGluZyBwbGFuZS5cclxuICAgICAqIEBwYXJhbSBib3R0b20gVGhlIGNvb3JkaW5hdGUgb2YgdGhlIGJvdHRvbSBvZiBjbGlwcGluZyBwbGFuZS5cclxuICAgICAqIEBwYXJhbSB0b3AgVGhlIGNvb3JkaW5hdGUgb2YgdGhlIHRvcCB0b3AgY2xpcHBpbmcgcGxhbmUuXHJcbiAgICAgKiBAcGFyYW0gbmVhciBUaGUgZGlzdGFuY2VzIHRvIHRoZSBuZWFyZXIgZGVwdGggY2xpcHBpbmcgcGxhbmUuIFRoaXMgdmFsdWUgaXMgbWludXMgaWYgdGhlIHBsYW5lIGlzIHRvIGJlIGJlaGluZCB0aGUgdmlld2VyLlxyXG4gICAgICogQHBhcmFtIGZhciBUaGUgZGlzdGFuY2VzIHRvIHRoZSBmYXJ0aGVyIGRlcHRoIGNsaXBwaW5nIHBsYW5lLiBUaGlzIHZhbHVlIGlzIG1pbnVzIGlmIHRoZSBwbGFuZSBpcyB0byBiZSBiZWhpbmQgdGhlIHZpZXdlci5cclxuICAgICAqIEByZXR1cm4gdGhpc1xyXG4gICAgICovXHJcbiAgICBzZXRPcnRobyhyLCB0LCBuZWFyLCBmYXIpIHtcclxuICAgICAgICBsZXQgZTtcclxuICAgICAgICBsZXQgcnc7XHJcbiAgICAgICAgbGV0IHJoO1xyXG4gICAgICAgIGxldCByZDtcclxuICAgICAgICBydyA9IDEgLyByO1xyXG4gICAgICAgIHJoID0gMSAvIHQ7XHJcbiAgICAgICAgcmQgPSAyIC8gKG5lYXIgLSBmYXIpO1xyXG4gICAgICAgIGUgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGVbMF0gPSBydztcclxuICAgICAgICBlWzFdID0gMDtcclxuICAgICAgICBlWzJdID0gMDtcclxuICAgICAgICBlWzNdID0gMDtcclxuICAgICAgICBlWzRdID0gMDtcclxuICAgICAgICBlWzVdID0gcmg7XHJcbiAgICAgICAgZVs2XSA9IDA7XHJcbiAgICAgICAgZVs3XSA9IDA7XHJcbiAgICAgICAgZVs4XSA9IDA7XHJcbiAgICAgICAgZVs5XSA9IDA7XHJcbiAgICAgICAgZVsxMF0gPSByZDtcclxuICAgICAgICBlWzExXSA9IChmYXIgKyBuZWFyKSAvIChuZWFyIC0gZmFyKTtcclxuICAgICAgICBlWzEyXSA9IDA7XHJcbiAgICAgICAgZVsxM10gPSAwO1xyXG4gICAgICAgIGVbMTRdID0gMDtcclxuICAgICAgICBlWzE1XSA9IDE7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgcGVyc3BlY3RpdmUgcHJvamVjdGlvbiBtYXRyaXggYnkgZm92eSBhbmQgYXNwZWN0LlxyXG4gICAgICogQHBhcmFtIGZvdnkgVGhlIGFuZ2xlIGJldHdlZW4gdGhlIHVwcGVyIGFuZCBsb3dlciBzaWRlcyBvZiB0aGUgZnJ1c3R1bS5cclxuICAgICAqIEBwYXJhbSBhc3BlY3QgVGhlIGFzcGVjdCByYXRpbyBvZiB0aGUgZnJ1c3R1bS4gKHdpZHRoL2hlaWdodClcclxuICAgICAqIEBwYXJhbSBuZWFyIFRoZSBkaXN0YW5jZXMgdG8gdGhlIG5lYXJlciBkZXB0aCBjbGlwcGluZyBwbGFuZS4gVGhpcyB2YWx1ZSBtdXN0IGJlIHBsdXMgdmFsdWUuXHJcbiAgICAgKiBAcGFyYW0gZmFyIFRoZSBkaXN0YW5jZXMgdG8gdGhlIGZhcnRoZXIgZGVwdGggY2xpcHBpbmcgcGxhbmUuIFRoaXMgdmFsdWUgbXVzdCBiZSBwbHVzIHZhbHVlLlxyXG4gICAgICogQHJldHVybiB0aGlzXHJcbiAgICAgKi9cclxuICAgIHNldFBlcnNwZWN0aXZlKGZvdnksIGFzcGVjdCwgbmVhciwgZmFyKSB7XHJcbiAgICAgICAgbGV0IGU7XHJcbiAgICAgICAgbGV0IHJkO1xyXG4gICAgICAgIGxldCBzO1xyXG4gICAgICAgIGxldCBjdDtcclxuICAgICAgICBpZiAobmVhciA9PT0gZmFyIHx8IGFzcGVjdCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyAnbnVsbCBmcnVzdHVtJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5lYXIgPD0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyAnbmVhciA8PSAwJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZhciA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93ICdmYXIgPD0gMCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvdnkgPSBNYXRoLlBJICogZm92eSAvIDE4MCAvIDI7XHJcbiAgICAgICAgcyA9IE1hdGguc2luKGZvdnkpO1xyXG4gICAgICAgIGlmIChzID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93ICdudWxsIGZydXN0dW0nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZCA9IDEgLyAoZmFyIC0gbmVhcik7XHJcbiAgICAgICAgY3QgPSBNYXRoLmNvcyhmb3Z5KSAvIHM7XHJcbiAgICAgICAgZSA9IHRoaXMuZWxlbWVudHM7XHJcbiAgICAgICAgZVswXSA9IGN0IC8gYXNwZWN0O1xyXG4gICAgICAgIGVbMV0gPSAwO1xyXG4gICAgICAgIGVbMl0gPSAwO1xyXG4gICAgICAgIGVbM10gPSAwO1xyXG4gICAgICAgIGVbNF0gPSAwO1xyXG4gICAgICAgIGVbNV0gPSBjdDtcclxuICAgICAgICBlWzZdID0gMDtcclxuICAgICAgICBlWzddID0gMDtcclxuICAgICAgICBlWzhdID0gMDtcclxuICAgICAgICBlWzldID0gMDtcclxuICAgICAgICBlWzEwXSA9IC0oZmFyICsgbmVhcikgKiByZDtcclxuICAgICAgICBlWzExXSA9IC0xO1xyXG4gICAgICAgIGVbMTJdID0gMDtcclxuICAgICAgICBlWzEzXSA9IDA7XHJcbiAgICAgICAgZVsxNF0gPSAtMiAqIG5lYXIgKiBmYXIgKiByZDtcclxuICAgICAgICBlWzE1XSA9IDA7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE11bHRpcGx5IHRoZSBwZXJzcGVjdGl2ZSBwcm9qZWN0aW9uIG1hdHJpeCBmcm9tIHRoZSByaWdodC5cclxuICAgICAqIEBwYXJhbSBmb3Z5IFRoZSBhbmdsZSBiZXR3ZWVuIHRoZSB1cHBlciBhbmQgbG93ZXIgc2lkZXMgb2YgdGhlIGZydXN0dW0uXHJcbiAgICAgKiBAcGFyYW0gYXNwZWN0IFRoZSBhc3BlY3QgcmF0aW8gb2YgdGhlIGZydXN0dW0uICh3aWR0aC9oZWlnaHQpXHJcbiAgICAgKiBAcGFyYW0gbmVhciBUaGUgZGlzdGFuY2VzIHRvIHRoZSBuZWFyZXIgZGVwdGggY2xpcHBpbmcgcGxhbmUuIFRoaXMgdmFsdWUgbXVzdCBiZSBwbHVzIHZhbHVlLlxyXG4gICAgICogQHBhcmFtIGZhciBUaGUgZGlzdGFuY2VzIHRvIHRoZSBmYXJ0aGVyIGRlcHRoIGNsaXBwaW5nIHBsYW5lLiBUaGlzIHZhbHVlIG11c3QgYmUgcGx1cyB2YWx1ZS5cclxuICAgICAqIEByZXR1cm4gdGhpc1xyXG4gICAgICovXHJcbiAgICBwZXJzcGVjdGl2ZShmb3Z5LCBhc3BlY3QsIG5lYXIsIGZhcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbmNhdChuZXcgTWF0cml4NCgpLnNldFBlcnNwZWN0aXZlKGZvdnksIGFzcGVjdCwgbmVhciwgZmFyKSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE11bHRpcGx5IHRoZSBmb3VyLWRpbWVuc2lvbmFsIHZlY3Rvci5cclxuICAgICAqIEBwYXJhbSBwb3MgIFRoZSBtdWx0aXBseSB2ZWN0b3JcclxuICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiBtdWx0aXBsaWNhdGlvbihGbG9hdDMyQXJyYXkpXHJcbiAgICAgKi9cclxuICAgIG11bHRpcGx5VmVjdG9yNCh7IGVsZW1lbnRzIH0pIHtcclxuICAgICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBjb25zdCBwID0gZWxlbWVudHM7XHJcbiAgICAgICAgY29uc3QgdiA9IG5ldyBWZWN0b3I0KCk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdi5lbGVtZW50cztcclxuICAgICAgICByZXN1bHRbMF0gPSBwWzBdICogZVswXSArIHBbMV0gKiBlWzRdICsgcFsyXSAqIGVbOF0gKyBwWzNdICogZVsxMl07XHJcbiAgICAgICAgcmVzdWx0WzFdID0gcFswXSAqIGVbMV0gKyBwWzFdICogZVs1XSArIHBbMl0gKiBlWzldICsgcFszXSAqIGVbMTNdO1xyXG4gICAgICAgIHJlc3VsdFsyXSA9IHBbMF0gKiBlWzJdICsgcFsxXSAqIGVbNl0gKyBwWzJdICogZVsxMF0gKyBwWzNdICogZVsxNF07XHJcbiAgICAgICAgcmVzdWx0WzNdID0gcFswXSAqIGVbM10gKyBwWzFdICogZVs3XSArIHBbMl0gKiBlWzExXSArIHBbM10gKiBlWzE1XTtcclxuICAgICAgICByZXR1cm4gdjtcclxuICAgIH1cclxuICAgIHNjYWxlKHZlYzMpIHtcclxuICAgICAgICBjb25zdCB4ID0gdmVjMy5lbGVtZW50c1swXTtcclxuICAgICAgICBjb25zdCB5ID0gdmVjMy5lbGVtZW50c1sxXTtcclxuICAgICAgICBjb25zdCB6ID0gdmVjMy5lbGVtZW50c1syXTtcclxuICAgICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBlWzBdICo9IHg7XHJcbiAgICAgICAgZVs0XSAqPSB5O1xyXG4gICAgICAgIGVbOF0gKj0gejtcclxuICAgICAgICBlWzFdICo9IHg7XHJcbiAgICAgICAgZVs1XSAqPSB5O1xyXG4gICAgICAgIGVbOV0gKj0gejtcclxuICAgICAgICBlWzJdICo9IHg7XHJcbiAgICAgICAgZVs2XSAqPSB5O1xyXG4gICAgICAgIGVbMTBdICo9IHo7XHJcbiAgICAgICAgZVszXSAqPSB4O1xyXG4gICAgICAgIGVbN10gKj0geTtcclxuICAgICAgICBlWzExXSAqPSB6O1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2V0VHJhbnNsYXRlKHZlYzMpIHtcclxuICAgICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBjb25zdCB4ID0gdmVjMy5lbGVtZW50c1swXTtcclxuICAgICAgICBjb25zdCB5ID0gdmVjMy5lbGVtZW50c1sxXTtcclxuICAgICAgICBjb25zdCB6ID0gdmVjMy5lbGVtZW50c1syXTtcclxuICAgICAgICBlWzEyXSA9IHg7XHJcbiAgICAgICAgZVsxM10gPSB5O1xyXG4gICAgICAgIGVbMTRdID0gejtcclxuICAgICAgICBlWzE1XSA9IDE7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE11bHRpcGx5IHRoZSBtYXRyaXggZm9yIHRyYW5zbGF0aW9uIGZyb20gdGhlIHJpZ2h0LlxyXG4gICAgICogQHBhcmFtIHggVGhlIFggdmFsdWUgb2YgYSB0cmFuc2xhdGlvbi5cclxuICAgICAqIEBwYXJhbSB5IFRoZSBZIHZhbHVlIG9mIGEgdHJhbnNsYXRpb24uXHJcbiAgICAgKiBAcGFyYW0geiBUaGUgWiB2YWx1ZSBvZiBhIHRyYW5zbGF0aW9uLlxyXG4gICAgICogQHJldHVybiB0aGlzXHJcbiAgICAgKi9cclxuICAgIHRyYW5zbGF0ZSh4LCB5LCB6KSB7XHJcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7XHJcbiAgICAgICAgZVsxMl0gKz0gZVswXSAqIHggKyBlWzRdICogeSArIGVbOF0gKiB6O1xyXG4gICAgICAgIGVbMTNdICs9IGVbMV0gKiB4ICsgZVs1XSAqIHkgKyBlWzldICogejtcclxuICAgICAgICBlWzE0XSArPSBlWzJdICogeCArIGVbNl0gKiB5ICsgZVsxMF0gKiB6O1xyXG4gICAgICAgIGVbMTVdICs9IGVbM10gKiB4ICsgZVs3XSAqIHkgKyBlWzExXSAqIHo7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBnZXRNYXhTY2FsZU9uQXhpcygpIHtcclxuICAgICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7XHJcbiAgICAgICAgY29uc3Qgc2NhbGVYU3EgPSB0ZVswXSAqIHRlWzBdICsgdGVbMV0gKiB0ZVsxXSArIHRlWzJdICogdGVbMl07XHJcbiAgICAgICAgY29uc3Qgc2NhbGVZU3EgPSB0ZVs0XSAqIHRlWzRdICsgdGVbNV0gKiB0ZVs1XSArIHRlWzZdICogdGVbNl07XHJcbiAgICAgICAgY29uc3Qgc2NhbGVaU3EgPSB0ZVs4XSAqIHRlWzhdICsgdGVbOV0gKiB0ZVs5XSArIHRlWzEwXSAqIHRlWzEwXTtcclxuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgubWF4KHNjYWxlWFNxLCBzY2FsZVlTcSwgc2NhbGVaU3EpKTtcclxuICAgIH1cclxuICAgIG1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHEpIHtcclxuICAgICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7XHJcbiAgICAgICAgbGV0IHggPSBxWzBdO1xyXG4gICAgICAgIGxldCB5ID0gcVsxXTtcclxuICAgICAgICBsZXQgeiA9IHFbMl07XHJcbiAgICAgICAgbGV0IHcgPSBxWzNdO1xyXG4gICAgICAgIGxldCB4MiA9IHggKyB4O1xyXG4gICAgICAgIGxldCB5MiA9IHkgKyB5O1xyXG4gICAgICAgIGxldCB6MiA9IHogKyB6O1xyXG4gICAgICAgIGxldCB4eCA9IHggKiB4MjtcclxuICAgICAgICBsZXQgeHkgPSB4ICogeTI7XHJcbiAgICAgICAgbGV0IHh6ID0geCAqIHoyO1xyXG4gICAgICAgIGxldCB5eSA9IHkgKiB5MjtcclxuICAgICAgICBsZXQgeXogPSB5ICogejI7XHJcbiAgICAgICAgbGV0IHp6ID0geiAqIHoyO1xyXG4gICAgICAgIGxldCB3eCA9IHcgKiB4MjtcclxuICAgICAgICBsZXQgd3kgPSB3ICogeTI7XHJcbiAgICAgICAgbGV0IHd6ID0gdyAqIHoyO1xyXG4gICAgICAgIHRlWzBdID0gMSAtICh5eSArIHp6KTtcclxuICAgICAgICB0ZVs0XSA9IHh5IC0gd3o7XHJcbiAgICAgICAgdGVbOF0gPSB4eiArIHd5O1xyXG4gICAgICAgIHRlWzFdID0geHkgKyB3ejtcclxuICAgICAgICB0ZVs1XSA9IDEgLSAoeHggKyB6eik7XHJcbiAgICAgICAgdGVbOV0gPSB5eiAtIHd4O1xyXG4gICAgICAgIHRlWzJdID0geHogLSB3eTtcclxuICAgICAgICB0ZVs2XSA9IHl6ICsgd3g7XHJcbiAgICAgICAgdGVbMTBdID0gMSAtICh4eCArIHl5KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHRyYW5zcG9zZSgpIHtcclxuICAgICAgICBsZXQgZTtcclxuICAgICAgICBsZXQgdDtcclxuICAgICAgICBlID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICB0ID0gZVsxXTtcclxuICAgICAgICBlWzFdID0gZVs0XTtcclxuICAgICAgICBlWzRdID0gdDtcclxuICAgICAgICB0ID0gZVsyXTtcclxuICAgICAgICBlWzJdID0gZVs4XTtcclxuICAgICAgICBlWzhdID0gdDtcclxuICAgICAgICB0ID0gZVszXTtcclxuICAgICAgICBlWzNdID0gZVsxMl07XHJcbiAgICAgICAgZVsxMl0gPSB0O1xyXG4gICAgICAgIHQgPSBlWzZdO1xyXG4gICAgICAgIGVbNl0gPSBlWzldO1xyXG4gICAgICAgIGVbOV0gPSB0O1xyXG4gICAgICAgIHQgPSBlWzddO1xyXG4gICAgICAgIGVbN10gPSBlWzEzXTtcclxuICAgICAgICBlWzEzXSA9IHQ7XHJcbiAgICAgICAgdCA9IGVbMTFdO1xyXG4gICAgICAgIGVbMTFdID0gZVsxNF07XHJcbiAgICAgICAgZVsxNF0gPSB0O1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBDb25zdHJ1Y3RvciBvZiBWZWN0b3IzXHJcbiAqIElmIG9wdF9zcmMgaXMgc3BlY2lmaWVkLCBuZXcgdmVjdG9yIGlzIGluaXRpYWxpemVkIGJ5IG9wdF9zcmMuXHJcbiAqIEBwYXJhbSBvcHRfc3JjIHNvdXJjZSB2ZWN0b3Iob3B0aW9uKVxyXG4gKi9cclxuY2xhc3MgVmVjdG9yMyB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRfc3JjKSB7XHJcbiAgICAgICAgY29uc3QgdiA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7XHJcbiAgICAgICAgaWYgKG9wdF9zcmMgJiYgdHlwZW9mIG9wdF9zcmMgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHZbMF0gPSBvcHRfc3JjWzBdO1xyXG4gICAgICAgICAgICB2WzFdID0gb3B0X3NyY1sxXTtcclxuICAgICAgICAgICAgdlsyXSA9IG9wdF9zcmNbMl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudHMgPSB2O1xyXG4gICAgfVxyXG4gICAgYXBwbHlRdWF0ZXJuaW9uKHsgZWxlbWVudHMgfSkge1xyXG4gICAgICAgIGNvbnN0IHggPSB0aGlzLmVsZW1lbnRzWzBdO1xyXG4gICAgICAgIGNvbnN0IHkgPSB0aGlzLmVsZW1lbnRzWzFdO1xyXG4gICAgICAgIGNvbnN0IHogPSB0aGlzLmVsZW1lbnRzWzJdO1xyXG4gICAgICAgIGNvbnN0IHF4ID0gZWxlbWVudHNbMF07XHJcbiAgICAgICAgY29uc3QgcXkgPSBlbGVtZW50c1sxXTtcclxuICAgICAgICBjb25zdCBxeiA9IGVsZW1lbnRzWzJdO1xyXG4gICAgICAgIGNvbnN0IHF3ID0gZWxlbWVudHNbM107XHJcbiAgICAgICAgLy8gY2FsY3VsYXRlIHF1YXQgKiB2ZWN0b3JcclxuICAgICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTtcclxuICAgICAgICBjb25zdCBpeSA9IHF3ICogeSArIHF6ICogeCAtIHF4ICogejtcclxuICAgICAgICBjb25zdCBpeiA9IHF3ICogeiArIHF4ICogeSAtIHF5ICogeDtcclxuICAgICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7XHJcbiAgICAgICAgLy8gY2FsY3VsYXRlIHJlc3VsdCAqIGludmVyc2UgcXVhdFxyXG4gICAgICAgIHRoaXMuZWxlbWVudHNbMF0gPSBpeCAqIHF3ICsgaXcgKiAtcXggKyBpeSAqIC1xeiAtIGl6ICogLXF5O1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHNbMV0gPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6O1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHNbMl0gPSBpeiAqIHF3ICsgaXcgKiAtcXogKyBpeCAqIC1xeSAtIGl5ICogLXF4O1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgICogTm9ybWFsaXplLlxyXG4gICAgICAqIEByZXR1cm4gdGhpc1xyXG4gICAgICAqL1xyXG4gICAgbm9ybWFsaXplKCkge1xyXG4gICAgICAgIGNvbnN0IHYgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGxldCBjID0gdlswXTtcclxuICAgICAgICBsZXQgZCA9IHZbMV07XHJcbiAgICAgICAgbGV0IGUgPSB2WzJdO1xyXG4gICAgICAgIGxldCBnID0gTWF0aC5zcXJ0KGMgKiBjICsgZCAqIGQgKyBlICogZSk7XHJcbiAgICAgICAgaWYgKGcpIHtcclxuICAgICAgICAgICAgaWYgKGcgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZbMF0gPSAwO1xyXG4gICAgICAgICAgICB2WzFdID0gMDtcclxuICAgICAgICAgICAgdlsyXSA9IDA7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnID0gMSAvIGc7XHJcbiAgICAgICAgdlswXSA9IGMgKiBnO1xyXG4gICAgICAgIHZbMV0gPSBkICogZztcclxuICAgICAgICB2WzJdID0gZSAqIGc7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAgICAgKiBTY2FsZXMgYSB2ZWMzIGJ5IGEgc2NhbGFyIG51bWJlclxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcclxuICAgICAgICAgKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIHZlY3RvciB0byBzY2FsZVxyXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBiIGFtb3VudCB0byBzY2FsZSB0aGUgdmVjdG9yIGJ5XHJcbiAgICAgICAgICogQHJldHVybnMge3ZlYzN9IG91dFxyXG4gICAgICAgICAqL1xyXG4gICAgYWRkKGIpIHtcclxuICAgICAgICBjb25zdCBhID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBiID0gYi5lbGVtZW50cztcclxuICAgICAgICBhWzBdID0gYVswXSArIGJbMF07XHJcbiAgICAgICAgYVsxXSA9IGFbMV0gKyBiWzFdO1xyXG4gICAgICAgIGFbMl0gPSBhWzJdICsgYlsyXTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIGFkZFMoYikge1xyXG4gICAgICAgIGNvbnN0IGEgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGFbMF0gPSBhWzBdICsgYjtcclxuICAgICAgICBhWzFdID0gYVsxXSArIGI7XHJcbiAgICAgICAgYVsyXSA9IGFbMl0gKyBiO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2NhbGUoYikge1xyXG4gICAgICAgIGNvbnN0IGEgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGFbMF0gPSBhWzBdICogYjtcclxuICAgICAgICBhWzFdID0gYVsxXSAqIGI7XHJcbiAgICAgICAgYVsyXSA9IGFbMl0gKiBiO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgZGlzdGFuY2VUb1NxdWFyZWQoeCwgeSwgeikge1xyXG4gICAgICAgIGxldCBkeCA9IHRoaXMuZWxlbWVudHNbMF0gLSB4O1xyXG4gICAgICAgIGxldCBkeSA9IHRoaXMuZWxlbWVudHNbMV0gLSB5O1xyXG4gICAgICAgIGxldCBkeiA9IHRoaXMuZWxlbWVudHNbMl0gLSB6O1xyXG4gICAgICAgIHJldHVybiBkeCAqIGR4ICsgZHkgKiBkeSArIGR6ICogZHo7XHJcbiAgICB9XHJcbiAgICBzdWJ0cmFjdChiKSB7XHJcbiAgICAgICAgY29uc3Qgb3V0ID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBiID0gYi5lbGVtZW50cztcclxuICAgICAgICBvdXRbMF0gPSBvdXRbMF0gLSBiWzBdO1xyXG4gICAgICAgIG91dFsxXSA9IG91dFsxXSAtIGJbMV07XHJcbiAgICAgICAgb3V0WzJdID0gb3V0WzJdIC0gYlsyXTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIGRpdmlkZVNjYWxhcihzY2FsYXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zY2FsZSgxIC8gc2NhbGFyKTtcclxuICAgIH1cclxuICAgIGFwcGx5TWF0cml4NCh7IGVsZW1lbnRzIH0pIHtcclxuICAgICAgICBsZXQgeCA9IHRoaXMuZWxlbWVudHNbMF07XHJcbiAgICAgICAgbGV0IHkgPSB0aGlzLmVsZW1lbnRzWzFdO1xyXG4gICAgICAgIGxldCB6ID0gdGhpcy5lbGVtZW50c1syXTtcclxuICAgICAgICBjb25zdCBlID0gZWxlbWVudHM7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50c1swXSA9IGVbMF0gKiB4ICsgZVs0XSAqIHkgKyBlWzhdICogeiArIGVbMTJdO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHNbMV0gPSBlWzFdICogeCArIGVbNV0gKiB5ICsgZVs5XSAqIHogKyBlWzEzXTtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzWzJdID0gZVsyXSAqIHggKyBlWzZdICogeSArIGVbMTBdICogeiArIGVbMTRdO1xyXG4gICAgICAgIGNvbnN0IHcgPSBlWzNdICogeCArIGVbN10gKiB5ICsgZVsxMV0gKiB6ICsgZVsxNV07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHcpO1xyXG4gICAgfVxyXG4gICAgbGVycChhLCBiLCB0KSB7XHJcbiAgICAgICAgY29uc3Qgb3V0ID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBsZXQgYXggPSBhWzBdO1xyXG4gICAgICAgIGxldCBheSA9IGFbMV07XHJcbiAgICAgICAgbGV0IGF6ID0gYVsyXTtcclxuICAgICAgICBvdXRbMF0gPSBheCArIHQgKiAoYlswXSAtIGF4KTtcclxuICAgICAgICBvdXRbMV0gPSBheSArIHQgKiAoYlsxXSAtIGF5KTtcclxuICAgICAgICBvdXRbMl0gPSBheiArIHQgKiAoYlsyXSAtIGF6KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIGxlbmd0aFNxKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzWzBdICogdGhpcy5lbGVtZW50c1swXSArIHRoaXMuZWxlbWVudHNbMV0gKiB0aGlzLmVsZW1lbnRzWzFdICsgdGhpcy5lbGVtZW50c1syXSAqIHRoaXMuZWxlbWVudHNbMl07XHJcbiAgICB9XHJcbiAgICBtdWx0aXBseSh7IGVsZW1lbnRzIH0pIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzWzBdICo9IGVsZW1lbnRzWzBdO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHNbMV0gKj0gZWxlbWVudHNbMV07XHJcbiAgICAgICAgdGhpcy5lbGVtZW50c1syXSAqPSBlbGVtZW50c1syXTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHN0YXRpYyBhbmdsZShhLCBiKSB7XHJcbiAgICAgICAgY29uc3QgdGVtcEEgPSBuZXcgVmVjdG9yMyhhLmVsZW1lbnRzKTtcclxuICAgICAgICBjb25zdCB0ZW1wQiA9IG5ldyBWZWN0b3IzKGIuZWxlbWVudHMpO1xyXG4gICAgICAgIHRlbXBBLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgIHRlbXBCLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgIGNvbnN0IGNvc2luZSA9IFZlY3RvcjMuZG90KHRlbXBBLCB0ZW1wQik7XHJcbiAgICAgICAgaWYgKGNvc2luZSA+IDEuMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmFjb3MoY29zaW5lKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY3Jvc3MoYSwgYikge1xyXG4gICAgICAgIGEgPSBhLmVsZW1lbnRzO1xyXG4gICAgICAgIGIgPSBiLmVsZW1lbnRzO1xyXG4gICAgICAgIGxldCBheCA9IGFbMF07XHJcbiAgICAgICAgbGV0IGF5ID0gYVsxXTtcclxuICAgICAgICBsZXQgYXogPSBhWzJdO1xyXG4gICAgICAgIGxldCBieCA9IGJbMF07XHJcbiAgICAgICAgbGV0IGJ5ID0gYlsxXTtcclxuICAgICAgICBsZXQgYnogPSBiWzJdO1xyXG4gICAgICAgIGNvbnN0IG91dCA9IG5ldyBWZWN0b3IzKCk7XHJcbiAgICAgICAgb3V0LmVsZW1lbnRzWzBdID0gYXkgKiBieiAtIGF6ICogYnk7XHJcbiAgICAgICAgb3V0LmVsZW1lbnRzWzFdID0gYXogKiBieCAtIGF4ICogYno7XHJcbiAgICAgICAgb3V0LmVsZW1lbnRzWzJdID0gYXggKiBieSAtIGF5ICogYng7XHJcbiAgICAgICAgcmV0dXJuIG91dDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBkb3QoYSwgYikge1xyXG4gICAgICAgIGEgPSBhLmVsZW1lbnRzO1xyXG4gICAgICAgIGIgPSBiLmVsZW1lbnRzO1xyXG4gICAgICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdICsgYVsyXSAqIGJbMl07XHJcbiAgICB9XHJcbiAgICA7XHJcbn1cclxuLyoqXHJcbiAqIENvbnN0cnVjdG9yIG9mIFZlY3RvcjRcclxuICogSWYgb3B0X3NyYyBpcyBzcGVjaWZpZWQsIG5ldyB2ZWN0b3IgaXMgaW5pdGlhbGl6ZWQgYnkgb3B0X3NyYy5cclxuICogQHBhcmFtIG9wdF9zcmMgc291cmNlIHZlY3RvcihvcHRpb24pXHJcbiAqL1xyXG5jbGFzcyBWZWN0b3I0IHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdF9zcmMpIHtcclxuICAgICAgICBjb25zdCB2ID0gbmV3IEZsb2F0MzJBcnJheSg0KTtcclxuICAgICAgICBpZiAob3B0X3NyYyAmJiB0eXBlb2Ygb3B0X3NyYyA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgdlswXSA9IG9wdF9zcmNbMF07XHJcbiAgICAgICAgICAgIHZbMV0gPSBvcHRfc3JjWzFdO1xyXG4gICAgICAgICAgICB2WzJdID0gb3B0X3NyY1syXTtcclxuICAgICAgICAgICAgdlszXSA9IG9wdF9zcmNbM107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudHMgPSB2O1xyXG4gICAgfVxyXG4gICAgc2V0KGUpIHtcclxuICAgICAgICBjb25zdCBhID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBhWzBdID0gZVswXTtcclxuICAgICAgICBhWzFdID0gZVsxXTtcclxuICAgICAgICBhWzJdID0gZVsyXTtcclxuICAgICAgICBhWzNdID0gZVszXTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIGFkZChiKSB7XHJcbiAgICAgICAgY29uc3QgYSA9IHRoaXMuZWxlbWVudHM7XHJcbiAgICAgICAgYiA9IGIuZWxlbWVudHM7XHJcbiAgICAgICAgYVswXSA9IGJbMF07XHJcbiAgICAgICAgYVsxXSA9IGJbMV07XHJcbiAgICAgICAgYVsyXSA9IGJbMl07XHJcbiAgICAgICAgYVszXSA9IGFbM10gKyBiWzNdO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgbm9ybWFsaXplKCkge1xyXG4gICAgICAgIGxldCB4ID0gdGhpcy5lbGVtZW50c1swXTtcclxuICAgICAgICBsZXQgeSA9IHRoaXMuZWxlbWVudHNbMV07XHJcbiAgICAgICAgbGV0IHogPSB0aGlzLmVsZW1lbnRzWzJdO1xyXG4gICAgICAgIGxldCB3ID0gdGhpcy5lbGVtZW50c1szXTtcclxuICAgICAgICBsZXQgbGVuID0geCAqIHggKyB5ICogeSArIHogKiB6ICsgdyAqIHc7XHJcbiAgICAgICAgaWYgKGxlbiA+IDApIHtcclxuICAgICAgICAgICAgbGVuID0gMSAvIE1hdGguc3FydChsZW4pO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzBdID0geCAqIGxlbjtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1sxXSA9IHkgKiBsZW47XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbMl0gPSB6ICogbGVuO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzNdID0gdyAqIGxlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBzZXRGcm9tUm90YXRpb25NYXRyaXgoeyBlbGVtZW50cyB9KSB7XHJcbiAgICAgICAgY29uc3QgdGUgPSBlbGVtZW50cztcclxuICAgICAgICBjb25zdCBtMTEgPSB0ZVswXTtcclxuICAgICAgICBjb25zdCBtMTIgPSB0ZVs0XTtcclxuICAgICAgICBjb25zdCBtMTMgPSB0ZVs4XTtcclxuICAgICAgICBjb25zdCBtMjEgPSB0ZVsxXTtcclxuICAgICAgICBjb25zdCBtMjIgPSB0ZVs1XTtcclxuICAgICAgICBjb25zdCBtMjMgPSB0ZVs5XTtcclxuICAgICAgICBjb25zdCBtMzEgPSB0ZVsyXTtcclxuICAgICAgICBjb25zdCBtMzIgPSB0ZVs2XTtcclxuICAgICAgICBjb25zdCBtMzMgPSB0ZVsxMF07XHJcbiAgICAgICAgY29uc3QgdHJhY2UgPSBtMTEgKyBtMjIgKyBtMzM7XHJcbiAgICAgICAgbGV0IHM7XHJcbiAgICAgICAgaWYgKHRyYWNlID4gMCkge1xyXG4gICAgICAgICAgICBzID0gMC41IC8gTWF0aC5zcXJ0KHRyYWNlICsgMS4wKTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1szXSA9IDAuMjUgLyBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzBdID0gKG0zMiAtIG0yMykgKiBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzFdID0gKG0xMyAtIG0zMSkgKiBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzJdID0gKG0yMSAtIG0xMikgKiBzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChtMTEgPiBtMjIgJiYgbTExID4gbTMzKSB7XHJcbiAgICAgICAgICAgIHMgPSAyLjAgKiBNYXRoLnNxcnQoMS4wICsgbTExIC0gbTIyIC0gbTMzKTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1szXSA9IChtMzIgLSBtMjMpIC8gcztcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50c1swXSA9IDAuMjUgKiBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzFdID0gKG0xMiArIG0yMSkgLyBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzJdID0gKG0xMyArIG0zMSkgLyBzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChtMjIgPiBtMzMpIHtcclxuICAgICAgICAgICAgcyA9IDIuMCAqIE1hdGguc3FydCgxLjAgKyBtMjIgLSBtMTEgLSBtMzMpO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzNdID0gKG0xMyAtIG0zMSkgLyBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzBdID0gKG0xMiArIG0yMSkgLyBzO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzWzFdID0gMC4yNSAqIHM7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbMl0gPSAobTIzICsgbTMyKSAvIHM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzID0gMi4wICogTWF0aC5zcXJ0KDEuMCArIG0zMyAtIG0xMSAtIG0yMik7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbM10gPSAobTIxIC0gbTEyKSAvIHM7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbMF0gPSAobTEzICsgbTMxKSAvIHM7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbMV0gPSAobTIzICsgbTMyKSAvIHM7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHNbMl0gPSAwLjI1ICogcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBsZXJwKGEsIGIsIHQpIHtcclxuICAgICAgICBjb25zdCBvdXQgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGxldCBheCA9IGFbMF07XHJcbiAgICAgICAgbGV0IGF5ID0gYVsxXTtcclxuICAgICAgICBsZXQgYXogPSBhWzJdO1xyXG4gICAgICAgIGxldCBhdyA9IGFbM107XHJcbiAgICAgICAgb3V0WzBdID0gYXggKyB0ICogKGJbMF0gLSBheCk7XHJcbiAgICAgICAgb3V0WzFdID0gYXkgKyB0ICogKGJbMV0gLSBheSk7XHJcbiAgICAgICAgb3V0WzJdID0gYXogKyB0ICogKGJbMl0gLSBheik7XHJcbiAgICAgICAgb3V0WzNdID0gYXcgKyB0ICogKGJbM10gLSBhdyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgVmVjdG9yMiB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRfc3JjKSB7XHJcbiAgICAgICAgY29uc3QgdiA9IG5ldyBGbG9hdDMyQXJyYXkoMik7XHJcbiAgICAgICAgaWYgKG9wdF9zcmMgJiYgdHlwZW9mIG9wdF9zcmMgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHZbMF0gPSBvcHRfc3JjWzBdO1xyXG4gICAgICAgICAgICB2WzFdID0gb3B0X3NyY1sxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IHY7XHJcbiAgICB9XHJcbiAgICBzdWJ0cmFjdChiKSB7XHJcbiAgICAgICAgY29uc3Qgb3V0ID0gdGhpcy5lbGVtZW50cztcclxuICAgICAgICBiID0gYi5lbGVtZW50cztcclxuICAgICAgICBvdXRbMF0gPSBvdXRbMF0gLSBiWzBdO1xyXG4gICAgICAgIG91dFsxXSA9IG91dFsxXSAtIGJbMV07XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBsZXJwKGEsIGIsIHQpIHtcclxuICAgICAgICBjb25zdCBvdXQgPSB0aGlzLmVsZW1lbnRzO1xyXG4gICAgICAgIGxldCBheCA9IGFbMF07XHJcbiAgICAgICAgbGV0IGF5ID0gYVsxXTtcclxuICAgICAgICBvdXRbMF0gPSBheCArIHQgKiAoYlswXSAtIGF4KTtcclxuICAgICAgICBvdXRbMV0gPSBheSArIHQgKiAoYlsxXSAtIGF5KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG4vLyB7IDA6IHJpZ2h0LCAxOiBsZWZ0LCAyOiBib3R0b20uIDM6IHRvcCwgNDogZmFyLCA1OiBuZWFyIH1cclxuZnVuY3Rpb24gRnJ1c3R1bShtKSB7XHJcbiAgICBjb25zdCBwbGFuZXMgPSBbbmV3IFZlY3RvcjQsIG5ldyBWZWN0b3I0LCBuZXcgVmVjdG9yNCwgbmV3IFZlY3RvcjQsIG5ldyBWZWN0b3I0LCBuZXcgVmVjdG9yNF07XHJcbiAgICBjb25zdCBtZSA9IG0uZWxlbWVudHM7XHJcbiAgICBsZXQgbWUwID0gbWVbMF0sIG1lMSA9IG1lWzFdLCBtZTIgPSBtZVsyXSwgbWUzID0gbWVbM107XHJcbiAgICBsZXQgbWU0ID0gbWVbNF0sIG1lNSA9IG1lWzVdLCBtZTYgPSBtZVs2XSwgbWU3ID0gbWVbN107XHJcbiAgICBsZXQgbWU4ID0gbWVbOF0sIG1lOSA9IG1lWzldLCBtZTEwID0gbWVbMTBdLCBtZTExID0gbWVbMTFdO1xyXG4gICAgbGV0IG1lMTIgPSBtZVsxMl0sIG1lMTMgPSBtZVsxM10sIG1lMTQgPSBtZVsxNF0sIG1lMTUgPSBtZVsxNV07XHJcbiAgICBwbGFuZXNbMF0uc2V0KFttZTMgLSBtZTAsIG1lNyAtIG1lNCwgbWUxMSAtIG1lOCwgbWUxNSAtIG1lMTJdKS5ub3JtYWxpemUoKTtcclxuICAgIHBsYW5lc1sxXS5zZXQoW21lMyArIG1lMCwgbWU3ICsgbWU0LCBtZTExICsgbWU4LCBtZTE1ICsgbWUxMl0pLm5vcm1hbGl6ZSgpO1xyXG4gICAgcGxhbmVzWzJdLnNldChbbWUzICsgbWUxLCBtZTcgKyBtZTUsIG1lMTEgKyBtZTksIG1lMTUgKyBtZTEzXSkubm9ybWFsaXplKCk7XHJcbiAgICBwbGFuZXNbM10uc2V0KFttZTMgLSBtZTEsIG1lNyAtIG1lNSwgbWUxMSAtIG1lOSwgbWUxNSAtIG1lMTNdKS5ub3JtYWxpemUoKTtcclxuICAgIHBsYW5lc1s0XS5zZXQoW21lMyAtIG1lMiwgbWU3IC0gbWU2LCBtZTExIC0gbWUxMCwgbWUxNSAtIG1lMTRdKS5ub3JtYWxpemUoKTtcclxuICAgIHBsYW5lc1s1XS5zZXQoW21lMyArIG1lMiwgbWU3ICsgbWU2LCBtZTExICsgbWUxMCwgbWUxNSArIG1lMTRdKS5ub3JtYWxpemUoKTtcclxuICAgIHJldHVybiBwbGFuZXM7XHJcbn1cclxuZXhwb3J0IHsgTWF0cml4MiwgTWF0cml4MywgTWF0cml4NCwgVmVjdG9yMiwgVmVjdG9yMywgVmVjdG9yNCwgRnJ1c3R1bSB9O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/matrix.ts\n");

/***/ }),

/***/ "./src/objects.ts":
/*!************************!*\
  !*** ./src/objects.ts ***!
  \************************/
/*! exports provided: Scene, Object3D, Mesh, SkinnedMesh, Bone, Camera */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Scene\", function() { return Scene; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Object3D\", function() { return Object3D; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Mesh\", function() { return Mesh; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SkinnedMesh\", function() { return SkinnedMesh; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Bone\", function() { return Bone; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Camera\", function() { return Camera; });\n/* harmony import */ var _matrix__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./matrix */ \"./src/matrix.ts\");\n\r\nclass Object3D {\r\n    constructor(name, parent) {\r\n        this.uuid = Math.floor(Date.now() * Math.random());\r\n        this.name = name;\r\n        this.children = [];\r\n        this.matrix = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"];\r\n        this.matrixWorld = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"];\r\n        this.parent = parent;\r\n    }\r\n    setPosition(translation, rotation, scale) {\r\n        if (rotation) {\r\n            this.matrix.makeRotationFromQuaternion(rotation);\r\n        }\r\n        if (scale) {\r\n            this.matrix.scale(new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"](scale));\r\n        }\r\n        if (translation) {\r\n            this.matrix.setTranslate(new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"](translation));\r\n        }\r\n    }\r\n    setMatrix(matrix) {\r\n        this.matrix.set(matrix);\r\n    }\r\n    setMatrixWorld(matrix) {\r\n        this.matrixWorld.set(matrix);\r\n    }\r\n}\r\nclass Mesh extends Object3D {\r\n    constructor(name, parent) {\r\n        super(name, parent);\r\n        this.geometry = {\r\n            boundingSphere: {\r\n                center: new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"],\r\n                radius: null,\r\n                min: null,\r\n                max: null\r\n            },\r\n            UBO: null,\r\n            VAO: null,\r\n            indicesBuffer: null,\r\n            attributes: null,\r\n            targets: null,\r\n            blend: null,\r\n            uniforms: null,\r\n            SKIN: null\r\n        };\r\n        this.material = {\r\n            blend: null,\r\n            uniforms: null,\r\n            alphaMode: null,\r\n            UBO: null,\r\n            pbrMetallicRoughness: null\r\n        };\r\n        this.program = null;\r\n        this.defines = null;\r\n        this.mode = 4;\r\n    }\r\n    setBlend(value) {\r\n        this.material.blend = value;\r\n    }\r\n    setMaterial(material) {\r\n        this.material = material;\r\n        this.material.uniforms = {\r\n            baseColorTexture: null,\r\n            metallicRoughnessTexture: null,\r\n            normalTexture: null,\r\n            occlusionTexture: null,\r\n            emissiveTexture: null\r\n        };\r\n    }\r\n    calculateBounding() {\r\n        const vertices = this.geometry.attributes.POSITION;\r\n        let maxRadiusSq = 0;\r\n        this.geometry.boundingSphere.center\r\n            .add(this.geometry.boundingSphere.min)\r\n            .add(this.geometry.boundingSphere.max)\r\n            .scale(0.5);\r\n        for (let i = 0; i < vertices.length; i = i + 3) {\r\n            maxRadiusSq = Math.max(maxRadiusSq, this.geometry.boundingSphere.center.distanceToSquared(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n        }\r\n        this.geometry.boundingSphere.radius = Math.sqrt(maxRadiusSq);\r\n    }\r\n    setBoundingBox({ min, max }) {\r\n        this.geometry.boundingSphere.min = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"](min);\r\n        this.geometry.boundingSphere.max = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"](max);\r\n        this.calculateBounding();\r\n    }\r\n    setIndicesBuffer(value) {\r\n        this.geometry.indicesBuffer = value;\r\n    }\r\n    setAttributes(value) {\r\n        this.geometry.attributes = value;\r\n    }\r\n    setTargets(value) {\r\n        this.geometry.targets = value;\r\n    }\r\n    setProgram(value) {\r\n        this.program = value;\r\n    }\r\n    setMode(value) {\r\n        this.mode = value;\r\n    }\r\n    isVisible(planes) {\r\n        const c = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"](this.geometry.boundingSphere.center.elements).applyMatrix4(this.matrixWorld);\r\n        const r = this.geometry.boundingSphere.radius * this.matrixWorld.getMaxScaleOnAxis();\r\n        let dist;\r\n        let visible = true;\r\n        for (const p of planes) {\r\n            dist = p.elements[0] * c.elements[0] + p.elements[1] * c.elements[1] + p.elements[2] * c.elements[2] + p.elements[3];\r\n            if (dist < -r) {\r\n                visible = false;\r\n                break;\r\n            }\r\n        }\r\n        this.distance = dist + r;\r\n        return visible;\r\n    }\r\n}\r\nclass SkinnedMesh extends Mesh {\r\n    constructor(name, parent) {\r\n        super(name, parent);\r\n    }\r\n    setSkin(value) {\r\n        this.skin = value;\r\n        return this;\r\n    }\r\n    getJointMatrix() {\r\n        const m = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"](this.matrixWorld).invert();\r\n        const resArray = [];\r\n        for (let mi = 0; mi < this.boneInverses.length; mi++) {\r\n            const res = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]()\r\n                .multiply(m)\r\n                .multiply(this.bones[mi].matrixWorld)\r\n                .multiply(this.boneInverses[mi]);\r\n            resArray.push(res);\r\n        }\r\n        return resArray;\r\n    }\r\n}\r\nclass Bone extends Object3D {\r\n}\r\nclass Camera extends Object3D {\r\n    constructor(name, parent) {\r\n        super(name, parent);\r\n        this.matrixWorldInvert = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]();\r\n        this.projection = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]();\r\n    }\r\n    setProjection(matrix) {\r\n        this.projection.set(matrix);\r\n    }\r\n    setMatrixWorld(matrix) {\r\n        super.setMatrixWorld(matrix);\r\n        this.matrixWorldInvert.setInverseOf(this.matrixWorld);\r\n    }\r\n    setZ(z) {\r\n        this.matrix.elements[14] = z;\r\n        this.setMatrixWorld(this.matrix.elements);\r\n    }\r\n    getViewProjMatrix() {\r\n        const m = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]();\r\n        m.multiply(this.projection);\r\n        m.multiply(this.matrixWorldInvert);\r\n        return m;\r\n    }\r\n}\r\nclass Scene {\r\n    constructor() {\r\n        this.opaqueChildren = [];\r\n        this.transparentChildren = [];\r\n        this.children = [];\r\n        this.bin = [];\r\n        this.matrixWorld = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]();\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvb2JqZWN0cy50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL3JlZGN1YmUvLi9zcmMvb2JqZWN0cy50cz9iOGU0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hdHJpeDQsIFZlY3RvcjMgfSBmcm9tICcuL21hdHJpeCc7XHJcbmNsYXNzIE9iamVjdDNEIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHBhcmVudCkge1xyXG4gICAgICAgIHRoaXMudXVpZCA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAqIE1hdGgucmFuZG9tKCkpO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIHRoaXMubWF0cml4ID0gbmV3IE1hdHJpeDQ7XHJcbiAgICAgICAgdGhpcy5tYXRyaXhXb3JsZCA9IG5ldyBNYXRyaXg0O1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xyXG4gICAgfVxyXG4gICAgc2V0UG9zaXRpb24odHJhbnNsYXRpb24sIHJvdGF0aW9uLCBzY2FsZSkge1xyXG4gICAgICAgIGlmIChyb3RhdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLm1hdHJpeC5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbihyb3RhdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzY2FsZSkge1xyXG4gICAgICAgICAgICB0aGlzLm1hdHJpeC5zY2FsZShuZXcgVmVjdG9yMyhzY2FsZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHJhbnNsYXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5tYXRyaXguc2V0VHJhbnNsYXRlKG5ldyBWZWN0b3IzKHRyYW5zbGF0aW9uKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2V0TWF0cml4KG1hdHJpeCkge1xyXG4gICAgICAgIHRoaXMubWF0cml4LnNldChtYXRyaXgpO1xyXG4gICAgfVxyXG4gICAgc2V0TWF0cml4V29ybGQobWF0cml4KSB7XHJcbiAgICAgICAgdGhpcy5tYXRyaXhXb3JsZC5zZXQobWF0cml4KTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBNZXNoIGV4dGVuZHMgT2JqZWN0M0Qge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgcGFyZW50KSB7XHJcbiAgICAgICAgc3VwZXIobmFtZSwgcGFyZW50KTtcclxuICAgICAgICB0aGlzLmdlb21ldHJ5ID0ge1xyXG4gICAgICAgICAgICBib3VuZGluZ1NwaGVyZToge1xyXG4gICAgICAgICAgICAgICAgY2VudGVyOiBuZXcgVmVjdG9yMyxcclxuICAgICAgICAgICAgICAgIHJhZGl1czogbnVsbCxcclxuICAgICAgICAgICAgICAgIG1pbjogbnVsbCxcclxuICAgICAgICAgICAgICAgIG1heDogbnVsbFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBVQk86IG51bGwsXHJcbiAgICAgICAgICAgIFZBTzogbnVsbCxcclxuICAgICAgICAgICAgaW5kaWNlc0J1ZmZlcjogbnVsbCxcclxuICAgICAgICAgICAgYXR0cmlidXRlczogbnVsbCxcclxuICAgICAgICAgICAgdGFyZ2V0czogbnVsbCxcclxuICAgICAgICAgICAgYmxlbmQ6IG51bGwsXHJcbiAgICAgICAgICAgIHVuaWZvcm1zOiBudWxsLFxyXG4gICAgICAgICAgICBTS0lOOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm1hdGVyaWFsID0ge1xyXG4gICAgICAgICAgICBibGVuZDogbnVsbCxcclxuICAgICAgICAgICAgdW5pZm9ybXM6IG51bGwsXHJcbiAgICAgICAgICAgIGFscGhhTW9kZTogbnVsbCxcclxuICAgICAgICAgICAgVUJPOiBudWxsLFxyXG4gICAgICAgICAgICBwYnJNZXRhbGxpY1JvdWdobmVzczogbnVsbFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5wcm9ncmFtID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRlZmluZXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubW9kZSA9IDQ7XHJcbiAgICB9XHJcbiAgICBzZXRCbGVuZCh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMubWF0ZXJpYWwuYmxlbmQgPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIHNldE1hdGVyaWFsKG1hdGVyaWFsKSB7XHJcbiAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsO1xyXG4gICAgICAgIHRoaXMubWF0ZXJpYWwudW5pZm9ybXMgPSB7XHJcbiAgICAgICAgICAgIGJhc2VDb2xvclRleHR1cmU6IG51bGwsXHJcbiAgICAgICAgICAgIG1ldGFsbGljUm91Z2huZXNzVGV4dHVyZTogbnVsbCxcclxuICAgICAgICAgICAgbm9ybWFsVGV4dHVyZTogbnVsbCxcclxuICAgICAgICAgICAgb2NjbHVzaW9uVGV4dHVyZTogbnVsbCxcclxuICAgICAgICAgICAgZW1pc3NpdmVUZXh0dXJlOiBudWxsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGNhbGN1bGF0ZUJvdW5kaW5nKCkge1xyXG4gICAgICAgIGNvbnN0IHZlcnRpY2VzID0gdGhpcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLlBPU0lUSU9OO1xyXG4gICAgICAgIGxldCBtYXhSYWRpdXNTcSA9IDA7XHJcbiAgICAgICAgdGhpcy5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZS5jZW50ZXJcclxuICAgICAgICAgICAgLmFkZCh0aGlzLmdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLm1pbilcclxuICAgICAgICAgICAgLmFkZCh0aGlzLmdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLm1heClcclxuICAgICAgICAgICAgLnNjYWxlKDAuNSk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2ZXJ0aWNlcy5sZW5ndGg7IGkgPSBpICsgMykge1xyXG4gICAgICAgICAgICBtYXhSYWRpdXNTcSA9IE1hdGgubWF4KG1heFJhZGl1c1NxLCB0aGlzLmdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCh2ZXJ0aWNlc1tpXSwgdmVydGljZXNbaSArIDFdLCB2ZXJ0aWNlc1tpICsgMl0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQobWF4UmFkaXVzU3EpO1xyXG4gICAgfVxyXG4gICAgc2V0Qm91bmRpbmdCb3goeyBtaW4sIG1heCB9KSB7XHJcbiAgICAgICAgdGhpcy5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZS5taW4gPSBuZXcgVmVjdG9yMyhtaW4pO1xyXG4gICAgICAgIHRoaXMuZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUubWF4ID0gbmV3IFZlY3RvcjMobWF4KTtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUJvdW5kaW5nKCk7XHJcbiAgICB9XHJcbiAgICBzZXRJbmRpY2VzQnVmZmVyKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5nZW9tZXRyeS5pbmRpY2VzQnVmZmVyID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBzZXRBdHRyaWJ1dGVzKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5nZW9tZXRyeS5hdHRyaWJ1dGVzID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBzZXRUYXJnZXRzKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5nZW9tZXRyeS50YXJnZXRzID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBzZXRQcm9ncmFtKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5wcm9ncmFtID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBzZXRNb2RlKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBpc1Zpc2libGUocGxhbmVzKSB7XHJcbiAgICAgICAgY29uc3QgYyA9IG5ldyBWZWN0b3IzKHRoaXMuZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUuY2VudGVyLmVsZW1lbnRzKS5hcHBseU1hdHJpeDQodGhpcy5tYXRyaXhXb3JsZCk7XHJcbiAgICAgICAgY29uc3QgciA9IHRoaXMuZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUucmFkaXVzICogdGhpcy5tYXRyaXhXb3JsZC5nZXRNYXhTY2FsZU9uQXhpcygpO1xyXG4gICAgICAgIGxldCBkaXN0O1xyXG4gICAgICAgIGxldCB2aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICBmb3IgKGNvbnN0IHAgb2YgcGxhbmVzKSB7XHJcbiAgICAgICAgICAgIGRpc3QgPSBwLmVsZW1lbnRzWzBdICogYy5lbGVtZW50c1swXSArIHAuZWxlbWVudHNbMV0gKiBjLmVsZW1lbnRzWzFdICsgcC5lbGVtZW50c1syXSAqIGMuZWxlbWVudHNbMl0gKyBwLmVsZW1lbnRzWzNdO1xyXG4gICAgICAgICAgICBpZiAoZGlzdCA8IC1yKSB7XHJcbiAgICAgICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdCArIHI7XHJcbiAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgU2tpbm5lZE1lc2ggZXh0ZW5kcyBNZXNoIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHBhcmVudCkge1xyXG4gICAgICAgIHN1cGVyKG5hbWUsIHBhcmVudCk7XHJcbiAgICB9XHJcbiAgICBzZXRTa2luKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5za2luID0gdmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBnZXRKb2ludE1hdHJpeCgpIHtcclxuICAgICAgICBjb25zdCBtID0gbmV3IE1hdHJpeDQodGhpcy5tYXRyaXhXb3JsZCkuaW52ZXJ0KCk7XHJcbiAgICAgICAgY29uc3QgcmVzQXJyYXkgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBtaSA9IDA7IG1pIDwgdGhpcy5ib25lSW52ZXJzZXMubGVuZ3RoOyBtaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IG5ldyBNYXRyaXg0KClcclxuICAgICAgICAgICAgICAgIC5tdWx0aXBseShtKVxyXG4gICAgICAgICAgICAgICAgLm11bHRpcGx5KHRoaXMuYm9uZXNbbWldLm1hdHJpeFdvcmxkKVxyXG4gICAgICAgICAgICAgICAgLm11bHRpcGx5KHRoaXMuYm9uZUludmVyc2VzW21pXSk7XHJcbiAgICAgICAgICAgIHJlc0FycmF5LnB1c2gocmVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc0FycmF5O1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIEJvbmUgZXh0ZW5kcyBPYmplY3QzRCB7XHJcbn1cclxuY2xhc3MgQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0Qge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgcGFyZW50KSB7XHJcbiAgICAgICAgc3VwZXIobmFtZSwgcGFyZW50KTtcclxuICAgICAgICB0aGlzLm1hdHJpeFdvcmxkSW52ZXJ0ID0gbmV3IE1hdHJpeDQoKTtcclxuICAgICAgICB0aGlzLnByb2plY3Rpb24gPSBuZXcgTWF0cml4NCgpO1xyXG4gICAgfVxyXG4gICAgc2V0UHJvamVjdGlvbihtYXRyaXgpIHtcclxuICAgICAgICB0aGlzLnByb2plY3Rpb24uc2V0KG1hdHJpeCk7XHJcbiAgICB9XHJcbiAgICBzZXRNYXRyaXhXb3JsZChtYXRyaXgpIHtcclxuICAgICAgICBzdXBlci5zZXRNYXRyaXhXb3JsZChtYXRyaXgpO1xyXG4gICAgICAgIHRoaXMubWF0cml4V29ybGRJbnZlcnQuc2V0SW52ZXJzZU9mKHRoaXMubWF0cml4V29ybGQpO1xyXG4gICAgfVxyXG4gICAgc2V0Wih6KSB7XHJcbiAgICAgICAgdGhpcy5tYXRyaXguZWxlbWVudHNbMTRdID0gejtcclxuICAgICAgICB0aGlzLnNldE1hdHJpeFdvcmxkKHRoaXMubWF0cml4LmVsZW1lbnRzKTtcclxuICAgIH1cclxuICAgIGdldFZpZXdQcm9qTWF0cml4KCkge1xyXG4gICAgICAgIGNvbnN0IG0gPSBuZXcgTWF0cml4NCgpO1xyXG4gICAgICAgIG0ubXVsdGlwbHkodGhpcy5wcm9qZWN0aW9uKTtcclxuICAgICAgICBtLm11bHRpcGx5KHRoaXMubWF0cml4V29ybGRJbnZlcnQpO1xyXG4gICAgICAgIHJldHVybiBtO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIFNjZW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMub3BhcXVlQ2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB0aGlzLnRyYW5zcGFyZW50Q2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgdGhpcy5iaW4gPSBbXTtcclxuICAgICAgICB0aGlzLm1hdHJpeFdvcmxkID0gbmV3IE1hdHJpeDQoKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgeyBTY2VuZSwgT2JqZWN0M0QsIE1lc2gsIFNraW5uZWRNZXNoLCBCb25lLCBDYW1lcmEgfTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/objects.ts\n");

/***/ }),

/***/ "./src/parse.ts":
/*!**********************!*\
  !*** ./src/parse.ts ***!
  \**********************/
/*! exports provided: Parse */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Parse\", function() { return Parse; });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n/* harmony import */ var _objects__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./objects */ \"./src/objects.ts\");\n/* harmony import */ var _matrix__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./matrix */ \"./src/matrix.ts\");\n/* harmony import */ var _shaders_vertex_glsl__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./shaders/vertex.glsl */ \"./src/shaders/vertex.glsl\");\n/* harmony import */ var _shaders_vertex_glsl__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_shaders_vertex_glsl__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _shaders_fragment_glsl__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./shaders/fragment.glsl */ \"./src/shaders/fragment.glsl\");\n/* harmony import */ var _shaders_fragment_glsl__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_shaders_fragment_glsl__WEBPACK_IMPORTED_MODULE_4__);\n\r\n\r\n\r\n\r\n\r\nlet gl;\r\nlet sceneTextureCount = 0;\r\nclass Parse {\r\n    constructor(url) {\r\n        this.url = url;\r\n        this.host = url.substr(0, url.lastIndexOf('/') + 1);\r\n        this.tracks = [];\r\n        this.skins = [];\r\n        this.textures = null;\r\n        this.samplers = null;\r\n        this.arrayBuffer = null;\r\n        this.cameras = [];\r\n        this.programs = {};\r\n    }\r\n    setScene(scene) {\r\n        this.scene = scene;\r\n    }\r\n    setGl(g) {\r\n        gl = g;\r\n    }\r\n    setCamera(camera, aspect, zoom) {\r\n        this._camera = camera;\r\n        this.aspect = aspect;\r\n        this.zoom = zoom;\r\n    }\r\n    setCanvas(canvas) {\r\n        this.canvas = canvas;\r\n    }\r\n    setResize(resize) {\r\n        this.resize = resize;\r\n    }\r\n    setUpdateCamera(updateCamera) {\r\n        this.updateCamera = updateCamera;\r\n    }\r\n    get width() {\r\n        return this.canvas.offsetWidth;\r\n    }\r\n    getBuffer() {\r\n        return Promise.all(this.scene.bin.map(url => fetch(`${this.host}${url}`).then(res => res.arrayBuffer())))\r\n            .then(buffers => {\r\n            this.arrayBuffer = buffers;\r\n        });\r\n    }\r\n    compileShader(vertexShader, fragmentShader) {\r\n        const program = gl.createProgram();\r\n        Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"compileShader\"])(gl.VERTEX_SHADER, vertexShader, program);\r\n        Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"compileShader\"])(gl.FRAGMENT_SHADER, fragmentShader, program);\r\n        gl.linkProgram(program);\r\n        return program;\r\n    }\r\n    buildPrim(parent, name, skin, weights, p) {\r\n        const indicesAccessor = this.json.accessors[p.indices];\r\n        const vertexAccessor = new Map;\r\n        for (const a in p.attributes) {\r\n            vertexAccessor.set(a, this.json.accessors[p.attributes[a]]);\r\n        }\r\n        const targets = [];\r\n        if (p.targets) {\r\n            for (const target of p.targets) {\r\n                const vertexAcc = {};\r\n                for (const a in target) {\r\n                    vertexAcc[a] = this.json.accessors[target[a]];\r\n                    const accessor = vertexAcc[a];\r\n                    const bufferView = this.json.bufferViews[accessor.bufferView];\r\n                    vertexAcc[a] = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"buildArray\"])(this.arrayBuffer[bufferView.buffer], accessor.componentType, Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateOffset\"])(bufferView.byteOffset, accessor.byteOffset), Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getDataType\"])(accessor.type) * accessor.count);\r\n                }\r\n                targets.push(vertexAcc);\r\n            }\r\n        }\r\n        const material = p.material !== undefined ? JSON.parse(JSON.stringify(this.json.materials[p.material])) : { pbrMetallicRoughness: { baseColorFactor: [0.8, 0.8, 0.8, 1.0] } };\r\n        const defines = [];\r\n        if (material.pbrMetallicRoughness.metallicRoughnessTexture) {\r\n            material.pbrMetallicRoughness.metallicRoughnessTexture = Object.assign({}, this.textures[material.pbrMetallicRoughness.metallicRoughnessTexture.index]);\r\n            defines.push({ name: 'USE_PBR' });\r\n            defines.push({ name: 'METALROUGHNESSMAP' });\r\n        }\r\n        if (material.normalTexture) {\r\n            material.normalTexture = Object.assign({}, this.textures[material.normalTexture.index]);\r\n            defines.push({ name: 'NORMALMAP' });\r\n        }\r\n        if (material.occlusionTexture) {\r\n            material.occlusionTexture = Object.assign({}, this.textures[material.occlusionTexture.index]);\r\n            defines.push({ name: 'OCCLUSIONMAP' });\r\n        }\r\n        if (material.pbrMetallicRoughness.baseColorTexture) {\r\n            material.pbrMetallicRoughness.baseColorTexture = Object.assign({}, this.textures[material.pbrMetallicRoughness.baseColorTexture.index]);\r\n            defines.push({ name: 'BASECOLORTEXTURE' });\r\n        }\r\n        if (material.emissiveTexture) {\r\n            material.emissiveTexture = Object.assign({}, this.textures[material.emissiveTexture.index]);\r\n            defines.push({ name: 'EMISSIVEMAP' });\r\n        }\r\n        if (skin !== undefined) {\r\n            defines.push({ name: 'JOINTNUMBER', value: this.skins[skin].jointNames.length });\r\n        }\r\n        if (p.attributes.TANGENT || material.normalTexture) {\r\n            defines.push({ name: 'TANGENT' });\r\n        }\r\n        let program;\r\n        if (this.programs[defines.map(define => define.name).join('')]) {\r\n            program = this.programs[defines.map(define => define.name).join('')];\r\n        }\r\n        else {\r\n            const defineStr = defines.map(define => `#define ${define.name} ${define.value || 1}` + '\\n').join('');\r\n            program = this.compileShader(_shaders_vertex_glsl__WEBPACK_IMPORTED_MODULE_3___default.a.replace(/\\n/, `\\n${defineStr}`), _shaders_fragment_glsl__WEBPACK_IMPORTED_MODULE_4___default.a.replace(/\\n/, `\\n${defineStr}`));\r\n            this.programs[defines.map(define => define.name).join('')] = program;\r\n        }\r\n        let indicesBuffer;\r\n        if (indicesAccessor) {\r\n            const bufferView = this.json.bufferViews[indicesAccessor.bufferView];\r\n            indicesBuffer = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"buildArray\"])(this.arrayBuffer[bufferView.buffer], indicesAccessor.componentType, Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateOffset\"])(bufferView.byteOffset, indicesAccessor.byteOffset), Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getDataType\"])(indicesAccessor.type) * indicesAccessor.count);\r\n        }\r\n        const boundingBox = {\r\n            min: vertexAccessor.get('POSITION').min,\r\n            max: vertexAccessor.get('POSITION').max\r\n        };\r\n        const vertexBuffers = {};\r\n        for (const k of vertexAccessor.keys()) {\r\n            const accessor = vertexAccessor.get(k);\r\n            const bufferView = this.json.bufferViews[accessor.bufferView];\r\n            vertexBuffers[k] = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"buildArray\"])(this.arrayBuffer[bufferView.buffer], accessor.componentType, Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateOffset\"])(bufferView.byteOffset, accessor.byteOffset), Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getDataType\"])(accessor.type) * accessor.count, bufferView.byteStride, accessor.count);\r\n            if (p.targets && k in p.targets[0]) {\r\n                let offset = 0;\r\n                const geometry = vertexBuffers[k];\r\n                vertexBuffers[k] = new Float32Array(geometry.length);\r\n                for (let i = 0; i < vertexBuffers[k].length; i++) {\r\n                    if (k === 'TANGENT' && (i + 1) % 4 === 0) {\r\n                        offset++;\r\n                        continue;\r\n                    }\r\n                    vertexBuffers[k][i] = geometry[i] + weights[0] * targets[0][k][i - offset] + weights[1] * targets[1][k][i - offset];\r\n                }\r\n            }\r\n        }\r\n        if (material.normalTexture && p.attributes.TANGENT === undefined) {\r\n            vertexBuffers.TANGENT = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateBinormals\"])(indicesBuffer, vertexBuffers.POSITION, vertexBuffers.NORMAL, vertexBuffers.TEXCOORD_0);\r\n        }\r\n        const mesh = skin !== undefined ? new _objects__WEBPACK_IMPORTED_MODULE_1__[\"SkinnedMesh\"](name, parent).setSkin(skin) : new _objects__WEBPACK_IMPORTED_MODULE_1__[\"Mesh\"](name, parent);\r\n        mesh.setProgram(program);\r\n        mesh.setMode(p.mode);\r\n        mesh.setMaterial(material);\r\n        mesh.setAttributes(vertexBuffers);\r\n        mesh.setIndicesBuffer(indicesBuffer);\r\n        mesh.setBoundingBox(boundingBox);\r\n        mesh.setTargets(targets);\r\n        const m = new _matrix__WEBPACK_IMPORTED_MODULE_2__[\"Matrix4\"];\r\n        m.multiply(mesh.parent.matrixWorld);\r\n        m.multiply(mesh.matrix);\r\n        mesh.setMatrixWorld(m.elements);\r\n        const VAO = gl.createVertexArray();\r\n        gl.bindVertexArray(VAO);\r\n        for (const k in vertexBuffers) {\r\n            const VBO = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, VBO);\r\n            gl.bufferData(gl.ARRAY_BUFFER, vertexBuffers[k], gl.STATIC_DRAW);\r\n            const index = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getAttributeIndex\"])(k);\r\n            gl.enableVertexAttribArray(index[0]);\r\n            gl.vertexAttribPointer(index[0], index[1], index[2], false, 0, 0);\r\n        }\r\n        if (indicesBuffer) {\r\n            const VBO = gl.createBuffer();\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, VBO);\r\n            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indicesBuffer, gl.STATIC_DRAW);\r\n        }\r\n        mesh.geometry.VAO = VAO;\r\n        gl.bindVertexArray(null);\r\n        if (material.pbrMetallicRoughness.baseColorTexture) {\r\n            mesh.material.uniforms.baseColorTexture = gl.getUniformLocation(mesh.program, 'baseColorTexture');\r\n        }\r\n        if (material.pbrMetallicRoughness.metallicRoughnessTexture) {\r\n            mesh.material.uniforms.metallicRoughnessTexture = gl.getUniformLocation(mesh.program, 'metallicRoughnessTexture');\r\n        }\r\n        if (material.normalTexture) {\r\n            mesh.material.uniforms.normalTexture = gl.getUniformLocation(mesh.program, 'normalTexture');\r\n        }\r\n        if (material.occlusionTexture) {\r\n            mesh.material.uniforms.occlusionTexture = gl.getUniformLocation(mesh.program, 'occlusionTexture');\r\n        }\r\n        if (material.emissiveTexture) {\r\n            mesh.material.uniforms.emissiveTexture = gl.getUniformLocation(mesh.program, 'emissiveTexture');\r\n        }\r\n        return mesh;\r\n    }\r\n    walkByMesh(parent, name) {\r\n        const el = this.json.nodes[name];\r\n        let child;\r\n        if (el.camera !== undefined) {\r\n            const proj = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateProjection\"])(this.json.cameras[el.camera], this.aspect, this.zoom);\r\n            child = new _objects__WEBPACK_IMPORTED_MODULE_1__[\"Camera\"](name, parent);\r\n            child.props = this.json.cameras[el.camera];\r\n            child.setProjection(proj.elements);\r\n            this._camera = child;\r\n            this.updateCamera(this._camera);\r\n            this.cameras.push(child);\r\n        }\r\n        else {\r\n            if (el.isBone !== undefined) {\r\n                child = new _objects__WEBPACK_IMPORTED_MODULE_1__[\"Bone\"](name, parent);\r\n            }\r\n            else {\r\n                child = new _objects__WEBPACK_IMPORTED_MODULE_1__[\"Object3D\"](name, parent);\r\n            }\r\n        }\r\n        if (el.translation || el.rotation || el.scale) {\r\n            child.setPosition(el.translation, el.rotation, el.scale);\r\n        }\r\n        else if (el.matrix) {\r\n            child.setMatrix(el.matrix);\r\n        }\r\n        const m = new _matrix__WEBPACK_IMPORTED_MODULE_2__[\"Matrix4\"];\r\n        m.multiply(child.parent.matrixWorld);\r\n        m.multiply(child.matrix);\r\n        child.setMatrixWorld(m.elements);\r\n        parent.children.push(child);\r\n        parent = child;\r\n        if (el.mesh !== undefined) {\r\n            if (el.skin !== undefined) {\r\n                for (const join of this.skins[el.skin].jointNames) {\r\n                    Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"walk\"])(this.scene, this.buildBones.bind(this, join, this.skins[el.skin]));\r\n                }\r\n            }\r\n            parent.children.push(...this.json.meshes[el.mesh].primitives.map(this.buildPrim.bind(this, parent, this.json.meshes[el.mesh].name, el.skin, this.json.meshes[el.mesh].weights)));\r\n        }\r\n        if (el.children && el.children.length) {\r\n            el.children.forEach(this.walkByMesh.bind(this, parent));\r\n        }\r\n    }\r\n    calculateFov() {\r\n        let biggestMesh;\r\n        Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"walk\"])(this.scene, node => {\r\n            if (node instanceof _objects__WEBPACK_IMPORTED_MODULE_1__[\"Mesh\"]) {\r\n                if (!biggestMesh) {\r\n                    biggestMesh = node;\r\n                }\r\n                if (node.geometry.boundingSphere.radius > biggestMesh.geometry.boundingSphere.radius) {\r\n                    biggestMesh = node;\r\n                }\r\n            }\r\n        });\r\n        const a = Math.abs;\r\n        const min = biggestMesh.geometry.boundingSphere.min.elements;\r\n        const max = biggestMesh.geometry.boundingSphere.max.elements;\r\n        this._camera.modelXSize = Math.max(a(min[0]), a(min[2]), a(max[0]), a(max[2]), Math.sqrt(min[0] * min[0] + min[2] * min[2]), Math.sqrt(max[0] * max[0] + max[2] * max[2]));\r\n        this._camera.modelYSize = Math.max(a(min[1]), a(min[2]), a(max[1]), a(max[2]));\r\n        this._camera.modelSize = Math.max(this._camera.modelYSize, this._camera.modelXSize);\r\n        this.resize();\r\n    }\r\n    buildMesh() {\r\n        this.json.scenes[this.json.scene !== undefined ? this.json.scene : 0].nodes.forEach(n => {\r\n            if (this.json.nodes[n].children && this.json.nodes[n].children.length) {\r\n                this.walkByMesh(this.scene, n);\r\n            }\r\n            if (this.json.nodes[n].mesh !== undefined) {\r\n                this.walkByMesh(this.scene, n);\r\n            }\r\n            if (this.json.nodes[n].camera !== undefined) {\r\n                this.walkByMesh(this.scene, n);\r\n            }\r\n        });\r\n        this.calculateFov();\r\n        const planes = Object(_matrix__WEBPACK_IMPORTED_MODULE_2__[\"Frustum\"])(this._camera.getViewProjMatrix());\r\n        Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"walk\"])(this.scene, mesh => {\r\n            if (mesh instanceof _objects__WEBPACK_IMPORTED_MODULE_1__[\"SkinnedMesh\"]) {\r\n                mesh.bones = this.skins[mesh.skin].bones;\r\n                mesh.boneInverses = this.skins[mesh.skin].boneInverses;\r\n                const jointMatrix = mesh.getJointMatrix();\r\n                const matrices = new Float32Array(jointMatrix.length * 16);\r\n                let i = 0;\r\n                for (const j of jointMatrix) {\r\n                    matrices.set(j.elements, 0 + 16 * i);\r\n                    i++;\r\n                }\r\n                const uIndex = gl.getUniformBlockIndex(mesh.program, 'Skin');\r\n                gl.uniformBlockBinding(mesh.program, uIndex, 2);\r\n                const UBO = gl.createBuffer();\r\n                gl.bindBuffer(gl.UNIFORM_BUFFER, UBO);\r\n                gl.bufferData(gl.UNIFORM_BUFFER, matrices, gl.DYNAMIC_DRAW);\r\n                mesh.geometry.SKIN = UBO;\r\n                gl.bindBuffer(gl.UNIFORM_BUFFER, null);\r\n            }\r\n            if (mesh instanceof _objects__WEBPACK_IMPORTED_MODULE_1__[\"Mesh\"]) {\r\n                const materials = new Float32Array(12);\r\n                materials.set(mesh.material.pbrMetallicRoughness.baseColorFactor || [0.8, 0.8, 0.8, 1.0]);\r\n                materials.set([this._camera.matrixWorld.elements[12], this._camera.matrixWorld.elements[13], this._camera.matrixWorld.elements[14]], 4);\r\n                materials.set([this._camera.matrixWorld.elements[12], this._camera.matrixWorld.elements[13], this._camera.matrixWorld.elements[14]], 8);\r\n                const mIndex = gl.getUniformBlockIndex(mesh.program, 'Material');\r\n                gl.uniformBlockBinding(mesh.program, mIndex, 1);\r\n                const mUBO = gl.createBuffer();\r\n                gl.bindBuffer(gl.UNIFORM_BUFFER, mUBO);\r\n                gl.bufferData(gl.UNIFORM_BUFFER, materials, gl.STATIC_DRAW);\r\n                mesh.material.UBO = mUBO;\r\n                const normalMatrix = new _matrix__WEBPACK_IMPORTED_MODULE_2__[\"Matrix4\"](mesh.matrixWorld);\r\n                normalMatrix.invert().transpose();\r\n                const matrices = new Float32Array(64);\r\n                matrices.set(mesh.matrixWorld.elements, 0);\r\n                matrices.set(normalMatrix.elements, 16);\r\n                matrices.set(this._camera.matrixWorldInvert.elements, 32);\r\n                matrices.set(this._camera.projection.elements, 48);\r\n                const uIndex = gl.getUniformBlockIndex(mesh.program, 'Matrices');\r\n                gl.uniformBlockBinding(mesh.program, uIndex, 0);\r\n                const UBO = gl.createBuffer();\r\n                gl.bindBuffer(gl.UNIFORM_BUFFER, UBO);\r\n                gl.bufferData(gl.UNIFORM_BUFFER, matrices, gl.DYNAMIC_DRAW);\r\n                mesh.geometry.UBO = UBO;\r\n                gl.bindBuffer(gl.UNIFORM_BUFFER, null);\r\n                if (mesh.isVisible(planes)) {\r\n                    if (mesh.material.alphaMode) {\r\n                        this.scene.transparentChildren.push(mesh);\r\n                    }\r\n                    else {\r\n                        this.scene.opaqueChildren.push(mesh);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        this.scene.transparentChildren.sort((a, b) => b.distance - a.distance);\r\n        return true;\r\n    }\r\n    buildAnimation() {\r\n        if (!this.json.animations) {\r\n            return true;\r\n        }\r\n        for (const animation of this.json.animations) {\r\n            for (const channel of animation.channels) {\r\n                const sampler = animation.samplers[channel.sampler];\r\n                if (sampler) {\r\n                    const { target } = channel;\r\n                    const name = target.node;\r\n                    const input = animation.parameters !== undefined ? animation.parameters[sampler.input] : sampler.input;\r\n                    const output = animation.parameters !== undefined ? animation.parameters[sampler.output] : sampler.output;\r\n                    const inputAccessor = this.json.accessors[input];\r\n                    const outputAccessor = this.json.accessors[output];\r\n                    const inputBuffer = this.json.bufferViews[inputAccessor.bufferView];\r\n                    const outputBuffer = this.json.bufferViews[outputAccessor.bufferView];\r\n                    const inputArray = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"buildArray\"])(this.arrayBuffer[inputBuffer.buffer], inputAccessor.componentType, Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateOffset\"])(inputBuffer.byteOffset, inputAccessor.byteOffset), Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getDataType\"])(inputAccessor.type) * inputAccessor.count);\r\n                    const outputArray = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"buildArray\"])(this.arrayBuffer[outputBuffer.buffer], outputAccessor.componentType, Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateOffset\"])(outputBuffer.byteOffset, outputAccessor.byteOffset), Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getDataType\"])(outputAccessor.type) * outputAccessor.count);\r\n                    const component = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getAnimationComponent\"])(target.path);\r\n                    const keys = [];\r\n                    for (let i = 0; i < inputArray.length; i++) {\r\n                        const firstT = inputArray[i];\r\n                        const firstV = outputArray.slice(i * component, (i + 1) * component);\r\n                        keys.push({\r\n                            time: firstT,\r\n                            value: firstV\r\n                        });\r\n                    }\r\n                    const meshes = [];\r\n                    Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"walk\"])(this.scene, node => {\r\n                        if (node.name === name) {\r\n                            if (target.path === 'weights' && node instanceof _objects__WEBPACK_IMPORTED_MODULE_1__[\"Object3D\"]) {\r\n                                node = node.children[0];\r\n                            }\r\n                            meshes.push(node);\r\n                        }\r\n                    });\r\n                    if (meshes.length) {\r\n                        this.tracks.push({\r\n                            stoped: false,\r\n                            meshes: meshes,\r\n                            type: target.path,\r\n                            name: `${meshes[0].name}.${target.path}`,\r\n                            keys: keys,\r\n                            interpolation: sampler.interpolation\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    buildSkin() {\r\n        if (!this.json.skins) {\r\n            return true;\r\n        }\r\n        for (const skin of this.json.skins) {\r\n            const acc = this.json.accessors[skin.inverseBindMatrices];\r\n            const buffer = this.json.bufferViews[acc.bufferView];\r\n            const array = Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"buildArray\"])(this.arrayBuffer[buffer.buffer], acc.componentType, Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"calculateOffset\"])(buffer.byteOffset, acc.byteOffset), Object(_utils__WEBPACK_IMPORTED_MODULE_0__[\"getDataType\"])(acc.type) * acc.count);\r\n            const v = {\r\n                jointNames: skin.joints,\r\n                inverseBindMatrices: array,\r\n                bones: [],\r\n                boneInverses: []\r\n            };\r\n            let i = 0;\r\n            for (const join of v.jointNames) {\r\n                //walk(this.scene, this.buildBones.bind(this, join, v));\r\n                this.json.nodes[join].isBone = true;\r\n                const m = v.inverseBindMatrices;\r\n                const mat = new _matrix__WEBPACK_IMPORTED_MODULE_2__[\"Matrix4\"]().set(m.slice(i * 16, (i + 1) * 16));\r\n                v.boneInverses.push(mat);\r\n                i++;\r\n            }\r\n            this.skins.push(v);\r\n        }\r\n        return true;\r\n    }\r\n    buildBones(join, v, node) {\r\n        if (node.name === join) {\r\n            v.bones.push(node);\r\n        }\r\n    }\r\n    getJson() {\r\n        return fetch(this.url)\r\n            .then(res => res.json())\r\n            .then(j => {\r\n            for (const key in j.buffers) {\r\n                this.scene.bin.push(j.buffers[key].uri);\r\n            }\r\n            this.json = j;\r\n            return true;\r\n        });\r\n    }\r\n    initTextures() {\r\n        if (!this.json.textures) {\r\n            return true;\r\n        }\r\n        const samplers = this.json.samplers || [{}];\r\n        this.samplers = samplers.map(s => {\r\n            const sampler = gl.createSampler();\r\n            gl.samplerParameteri(sampler, gl.TEXTURE_MIN_FILTER, s.minFilter || 9986);\r\n            gl.samplerParameteri(sampler, gl.TEXTURE_MAG_FILTER, s.magFilter || 9729);\r\n            gl.samplerParameteri(sampler, gl.TEXTURE_WRAP_S, s.wrapS || 10497);\r\n            gl.samplerParameteri(sampler, gl.TEXTURE_WRAP_T, s.wrapT || 10497);\r\n            return sampler;\r\n        });\r\n        const promiseArr = this.json.textures.map(t => {\r\n            return new Promise((resolve, reject) => {\r\n                const sampler = this.samplers[t.sampler !== undefined ? t.sampler : 0];\r\n                const source = this.json.images[t.source];\r\n                const image = new Image();\r\n                image.onload = () => {\r\n                    resolve(this.handleTextureLoaded(sampler, image));\r\n                };\r\n                image.onerror = err => {\r\n                    reject(err);\r\n                };\r\n                image.crossOrigin = 'anonymous';\r\n                image.src = `${this.host}${source.uri}`;\r\n            });\r\n        });\r\n        return Promise.all(promiseArr)\r\n            .then(textures => {\r\n            this.textures = textures;\r\n            return true;\r\n        });\r\n    }\r\n    handleTextureLoaded(sampler, image) {\r\n        const t = {\r\n            image: image.src.substr(image.src.lastIndexOf('/')),\r\n            data: gl.createTexture(),\r\n            count: sceneTextureCount\r\n        };\r\n        gl.activeTexture(gl[`TEXTURE${sceneTextureCount}`]);\r\n        gl.bindTexture(gl.TEXTURE_2D, t.data);\r\n        gl.bindSampler(0, sampler);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        sceneTextureCount++;\r\n        return t;\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGFyc2UudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZWRjdWJlLy4vc3JjL3BhcnNlLnRzPzU5MGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYnVpbGRBcnJheSwgZ2V0RGF0YVR5cGUsIHdhbGssIGdldEFuaW1hdGlvbkNvbXBvbmVudCwgY2FsY3VsYXRlUHJvamVjdGlvbiwgY29tcGlsZVNoYWRlciwgY2FsY3VsYXRlT2Zmc2V0LCBnZXRBdHRyaWJ1dGVJbmRleCwgY2FsY3VsYXRlQmlub3JtYWxzIH0gZnJvbSAnLi91dGlscyc7XHJcbmltcG9ydCB7IE1lc2gsIFNraW5uZWRNZXNoLCBCb25lLCBDYW1lcmEsIE9iamVjdDNEIH0gZnJvbSAnLi9vYmplY3RzJztcclxuaW1wb3J0IHsgTWF0cml4NCwgRnJ1c3R1bSB9IGZyb20gJy4vbWF0cml4JztcclxuaW1wb3J0IHZlcnRleFNoYWRlciBmcm9tICcuL3NoYWRlcnMvdmVydGV4Lmdsc2wnO1xyXG5pbXBvcnQgZnJhZ21lbnRTaGFkZXIgZnJvbSAnLi9zaGFkZXJzL2ZyYWdtZW50Lmdsc2wnO1xyXG5sZXQgZ2w7XHJcbmxldCBzY2VuZVRleHR1cmVDb3VudCA9IDA7XHJcbmV4cG9ydCBjbGFzcyBQYXJzZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcih1cmwpIHtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLmhvc3QgPSB1cmwuc3Vic3RyKDAsIHVybC5sYXN0SW5kZXhPZignLycpICsgMSk7XHJcbiAgICAgICAgdGhpcy50cmFja3MgPSBbXTtcclxuICAgICAgICB0aGlzLnNraW5zID0gW107XHJcbiAgICAgICAgdGhpcy50ZXh0dXJlcyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5zYW1wbGVycyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hcnJheUJ1ZmZlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jYW1lcmFzID0gW107XHJcbiAgICAgICAgdGhpcy5wcm9ncmFtcyA9IHt9O1xyXG4gICAgfVxyXG4gICAgc2V0U2NlbmUoc2NlbmUpIHtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICB9XHJcbiAgICBzZXRHbChnKSB7XHJcbiAgICAgICAgZ2wgPSBnO1xyXG4gICAgfVxyXG4gICAgc2V0Q2FtZXJhKGNhbWVyYSwgYXNwZWN0LCB6b29tKSB7XHJcbiAgICAgICAgdGhpcy5fY2FtZXJhID0gY2FtZXJhO1xyXG4gICAgICAgIHRoaXMuYXNwZWN0ID0gYXNwZWN0O1xyXG4gICAgICAgIHRoaXMuem9vbSA9IHpvb207XHJcbiAgICB9XHJcbiAgICBzZXRDYW52YXMoY2FudmFzKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XHJcbiAgICB9XHJcbiAgICBzZXRSZXNpemUocmVzaXplKSB7XHJcbiAgICAgICAgdGhpcy5yZXNpemUgPSByZXNpemU7XHJcbiAgICB9XHJcbiAgICBzZXRVcGRhdGVDYW1lcmEodXBkYXRlQ2FtZXJhKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDYW1lcmEgPSB1cGRhdGVDYW1lcmE7XHJcbiAgICB9XHJcbiAgICBnZXQgd2lkdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLm9mZnNldFdpZHRoO1xyXG4gICAgfVxyXG4gICAgZ2V0QnVmZmVyKCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbCh0aGlzLnNjZW5lLmJpbi5tYXAodXJsID0+IGZldGNoKGAke3RoaXMuaG9zdH0ke3VybH1gKS50aGVuKHJlcyA9PiByZXMuYXJyYXlCdWZmZXIoKSkpKVxyXG4gICAgICAgICAgICAudGhlbihidWZmZXJzID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hcnJheUJ1ZmZlciA9IGJ1ZmZlcnM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjb21waWxlU2hhZGVyKHZlcnRleFNoYWRlciwgZnJhZ21lbnRTaGFkZXIpIHtcclxuICAgICAgICBjb25zdCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xyXG4gICAgICAgIGNvbXBpbGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUiwgdmVydGV4U2hhZGVyLCBwcm9ncmFtKTtcclxuICAgICAgICBjb21waWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUiwgZnJhZ21lbnRTaGFkZXIsIHByb2dyYW0pO1xyXG4gICAgICAgIGdsLmxpbmtQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgICAgIHJldHVybiBwcm9ncmFtO1xyXG4gICAgfVxyXG4gICAgYnVpbGRQcmltKHBhcmVudCwgbmFtZSwgc2tpbiwgd2VpZ2h0cywgcCkge1xyXG4gICAgICAgIGNvbnN0IGluZGljZXNBY2Nlc3NvciA9IHRoaXMuanNvbi5hY2Nlc3NvcnNbcC5pbmRpY2VzXTtcclxuICAgICAgICBjb25zdCB2ZXJ0ZXhBY2Nlc3NvciA9IG5ldyBNYXA7XHJcbiAgICAgICAgZm9yIChjb25zdCBhIGluIHAuYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICB2ZXJ0ZXhBY2Nlc3Nvci5zZXQoYSwgdGhpcy5qc29uLmFjY2Vzc29yc1twLmF0dHJpYnV0ZXNbYV1dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IFtdO1xyXG4gICAgICAgIGlmIChwLnRhcmdldHMpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCB0YXJnZXQgb2YgcC50YXJnZXRzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2ZXJ0ZXhBY2MgPSB7fTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYSBpbiB0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXhBY2NbYV0gPSB0aGlzLmpzb24uYWNjZXNzb3JzW3RhcmdldFthXV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjZXNzb3IgPSB2ZXJ0ZXhBY2NbYV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyVmlldyA9IHRoaXMuanNvbi5idWZmZXJWaWV3c1thY2Nlc3Nvci5idWZmZXJWaWV3XTtcclxuICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXhBY2NbYV0gPSBidWlsZEFycmF5KHRoaXMuYXJyYXlCdWZmZXJbYnVmZmVyVmlldy5idWZmZXJdLCBhY2Nlc3Nvci5jb21wb25lbnRUeXBlLCBjYWxjdWxhdGVPZmZzZXQoYnVmZmVyVmlldy5ieXRlT2Zmc2V0LCBhY2Nlc3Nvci5ieXRlT2Zmc2V0KSwgZ2V0RGF0YVR5cGUoYWNjZXNzb3IudHlwZSkgKiBhY2Nlc3Nvci5jb3VudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRzLnB1c2godmVydGV4QWNjKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBtYXRlcmlhbCA9IHAubWF0ZXJpYWwgIT09IHVuZGVmaW5lZCA/IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5qc29uLm1hdGVyaWFsc1twLm1hdGVyaWFsXSkpIDogeyBwYnJNZXRhbGxpY1JvdWdobmVzczogeyBiYXNlQ29sb3JGYWN0b3I6IFswLjgsIDAuOCwgMC44LCAxLjBdIH0gfTtcclxuICAgICAgICBjb25zdCBkZWZpbmVzID0gW107XHJcbiAgICAgICAgaWYgKG1hdGVyaWFsLnBick1ldGFsbGljUm91Z2huZXNzLm1ldGFsbGljUm91Z2huZXNzVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBtYXRlcmlhbC5wYnJNZXRhbGxpY1JvdWdobmVzcy5tZXRhbGxpY1JvdWdobmVzc1RleHR1cmUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRleHR1cmVzW21hdGVyaWFsLnBick1ldGFsbGljUm91Z2huZXNzLm1ldGFsbGljUm91Z2huZXNzVGV4dHVyZS5pbmRleF0pO1xyXG4gICAgICAgICAgICBkZWZpbmVzLnB1c2goeyBuYW1lOiAnVVNFX1BCUicgfSk7XHJcbiAgICAgICAgICAgIGRlZmluZXMucHVzaCh7IG5hbWU6ICdNRVRBTFJPVUdITkVTU01BUCcgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYXRlcmlhbC5ub3JtYWxUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLm5vcm1hbFRleHR1cmUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRleHR1cmVzW21hdGVyaWFsLm5vcm1hbFRleHR1cmUuaW5kZXhdKTtcclxuICAgICAgICAgICAgZGVmaW5lcy5wdXNoKHsgbmFtZTogJ05PUk1BTE1BUCcgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYXRlcmlhbC5vY2NsdXNpb25UZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLm9jY2x1c2lvblRleHR1cmUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRleHR1cmVzW21hdGVyaWFsLm9jY2x1c2lvblRleHR1cmUuaW5kZXhdKTtcclxuICAgICAgICAgICAgZGVmaW5lcy5wdXNoKHsgbmFtZTogJ09DQ0xVU0lPTk1BUCcgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYXRlcmlhbC5wYnJNZXRhbGxpY1JvdWdobmVzcy5iYXNlQ29sb3JUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLnBick1ldGFsbGljUm91Z2huZXNzLmJhc2VDb2xvclRleHR1cmUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRleHR1cmVzW21hdGVyaWFsLnBick1ldGFsbGljUm91Z2huZXNzLmJhc2VDb2xvclRleHR1cmUuaW5kZXhdKTtcclxuICAgICAgICAgICAgZGVmaW5lcy5wdXNoKHsgbmFtZTogJ0JBU0VDT0xPUlRFWFRVUkUnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWF0ZXJpYWwuZW1pc3NpdmVUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLmVtaXNzaXZlVGV4dHVyZSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudGV4dHVyZXNbbWF0ZXJpYWwuZW1pc3NpdmVUZXh0dXJlLmluZGV4XSk7XHJcbiAgICAgICAgICAgIGRlZmluZXMucHVzaCh7IG5hbWU6ICdFTUlTU0lWRU1BUCcgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChza2luICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgZGVmaW5lcy5wdXNoKHsgbmFtZTogJ0pPSU5UTlVNQkVSJywgdmFsdWU6IHRoaXMuc2tpbnNbc2tpbl0uam9pbnROYW1lcy5sZW5ndGggfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwLmF0dHJpYnV0ZXMuVEFOR0VOVCB8fCBtYXRlcmlhbC5ub3JtYWxUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIGRlZmluZXMucHVzaCh7IG5hbWU6ICdUQU5HRU5UJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHByb2dyYW07XHJcbiAgICAgICAgaWYgKHRoaXMucHJvZ3JhbXNbZGVmaW5lcy5tYXAoZGVmaW5lID0+IGRlZmluZS5uYW1lKS5qb2luKCcnKV0pIHtcclxuICAgICAgICAgICAgcHJvZ3JhbSA9IHRoaXMucHJvZ3JhbXNbZGVmaW5lcy5tYXAoZGVmaW5lID0+IGRlZmluZS5uYW1lKS5qb2luKCcnKV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBkZWZpbmVTdHIgPSBkZWZpbmVzLm1hcChkZWZpbmUgPT4gYCNkZWZpbmUgJHtkZWZpbmUubmFtZX0gJHtkZWZpbmUudmFsdWUgfHwgMX1gICsgJ1xcbicpLmpvaW4oJycpO1xyXG4gICAgICAgICAgICBwcm9ncmFtID0gdGhpcy5jb21waWxlU2hhZGVyKHZlcnRleFNoYWRlci5yZXBsYWNlKC9cXG4vLCBgXFxuJHtkZWZpbmVTdHJ9YCksIGZyYWdtZW50U2hhZGVyLnJlcGxhY2UoL1xcbi8sIGBcXG4ke2RlZmluZVN0cn1gKSk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvZ3JhbXNbZGVmaW5lcy5tYXAoZGVmaW5lID0+IGRlZmluZS5uYW1lKS5qb2luKCcnKV0gPSBwcm9ncmFtO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgaW5kaWNlc0J1ZmZlcjtcclxuICAgICAgICBpZiAoaW5kaWNlc0FjY2Vzc29yKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlclZpZXcgPSB0aGlzLmpzb24uYnVmZmVyVmlld3NbaW5kaWNlc0FjY2Vzc29yLmJ1ZmZlclZpZXddO1xyXG4gICAgICAgICAgICBpbmRpY2VzQnVmZmVyID0gYnVpbGRBcnJheSh0aGlzLmFycmF5QnVmZmVyW2J1ZmZlclZpZXcuYnVmZmVyXSwgaW5kaWNlc0FjY2Vzc29yLmNvbXBvbmVudFR5cGUsIGNhbGN1bGF0ZU9mZnNldChidWZmZXJWaWV3LmJ5dGVPZmZzZXQsIGluZGljZXNBY2Nlc3Nvci5ieXRlT2Zmc2V0KSwgZ2V0RGF0YVR5cGUoaW5kaWNlc0FjY2Vzc29yLnR5cGUpICogaW5kaWNlc0FjY2Vzc29yLmNvdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYm91bmRpbmdCb3ggPSB7XHJcbiAgICAgICAgICAgIG1pbjogdmVydGV4QWNjZXNzb3IuZ2V0KCdQT1NJVElPTicpLm1pbixcclxuICAgICAgICAgICAgbWF4OiB2ZXJ0ZXhBY2Nlc3Nvci5nZXQoJ1BPU0lUSU9OJykubWF4XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCB2ZXJ0ZXhCdWZmZXJzID0ge307XHJcbiAgICAgICAgZm9yIChjb25zdCBrIG9mIHZlcnRleEFjY2Vzc29yLmtleXMoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NvciA9IHZlcnRleEFjY2Vzc29yLmdldChrKTtcclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyVmlldyA9IHRoaXMuanNvbi5idWZmZXJWaWV3c1thY2Nlc3Nvci5idWZmZXJWaWV3XTtcclxuICAgICAgICAgICAgdmVydGV4QnVmZmVyc1trXSA9IGJ1aWxkQXJyYXkodGhpcy5hcnJheUJ1ZmZlcltidWZmZXJWaWV3LmJ1ZmZlcl0sIGFjY2Vzc29yLmNvbXBvbmVudFR5cGUsIGNhbGN1bGF0ZU9mZnNldChidWZmZXJWaWV3LmJ5dGVPZmZzZXQsIGFjY2Vzc29yLmJ5dGVPZmZzZXQpLCBnZXREYXRhVHlwZShhY2Nlc3Nvci50eXBlKSAqIGFjY2Vzc29yLmNvdW50LCBidWZmZXJWaWV3LmJ5dGVTdHJpZGUsIGFjY2Vzc29yLmNvdW50KTtcclxuICAgICAgICAgICAgaWYgKHAudGFyZ2V0cyAmJiBrIGluIHAudGFyZ2V0c1swXSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBnZW9tZXRyeSA9IHZlcnRleEJ1ZmZlcnNba107XHJcbiAgICAgICAgICAgICAgICB2ZXJ0ZXhCdWZmZXJzW2tdID0gbmV3IEZsb2F0MzJBcnJheShnZW9tZXRyeS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2ZXJ0ZXhCdWZmZXJzW2tdLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGsgPT09ICdUQU5HRU5UJyAmJiAoaSArIDEpICUgNCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZlcnRleEJ1ZmZlcnNba11baV0gPSBnZW9tZXRyeVtpXSArIHdlaWdodHNbMF0gKiB0YXJnZXRzWzBdW2tdW2kgLSBvZmZzZXRdICsgd2VpZ2h0c1sxXSAqIHRhcmdldHNbMV1ba11baSAtIG9mZnNldF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1hdGVyaWFsLm5vcm1hbFRleHR1cmUgJiYgcC5hdHRyaWJ1dGVzLlRBTkdFTlQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2ZXJ0ZXhCdWZmZXJzLlRBTkdFTlQgPSBjYWxjdWxhdGVCaW5vcm1hbHMoaW5kaWNlc0J1ZmZlciwgdmVydGV4QnVmZmVycy5QT1NJVElPTiwgdmVydGV4QnVmZmVycy5OT1JNQUwsIHZlcnRleEJ1ZmZlcnMuVEVYQ09PUkRfMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG1lc2ggPSBza2luICE9PSB1bmRlZmluZWQgPyBuZXcgU2tpbm5lZE1lc2gobmFtZSwgcGFyZW50KS5zZXRTa2luKHNraW4pIDogbmV3IE1lc2gobmFtZSwgcGFyZW50KTtcclxuICAgICAgICBtZXNoLnNldFByb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICAgICAgbWVzaC5zZXRNb2RlKHAubW9kZSk7XHJcbiAgICAgICAgbWVzaC5zZXRNYXRlcmlhbChtYXRlcmlhbCk7XHJcbiAgICAgICAgbWVzaC5zZXRBdHRyaWJ1dGVzKHZlcnRleEJ1ZmZlcnMpO1xyXG4gICAgICAgIG1lc2guc2V0SW5kaWNlc0J1ZmZlcihpbmRpY2VzQnVmZmVyKTtcclxuICAgICAgICBtZXNoLnNldEJvdW5kaW5nQm94KGJvdW5kaW5nQm94KTtcclxuICAgICAgICBtZXNoLnNldFRhcmdldHModGFyZ2V0cyk7XHJcbiAgICAgICAgY29uc3QgbSA9IG5ldyBNYXRyaXg0O1xyXG4gICAgICAgIG0ubXVsdGlwbHkobWVzaC5wYXJlbnQubWF0cml4V29ybGQpO1xyXG4gICAgICAgIG0ubXVsdGlwbHkobWVzaC5tYXRyaXgpO1xyXG4gICAgICAgIG1lc2guc2V0TWF0cml4V29ybGQobS5lbGVtZW50cyk7XHJcbiAgICAgICAgY29uc3QgVkFPID0gZ2wuY3JlYXRlVmVydGV4QXJyYXkoKTtcclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkoVkFPKTtcclxuICAgICAgICBmb3IgKGNvbnN0IGsgaW4gdmVydGV4QnVmZmVycykge1xyXG4gICAgICAgICAgICBjb25zdCBWQk8gPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIFZCTyk7XHJcbiAgICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0ZXhCdWZmZXJzW2tdLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZ2V0QXR0cmlidXRlSW5kZXgoayk7XHJcbiAgICAgICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGluZGV4WzBdKTtcclxuICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihpbmRleFswXSwgaW5kZXhbMV0sIGluZGV4WzJdLCBmYWxzZSwgMCwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbmRpY2VzQnVmZmVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFZCTyA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBWQk8pO1xyXG4gICAgICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpbmRpY2VzQnVmZmVyLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1lc2guZ2VvbWV0cnkuVkFPID0gVkFPO1xyXG4gICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShudWxsKTtcclxuICAgICAgICBpZiAobWF0ZXJpYWwucGJyTWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBtZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhc2VDb2xvclRleHR1cmUgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obWVzaC5wcm9ncmFtLCAnYmFzZUNvbG9yVGV4dHVyZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWF0ZXJpYWwucGJyTWV0YWxsaWNSb3VnaG5lc3MubWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwudW5pZm9ybXMubWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKG1lc2gucHJvZ3JhbSwgJ21ldGFsbGljUm91Z2huZXNzVGV4dHVyZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWF0ZXJpYWwubm9ybWFsVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBtZXNoLm1hdGVyaWFsLnVuaWZvcm1zLm5vcm1hbFRleHR1cmUgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obWVzaC5wcm9ncmFtLCAnbm9ybWFsVGV4dHVyZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWF0ZXJpYWwub2NjbHVzaW9uVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBtZXNoLm1hdGVyaWFsLnVuaWZvcm1zLm9jY2x1c2lvblRleHR1cmUgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24obWVzaC5wcm9ncmFtLCAnb2NjbHVzaW9uVGV4dHVyZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWF0ZXJpYWwuZW1pc3NpdmVUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZW1pc3NpdmVUZXh0dXJlID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKG1lc2gucHJvZ3JhbSwgJ2VtaXNzaXZlVGV4dHVyZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbWVzaDtcclxuICAgIH1cclxuICAgIHdhbGtCeU1lc2gocGFyZW50LCBuYW1lKSB7XHJcbiAgICAgICAgY29uc3QgZWwgPSB0aGlzLmpzb24ubm9kZXNbbmFtZV07XHJcbiAgICAgICAgbGV0IGNoaWxkO1xyXG4gICAgICAgIGlmIChlbC5jYW1lcmEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9qID0gY2FsY3VsYXRlUHJvamVjdGlvbih0aGlzLmpzb24uY2FtZXJhc1tlbC5jYW1lcmFdLCB0aGlzLmFzcGVjdCwgdGhpcy56b29tKTtcclxuICAgICAgICAgICAgY2hpbGQgPSBuZXcgQ2FtZXJhKG5hbWUsIHBhcmVudCk7XHJcbiAgICAgICAgICAgIGNoaWxkLnByb3BzID0gdGhpcy5qc29uLmNhbWVyYXNbZWwuY2FtZXJhXTtcclxuICAgICAgICAgICAgY2hpbGQuc2V0UHJvamVjdGlvbihwcm9qLmVsZW1lbnRzKTtcclxuICAgICAgICAgICAgdGhpcy5fY2FtZXJhID0gY2hpbGQ7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FtZXJhKHRoaXMuX2NhbWVyYSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhcy5wdXNoKGNoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChlbC5pc0JvbmUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQgPSBuZXcgQm9uZShuYW1lLCBwYXJlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQgPSBuZXcgT2JqZWN0M0QobmFtZSwgcGFyZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZWwudHJhbnNsYXRpb24gfHwgZWwucm90YXRpb24gfHwgZWwuc2NhbGUpIHtcclxuICAgICAgICAgICAgY2hpbGQuc2V0UG9zaXRpb24oZWwudHJhbnNsYXRpb24sIGVsLnJvdGF0aW9uLCBlbC5zY2FsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVsLm1hdHJpeCkge1xyXG4gICAgICAgICAgICBjaGlsZC5zZXRNYXRyaXgoZWwubWF0cml4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbSA9IG5ldyBNYXRyaXg0O1xyXG4gICAgICAgIG0ubXVsdGlwbHkoY2hpbGQucGFyZW50Lm1hdHJpeFdvcmxkKTtcclxuICAgICAgICBtLm11bHRpcGx5KGNoaWxkLm1hdHJpeCk7XHJcbiAgICAgICAgY2hpbGQuc2V0TWF0cml4V29ybGQobS5lbGVtZW50cyk7XHJcbiAgICAgICAgcGFyZW50LmNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG4gICAgICAgIHBhcmVudCA9IGNoaWxkO1xyXG4gICAgICAgIGlmIChlbC5tZXNoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKGVsLnNraW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBqb2luIG9mIHRoaXMuc2tpbnNbZWwuc2tpbl0uam9pbnROYW1lcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdhbGsodGhpcy5zY2VuZSwgdGhpcy5idWlsZEJvbmVzLmJpbmQodGhpcywgam9pbiwgdGhpcy5za2luc1tlbC5za2luXSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKC4uLnRoaXMuanNvbi5tZXNoZXNbZWwubWVzaF0ucHJpbWl0aXZlcy5tYXAodGhpcy5idWlsZFByaW0uYmluZCh0aGlzLCBwYXJlbnQsIHRoaXMuanNvbi5tZXNoZXNbZWwubWVzaF0ubmFtZSwgZWwuc2tpbiwgdGhpcy5qc29uLm1lc2hlc1tlbC5tZXNoXS53ZWlnaHRzKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZWwuY2hpbGRyZW4gJiYgZWwuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGVsLmNoaWxkcmVuLmZvckVhY2godGhpcy53YWxrQnlNZXNoLmJpbmQodGhpcywgcGFyZW50KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2FsY3VsYXRlRm92KCkge1xyXG4gICAgICAgIGxldCBiaWdnZXN0TWVzaDtcclxuICAgICAgICB3YWxrKHRoaXMuc2NlbmUsIG5vZGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIE1lc2gpIHtcclxuICAgICAgICAgICAgICAgIGlmICghYmlnZ2VzdE1lc2gpIHtcclxuICAgICAgICAgICAgICAgICAgICBiaWdnZXN0TWVzaCA9IG5vZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPiBiaWdnZXN0TWVzaC5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZS5yYWRpdXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBiaWdnZXN0TWVzaCA9IG5vZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBhID0gTWF0aC5hYnM7XHJcbiAgICAgICAgY29uc3QgbWluID0gYmlnZ2VzdE1lc2guZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUubWluLmVsZW1lbnRzO1xyXG4gICAgICAgIGNvbnN0IG1heCA9IGJpZ2dlc3RNZXNoLmdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLm1heC5lbGVtZW50cztcclxuICAgICAgICB0aGlzLl9jYW1lcmEubW9kZWxYU2l6ZSA9IE1hdGgubWF4KGEobWluWzBdKSwgYShtaW5bMl0pLCBhKG1heFswXSksIGEobWF4WzJdKSwgTWF0aC5zcXJ0KG1pblswXSAqIG1pblswXSArIG1pblsyXSAqIG1pblsyXSksIE1hdGguc3FydChtYXhbMF0gKiBtYXhbMF0gKyBtYXhbMl0gKiBtYXhbMl0pKTtcclxuICAgICAgICB0aGlzLl9jYW1lcmEubW9kZWxZU2l6ZSA9IE1hdGgubWF4KGEobWluWzFdKSwgYShtaW5bMl0pLCBhKG1heFsxXSksIGEobWF4WzJdKSk7XHJcbiAgICAgICAgdGhpcy5fY2FtZXJhLm1vZGVsU2l6ZSA9IE1hdGgubWF4KHRoaXMuX2NhbWVyYS5tb2RlbFlTaXplLCB0aGlzLl9jYW1lcmEubW9kZWxYU2l6ZSk7XHJcbiAgICAgICAgdGhpcy5yZXNpemUoKTtcclxuICAgIH1cclxuICAgIGJ1aWxkTWVzaCgpIHtcclxuICAgICAgICB0aGlzLmpzb24uc2NlbmVzW3RoaXMuanNvbi5zY2VuZSAhPT0gdW5kZWZpbmVkID8gdGhpcy5qc29uLnNjZW5lIDogMF0ubm9kZXMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuanNvbi5ub2Rlc1tuXS5jaGlsZHJlbiAmJiB0aGlzLmpzb24ubm9kZXNbbl0uY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndhbGtCeU1lc2godGhpcy5zY2VuZSwgbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuanNvbi5ub2Rlc1tuXS5tZXNoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMud2Fsa0J5TWVzaCh0aGlzLnNjZW5lLCBuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5qc29uLm5vZGVzW25dLmNhbWVyYSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndhbGtCeU1lc2godGhpcy5zY2VuZSwgbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUZvdigpO1xyXG4gICAgICAgIGNvbnN0IHBsYW5lcyA9IEZydXN0dW0odGhpcy5fY2FtZXJhLmdldFZpZXdQcm9qTWF0cml4KCkpO1xyXG4gICAgICAgIHdhbGsodGhpcy5zY2VuZSwgbWVzaCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChtZXNoIGluc3RhbmNlb2YgU2tpbm5lZE1lc2gpIHtcclxuICAgICAgICAgICAgICAgIG1lc2guYm9uZXMgPSB0aGlzLnNraW5zW21lc2guc2tpbl0uYm9uZXM7XHJcbiAgICAgICAgICAgICAgICBtZXNoLmJvbmVJbnZlcnNlcyA9IHRoaXMuc2tpbnNbbWVzaC5za2luXS5ib25lSW52ZXJzZXM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBqb2ludE1hdHJpeCA9IG1lc2guZ2V0Sm9pbnRNYXRyaXgoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1hdHJpY2VzID0gbmV3IEZsb2F0MzJBcnJheShqb2ludE1hdHJpeC5sZW5ndGggKiAxNik7XHJcbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGogb2Ygam9pbnRNYXRyaXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXRyaWNlcy5zZXQoai5lbGVtZW50cywgMCArIDE2ICogaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgdUluZGV4ID0gZ2wuZ2V0VW5pZm9ybUJsb2NrSW5kZXgobWVzaC5wcm9ncmFtLCAnU2tpbicpO1xyXG4gICAgICAgICAgICAgICAgZ2wudW5pZm9ybUJsb2NrQmluZGluZyhtZXNoLnByb2dyYW0sIHVJbmRleCwgMik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBVQk8gPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuVU5JRk9STV9CVUZGRVIsIFVCTyk7XHJcbiAgICAgICAgICAgICAgICBnbC5idWZmZXJEYXRhKGdsLlVOSUZPUk1fQlVGRkVSLCBtYXRyaWNlcywgZ2wuRFlOQU1JQ19EUkFXKTtcclxuICAgICAgICAgICAgICAgIG1lc2guZ2VvbWV0cnkuU0tJTiA9IFVCTztcclxuICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtZXNoIGluc3RhbmNlb2YgTWVzaCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWxzID0gbmV3IEZsb2F0MzJBcnJheSgxMik7XHJcbiAgICAgICAgICAgICAgICBtYXRlcmlhbHMuc2V0KG1lc2gubWF0ZXJpYWwucGJyTWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yRmFjdG9yIHx8IFswLjgsIDAuOCwgMC44LCAxLjBdKTtcclxuICAgICAgICAgICAgICAgIG1hdGVyaWFscy5zZXQoW3RoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50c1sxMl0sIHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50c1sxM10sIHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50c1sxNF1dLCA0KTtcclxuICAgICAgICAgICAgICAgIG1hdGVyaWFscy5zZXQoW3RoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50c1sxMl0sIHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50c1sxM10sIHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50c1sxNF1dLCA4KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1JbmRleCA9IGdsLmdldFVuaWZvcm1CbG9ja0luZGV4KG1lc2gucHJvZ3JhbSwgJ01hdGVyaWFsJyk7XHJcbiAgICAgICAgICAgICAgICBnbC51bmlmb3JtQmxvY2tCaW5kaW5nKG1lc2gucHJvZ3JhbSwgbUluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1VQk8gPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuVU5JRk9STV9CVUZGRVIsIG1VQk8pO1xyXG4gICAgICAgICAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5VTklGT1JNX0JVRkZFUiwgbWF0ZXJpYWxzLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICAgICAgICAgICAgICBtZXNoLm1hdGVyaWFsLlVCTyA9IG1VQk87XHJcbiAgICAgICAgICAgICAgICBjb25zdCBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4NChtZXNoLm1hdHJpeFdvcmxkKTtcclxuICAgICAgICAgICAgICAgIG5vcm1hbE1hdHJpeC5pbnZlcnQoKS50cmFuc3Bvc2UoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1hdHJpY2VzID0gbmV3IEZsb2F0MzJBcnJheSg2NCk7XHJcbiAgICAgICAgICAgICAgICBtYXRyaWNlcy5zZXQobWVzaC5tYXRyaXhXb3JsZC5lbGVtZW50cywgMCk7XHJcbiAgICAgICAgICAgICAgICBtYXRyaWNlcy5zZXQobm9ybWFsTWF0cml4LmVsZW1lbnRzLCAxNik7XHJcbiAgICAgICAgICAgICAgICBtYXRyaWNlcy5zZXQodGhpcy5fY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJ0LmVsZW1lbnRzLCAzMik7XHJcbiAgICAgICAgICAgICAgICBtYXRyaWNlcy5zZXQodGhpcy5fY2FtZXJhLnByb2plY3Rpb24uZWxlbWVudHMsIDQ4KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHVJbmRleCA9IGdsLmdldFVuaWZvcm1CbG9ja0luZGV4KG1lc2gucHJvZ3JhbSwgJ01hdHJpY2VzJyk7XHJcbiAgICAgICAgICAgICAgICBnbC51bmlmb3JtQmxvY2tCaW5kaW5nKG1lc2gucHJvZ3JhbSwgdUluZGV4LCAwKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IFVCTyA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5VTklGT1JNX0JVRkZFUiwgVUJPKTtcclxuICAgICAgICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuVU5JRk9STV9CVUZGRVIsIG1hdHJpY2VzLCBnbC5EWU5BTUlDX0RSQVcpO1xyXG4gICAgICAgICAgICAgICAgbWVzaC5nZW9tZXRyeS5VQk8gPSBVQk87XHJcbiAgICAgICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLlVOSUZPUk1fQlVGRkVSLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIGlmIChtZXNoLmlzVmlzaWJsZShwbGFuZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc2gubWF0ZXJpYWwuYWxwaGFNb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUudHJhbnNwYXJlbnRDaGlsZHJlbi5wdXNoKG1lc2gpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5vcGFxdWVDaGlsZHJlbi5wdXNoKG1lc2gpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc2NlbmUudHJhbnNwYXJlbnRDaGlsZHJlbi5zb3J0KChhLCBiKSA9PiBiLmRpc3RhbmNlIC0gYS5kaXN0YW5jZSk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBidWlsZEFuaW1hdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuanNvbi5hbmltYXRpb25zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IGFuaW1hdGlvbiBvZiB0aGlzLmpzb24uYW5pbWF0aW9ucykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoYW5uZWwgb2YgYW5pbWF0aW9uLmNoYW5uZWxzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVyID0gYW5pbWF0aW9uLnNhbXBsZXJzW2NoYW5uZWwuc2FtcGxlcl07XHJcbiAgICAgICAgICAgICAgICBpZiAoc2FtcGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSBjaGFubmVsO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0YXJnZXQubm9kZTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IGFuaW1hdGlvbi5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgPyBhbmltYXRpb24ucGFyYW1ldGVyc1tzYW1wbGVyLmlucHV0XSA6IHNhbXBsZXIuaW5wdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0ID0gYW5pbWF0aW9uLnBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCA/IGFuaW1hdGlvbi5wYXJhbWV0ZXJzW3NhbXBsZXIub3V0cHV0XSA6IHNhbXBsZXIub3V0cHV0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0QWNjZXNzb3IgPSB0aGlzLmpzb24uYWNjZXNzb3JzW2lucHV0XTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRBY2Nlc3NvciA9IHRoaXMuanNvbi5hY2Nlc3NvcnNbb3V0cHV0XTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dEJ1ZmZlciA9IHRoaXMuanNvbi5idWZmZXJWaWV3c1tpbnB1dEFjY2Vzc29yLmJ1ZmZlclZpZXddO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dEJ1ZmZlciA9IHRoaXMuanNvbi5idWZmZXJWaWV3c1tvdXRwdXRBY2Nlc3Nvci5idWZmZXJWaWV3XTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dEFycmF5ID0gYnVpbGRBcnJheSh0aGlzLmFycmF5QnVmZmVyW2lucHV0QnVmZmVyLmJ1ZmZlcl0sIGlucHV0QWNjZXNzb3IuY29tcG9uZW50VHlwZSwgY2FsY3VsYXRlT2Zmc2V0KGlucHV0QnVmZmVyLmJ5dGVPZmZzZXQsIGlucHV0QWNjZXNzb3IuYnl0ZU9mZnNldCksIGdldERhdGFUeXBlKGlucHV0QWNjZXNzb3IudHlwZSkgKiBpbnB1dEFjY2Vzc29yLmNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRBcnJheSA9IGJ1aWxkQXJyYXkodGhpcy5hcnJheUJ1ZmZlcltvdXRwdXRCdWZmZXIuYnVmZmVyXSwgb3V0cHV0QWNjZXNzb3IuY29tcG9uZW50VHlwZSwgY2FsY3VsYXRlT2Zmc2V0KG91dHB1dEJ1ZmZlci5ieXRlT2Zmc2V0LCBvdXRwdXRBY2Nlc3Nvci5ieXRlT2Zmc2V0KSwgZ2V0RGF0YVR5cGUob3V0cHV0QWNjZXNzb3IudHlwZSkgKiBvdXRwdXRBY2Nlc3Nvci5jb3VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gZ2V0QW5pbWF0aW9uQ29tcG9uZW50KHRhcmdldC5wYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXlzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dEFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0VCA9IGlucHV0QXJyYXlbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0ViA9IG91dHB1dEFycmF5LnNsaWNlKGkgKiBjb21wb25lbnQsIChpICsgMSkgKiBjb21wb25lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogZmlyc3RULFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZpcnN0VlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzaGVzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgd2Fsayh0aGlzLnNjZW5lLCBub2RlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubmFtZSA9PT0gbmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5wYXRoID09PSAnd2VpZ2h0cycgJiYgbm9kZSBpbnN0YW5jZW9mIE9iamVjdDNEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGRyZW5bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNoZXMucHVzaChub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNoZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhY2tzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc2hlczogbWVzaGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGFyZ2V0LnBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBgJHttZXNoZXNbMF0ubmFtZX0uJHt0YXJnZXQucGF0aH1gLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5czoga2V5cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVycG9sYXRpb246IHNhbXBsZXIuaW50ZXJwb2xhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBidWlsZFNraW4oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmpzb24uc2tpbnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3Qgc2tpbiBvZiB0aGlzLmpzb24uc2tpbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgYWNjID0gdGhpcy5qc29uLmFjY2Vzc29yc1tza2luLmludmVyc2VCaW5kTWF0cmljZXNdO1xyXG4gICAgICAgICAgICBjb25zdCBidWZmZXIgPSB0aGlzLmpzb24uYnVmZmVyVmlld3NbYWNjLmJ1ZmZlclZpZXddO1xyXG4gICAgICAgICAgICBjb25zdCBhcnJheSA9IGJ1aWxkQXJyYXkodGhpcy5hcnJheUJ1ZmZlcltidWZmZXIuYnVmZmVyXSwgYWNjLmNvbXBvbmVudFR5cGUsIGNhbGN1bGF0ZU9mZnNldChidWZmZXIuYnl0ZU9mZnNldCwgYWNjLmJ5dGVPZmZzZXQpLCBnZXREYXRhVHlwZShhY2MudHlwZSkgKiBhY2MuY291bnQpO1xyXG4gICAgICAgICAgICBjb25zdCB2ID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbnROYW1lczogc2tpbi5qb2ludHMsXHJcbiAgICAgICAgICAgICAgICBpbnZlcnNlQmluZE1hdHJpY2VzOiBhcnJheSxcclxuICAgICAgICAgICAgICAgIGJvbmVzOiBbXSxcclxuICAgICAgICAgICAgICAgIGJvbmVJbnZlcnNlczogW11cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGpvaW4gb2Ygdi5qb2ludE5hbWVzKSB7XHJcbiAgICAgICAgICAgICAgICAvL3dhbGsodGhpcy5zY2VuZSwgdGhpcy5idWlsZEJvbmVzLmJpbmQodGhpcywgam9pbiwgdikpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5qc29uLm5vZGVzW2pvaW5dLmlzQm9uZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtID0gdi5pbnZlcnNlQmluZE1hdHJpY2VzO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IE1hdHJpeDQoKS5zZXQobS5zbGljZShpICogMTYsIChpICsgMSkgKiAxNikpO1xyXG4gICAgICAgICAgICAgICAgdi5ib25lSW52ZXJzZXMucHVzaChtYXQpO1xyXG4gICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2tpbnMucHVzaCh2KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBidWlsZEJvbmVzKGpvaW4sIHYsIG5vZGUpIHtcclxuICAgICAgICBpZiAobm9kZS5uYW1lID09PSBqb2luKSB7XHJcbiAgICAgICAgICAgIHYuYm9uZXMucHVzaChub2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRKc29uKCkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLnVybClcclxuICAgICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgICAgICAgIC50aGVuKGogPT4ge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBqLmJ1ZmZlcnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuYmluLnB1c2goai5idWZmZXJzW2tleV0udXJpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmpzb24gPSBqO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGluaXRUZXh0dXJlcygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuanNvbi50ZXh0dXJlcykge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc2FtcGxlcnMgPSB0aGlzLmpzb24uc2FtcGxlcnMgfHwgW3t9XTtcclxuICAgICAgICB0aGlzLnNhbXBsZXJzID0gc2FtcGxlcnMubWFwKHMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzYW1wbGVyID0gZ2wuY3JlYXRlU2FtcGxlcigpO1xyXG4gICAgICAgICAgICBnbC5zYW1wbGVyUGFyYW1ldGVyaShzYW1wbGVyLCBnbC5URVhUVVJFX01JTl9GSUxURVIsIHMubWluRmlsdGVyIHx8IDk5ODYpO1xyXG4gICAgICAgICAgICBnbC5zYW1wbGVyUGFyYW1ldGVyaShzYW1wbGVyLCBnbC5URVhUVVJFX01BR19GSUxURVIsIHMubWFnRmlsdGVyIHx8IDk3MjkpO1xyXG4gICAgICAgICAgICBnbC5zYW1wbGVyUGFyYW1ldGVyaShzYW1wbGVyLCBnbC5URVhUVVJFX1dSQVBfUywgcy53cmFwUyB8fCAxMDQ5Nyk7XHJcbiAgICAgICAgICAgIGdsLnNhbXBsZXJQYXJhbWV0ZXJpKHNhbXBsZXIsIGdsLlRFWFRVUkVfV1JBUF9ULCBzLndyYXBUIHx8IDEwNDk3KTtcclxuICAgICAgICAgICAgcmV0dXJuIHNhbXBsZXI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgcHJvbWlzZUFyciA9IHRoaXMuanNvbi50ZXh0dXJlcy5tYXAodCA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVyID0gdGhpcy5zYW1wbGVyc1t0LnNhbXBsZXIgIT09IHVuZGVmaW5lZCA/IHQuc2FtcGxlciA6IDBdO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc291cmNlID0gdGhpcy5qc29uLmltYWdlc1t0LnNvdXJjZV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcy5oYW5kbGVUZXh0dXJlTG9hZGVkKHNhbXBsZXIsIGltYWdlKSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaW1hZ2Uub25lcnJvciA9IGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaW1hZ2UuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJztcclxuICAgICAgICAgICAgICAgIGltYWdlLnNyYyA9IGAke3RoaXMuaG9zdH0ke3NvdXJjZS51cml9YDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VBcnIpXHJcbiAgICAgICAgICAgIC50aGVuKHRleHR1cmVzID0+IHtcclxuICAgICAgICAgICAgdGhpcy50ZXh0dXJlcyA9IHRleHR1cmVzO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGhhbmRsZVRleHR1cmVMb2FkZWQoc2FtcGxlciwgaW1hZ2UpIHtcclxuICAgICAgICBjb25zdCB0ID0ge1xyXG4gICAgICAgICAgICBpbWFnZTogaW1hZ2Uuc3JjLnN1YnN0cihpbWFnZS5zcmMubGFzdEluZGV4T2YoJy8nKSksXHJcbiAgICAgICAgICAgIGRhdGE6IGdsLmNyZWF0ZVRleHR1cmUoKSxcclxuICAgICAgICAgICAgY291bnQ6IHNjZW5lVGV4dHVyZUNvdW50XHJcbiAgICAgICAgfTtcclxuICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsW2BURVhUVVJFJHtzY2VuZVRleHR1cmVDb3VudH1gXSk7XHJcbiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdC5kYXRhKTtcclxuICAgICAgICBnbC5iaW5kU2FtcGxlcigwLCBzYW1wbGVyKTtcclxuICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLlJHQkEsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIGltYWdlKTtcclxuICAgICAgICBnbC5nZW5lcmF0ZU1pcG1hcChnbC5URVhUVVJFXzJEKTtcclxuICAgICAgICBzY2VuZVRleHR1cmVDb3VudCsrO1xyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/parse.ts\n");

/***/ }),

/***/ "./src/redcube.ts":
/*!************************!*\
  !*** ./src/redcube.ts ***!
  \************************/
/*! exports provided: RedCube */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RedCube\", function() { return RedCube; });\n/* harmony import */ var _objects__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./objects */ \"./src/objects.ts\");\n/* harmony import */ var _matrix__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./matrix */ \"./src/matrix.ts\");\n/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events */ \"./src/events.ts\");\n/* harmony import */ var _fps__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./fps */ \"./src/fps.ts\");\n/* harmony import */ var _parse__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./parse */ \"./src/parse.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\n/// <reference path='../index.d.ts'/>\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet gl;\r\nclass RedCube {\r\n    constructor(url, canvas, znear) {\r\n        this.reflow = true;\r\n        this.scene = new _objects__WEBPACK_IMPORTED_MODULE_0__[\"Scene\"]();\r\n        this.color = [0.8, 0.8, 0.8, 1.0];\r\n        this.url = url;\r\n        this.host = url.substr(0, url.lastIndexOf('/') + 1);\r\n        this.canvas = canvas;\r\n        this.aspect = this.canvas.offsetWidth / this.canvas.offsetHeight;\r\n        this._camera = new _objects__WEBPACK_IMPORTED_MODULE_0__[\"Camera\"];\r\n        this._camera.isInitial = true;\r\n        this._camera.props = {\r\n            type: 'perspective',\r\n            perspective: {\r\n                yfov: 0.6,\r\n                znear: znear || 1,\r\n                zfar: 2e6,\r\n                aspectRatio: null\r\n            }\r\n        };\r\n        this.zoom = 1;\r\n        this._camera.setZ(5);\r\n        this.events = new _events__WEBPACK_IMPORTED_MODULE_2__[\"Events\"](this.redraw.bind(this));\r\n        this.fps = new _fps__WEBPACK_IMPORTED_MODULE_3__[\"FPS\"];\r\n        //this.env = new Env;\r\n        //this.env.setCamera(this._camera);\r\n        // this.PP = new PostProcessing;\r\n        // this.PP.setCanvas(this.canvas);\r\n        // this.PP.setCamera(this._camera);\r\n        this.parse = new _parse__WEBPACK_IMPORTED_MODULE_4__[\"Parse\"](url);\r\n        this.parse.setScene(this.scene);\r\n        this.parse.setCamera(this._camera, this.aspect, this.zoom);\r\n        this.parse.setUpdateCamera(this.updateCamera.bind(this));\r\n        this.parse.setCanvas(this.canvas);\r\n        this.parse.setResize(this.resize.bind(this));\r\n    }\r\n    init() {\r\n        return this.parse.getJson()\r\n            .then(this.glInit.bind(this))\r\n            .then(this.parse.initTextures.bind(this.parse))\r\n            .then(this.parse.getBuffer.bind(this.parse))\r\n            .then(this.parse.buildSkin.bind(this.parse))\r\n            .then(this.parse.buildMesh.bind(this.parse))\r\n            .then(this.parse.buildAnimation.bind(this.parse))\r\n            .then(this.draw.bind(this))\r\n            .catch(console.error);\r\n    }\r\n    updateCamera(camera) {\r\n        this._camera = camera;\r\n    }\r\n    setColor(color) {\r\n        this.color = color;\r\n    }\r\n    redraw(type, coordsStart, coordsMove) {\r\n        if (type === 'zoom') {\r\n            this.zoom = coordsStart;\r\n            this._camera.setProjection(Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"calculateProjection\"])(this._camera.props, this.aspect, this.zoom).elements);\r\n            this.needUpdateProjection = true;\r\n        }\r\n        if (type === 'rotate') {\r\n            const coordsStartWorld = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"canvasToWorld\"])(coordsStart, this._camera.projection, this.canvas.offsetWidth, this.canvas.offsetHeight);\r\n            const coordsMoveWorld = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"canvasToWorld\"])(coordsMove, this._camera.projection, this.canvas.offsetWidth, this.canvas.offsetHeight);\r\n            const p0 = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"](Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"sceneToArcBall\"])(coordsStartWorld));\r\n            const p1 = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"](Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"sceneToArcBall\"])(coordsMoveWorld));\r\n            const angle = _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"].angle(p0, p1) * 5;\r\n            if (angle < 1e-6 || isNaN(angle)) {\r\n                return;\r\n            }\r\n            const v = _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"].cross(p0, p1).normalize();\r\n            const sin = Math.sin(angle / 2);\r\n            const q = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector4\"]([v.elements[0] * sin, v.elements[1] * sin, v.elements[2] * sin, Math.cos(angle / 2)]);\r\n            const m = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Matrix4\"]();\r\n            m.makeRotationFromQuaternion(q.elements);\r\n            m.multiply(this._camera.matrixWorld);\r\n            this._camera.setMatrixWorld(m.elements);\r\n            this.needUpdateView = true;\r\n            // const diff = Vector3.angle(new Vector3([0, 1, 0]).applyQuaternion(new Vector4().setFromRotationMatrix(m)), new Vector3([0, 1, 0]));\r\n            // if (diff <= Math.PI / 2) {\r\n            //     this.needUpdateView = true;\r\n            // }\r\n        }\r\n        if (type === 'pan') {\r\n            const coordsStartWorld = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"canvasToWorld\"])(coordsStart, this._camera.projection, this.canvas.offsetWidth, this.canvas.offsetHeight);\r\n            const coordsMoveWorld = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"canvasToWorld\"])(coordsMove, this._camera.projection, this.canvas.offsetWidth, this.canvas.offsetHeight);\r\n            const p0 = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"]([...coordsStartWorld, 0]);\r\n            const p1 = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"]([...coordsMoveWorld, 0]);\r\n            const pan = this._camera.modelSize * 100;\r\n            const delta = p1.subtract(p0).scale(pan);\r\n            this._camera.matrixWorld.translate(delta.elements[0], delta.elements[1], 0);\r\n            this._camera.setMatrixWorld(this._camera.matrixWorld.elements);\r\n            this.needUpdateView = true;\r\n        }\r\n        if (type === 'resize') {\r\n            this.resize();\r\n            this.needUpdateProjection = true;\r\n        }\r\n        this.reflow = true;\r\n    }\r\n    resize() {\r\n        this.aspect = this.canvas.offsetWidth / this.canvas.offsetHeight;\r\n        this.canvas.width = this.canvas.offsetWidth * devicePixelRatio;\r\n        this.canvas.height = this.canvas.offsetHeight * devicePixelRatio;\r\n        gl.viewport(0, 0, this.canvas.offsetWidth * devicePixelRatio, this.canvas.offsetHeight * devicePixelRatio);\r\n        this._camera.setProjection(Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"calculateProjection\"])(this._camera.props, this.aspect, this.zoom).elements);\r\n        if (this._camera.isInitial) {\r\n            const z = 1 / this.canvas.width * this._camera.modelSize * 5000;\r\n            this._camera.setZ(this.z || z);\r\n            this.needUpdateView = true;\r\n        }\r\n    }\r\n    buildBuffer(indexBuffer, ...buffer) {\r\n        if (indexBuffer) {\r\n            if (indexBuffer.buffer) {\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer.buffer);\r\n            }\r\n            else {\r\n                const bufferGL = gl.createBuffer();\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, bufferGL);\r\n                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indexBuffer.value, gl.STATIC_DRAW);\r\n                indexBuffer.buffer = bufferGL;\r\n            }\r\n        }\r\n        buffer.forEach(b => {\r\n            if (!b.buffer) {\r\n                const bufferGL = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, bufferGL);\r\n                gl.bufferData(gl.ARRAY_BUFFER, b.value, gl.STATIC_DRAW);\r\n                b.buffer = bufferGL;\r\n            }\r\n        });\r\n    }\r\n    glInit() {\r\n        gl = this.canvas.getContext('webgl2') || this.canvas.getContext('webgl') || this.canvas.getContext('experimental-webgl');\r\n        Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"setGl\"])(gl);\r\n        //this.env.setGl(gl);\r\n        //this.PP.setGl(gl);\r\n        this.parse.setGl(gl);\r\n        return true;\r\n    }\r\n    animate(sec) {\r\n        for (const v of this.parse.tracks) {\r\n            const val = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"interpolation\"])(sec, v.keys);\r\n            if (val[0] === -1 || val[1] === -1 || v.stoped) {\r\n                continue;\r\n            }\r\n            if (val[0] === v.keys.length - 1) {\r\n                v.stoped = true;\r\n            }\r\n            const startFrame = v.keys[val[0]];\r\n            const endFrame = v.keys[val[1]];\r\n            // eslint-disable-next-line\r\n            const t = val[2];\r\n            const component = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"getAnimationComponent\"])(v.type);\r\n            let vectorC;\r\n            if (component === 3) {\r\n                vectorC = _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"];\r\n            }\r\n            else if (component === 4) {\r\n                vectorC = _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector4\"];\r\n            }\r\n            else if (component === 2) {\r\n                vectorC = _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector2\"];\r\n            }\r\n            const vector = new vectorC(startFrame.value);\r\n            const vector2 = new vectorC(endFrame.value);\r\n            if (v.type === 'rotation') {\r\n                const out = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector4\"];\r\n                out.lerp(vector.elements, vector2.elements, t);\r\n                for (const mesh of v.meshes) {\r\n                    mesh.matrix.makeRotationFromQuaternion(out.elements);\r\n                }\r\n            }\r\n            else if (v.type === 'scale') {\r\n                const out = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"];\r\n                out.lerp(vector.elements, vector2.elements, t);\r\n                for (const mesh of v.meshes) {\r\n                    mesh.matrix.scale(out);\r\n                }\r\n            }\r\n            else if (v.type === 'weights') {\r\n                const out = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector2\"];\r\n                out.lerp(vector.elements, vector2.elements, t);\r\n                for (const mesh of v.meshes) {\r\n                    const geometry = {};\r\n                    for (const k in mesh.geometry.targets[0]) {\r\n                        let offset = 0;\r\n                        geometry[k] = new Float32Array(mesh.geometry.attributes[k].length);\r\n                        for (let i = 0; i < geometry[k].length; i++) {\r\n                            if (k === 'TANGENT' && (i + 1) % 4 === 0) {\r\n                                offset++;\r\n                                continue;\r\n                            }\r\n                            geometry[k][i] = mesh.geometry.attributes[k][i] + out.elements[0] * mesh.geometry.targets[0][k][i - offset] + out.elements[1] * mesh.geometry.targets[1][k][i - offset];\r\n                        }\r\n                    }\r\n                    gl.bindVertexArray(mesh.geometry.VAO);\r\n                    for (const k in geometry) {\r\n                        const VBO = gl.createBuffer();\r\n                        gl.bindBuffer(gl.ARRAY_BUFFER, VBO);\r\n                        gl.bufferData(gl.ARRAY_BUFFER, geometry[k], gl.STATIC_DRAW);\r\n                        const index = Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"getAttributeIndex\"])(k);\r\n                        gl.enableVertexAttribArray(index[0]);\r\n                        gl.vertexAttribPointer(index[0], index[1], index[2], false, 0, 0);\r\n                    }\r\n                    gl.bindVertexArray(null);\r\n                }\r\n            }\r\n            else if (v.type === 'translation') {\r\n                const out = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Vector3\"];\r\n                out.lerp(vector.elements, vector2.elements, t);\r\n                for (const mesh of v.meshes) {\r\n                    mesh.matrix.setTranslate(out);\r\n                }\r\n            }\r\n            else {\r\n                console.error('ERROR');\r\n            }\r\n            for (const mesh of v.meshes) {\r\n                Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"walk\"])(mesh, node => {\r\n                    const m = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Matrix4\"];\r\n                    m.multiply(node.parent.matrixWorld);\r\n                    m.multiply(node.matrix);\r\n                    node.setMatrixWorld(m.elements);\r\n                    if (node instanceof _objects__WEBPACK_IMPORTED_MODULE_0__[\"Bone\"]) {\r\n                        node.reflow = true;\r\n                    }\r\n                    if (node instanceof _objects__WEBPACK_IMPORTED_MODULE_0__[\"Mesh\"]) {\r\n                        node.reflow = true;\r\n                    }\r\n                    if (node instanceof _objects__WEBPACK_IMPORTED_MODULE_0__[\"Camera\"] && node === this._camera) {\r\n                        this.needUpdateView = true;\r\n                    }\r\n                });\r\n            }\r\n            this.reflow = true;\r\n        }\r\n    }\r\n    draw() {\r\n        gl.clearColor(...this.color);\r\n        this.render();\r\n    }\r\n    render(time = 0) {\r\n        const sec = time / 1000;\r\n        this.animate(sec);\r\n        if (this.reflow) {\r\n            //this.PP.bindBuffer();\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n            //this.env.createEnvironment();\r\n            gl.enable(gl.DEPTH_TEST);\r\n            gl.enable(gl.CULL_FACE);\r\n            this.scene.opaqueChildren.forEach(mesh => this._draw(mesh));\r\n            if (this.scene.transparentChildren.length) {\r\n                gl.enable(gl.BLEND);\r\n                gl.depthMask(false);\r\n                gl.blendFuncSeparate(gl.SRC_COLOR, gl.DST_COLOR, gl.ONE, gl.ZERO);\r\n                // gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n                this.scene.transparentChildren.forEach(mesh => this._draw(mesh));\r\n                gl.disable(gl.BLEND);\r\n                gl.depthMask(true);\r\n                gl.blendFuncSeparate(gl.ONE, gl.ZERO, gl.ONE, gl.ZERO);\r\n            }\r\n            Object(_utils__WEBPACK_IMPORTED_MODULE_5__[\"walk\"])(this.scene, node => {\r\n                if (node instanceof _objects__WEBPACK_IMPORTED_MODULE_0__[\"Bone\"]) {\r\n                    node.reflow = false;\r\n                }\r\n            });\r\n            this.needUpdateView = false;\r\n            this.needUpdateProjection = false;\r\n            //this.PP.postProcessing();\r\n        }\r\n        this.fps.tick(time);\r\n        this.reflow = false;\r\n        requestAnimationFrame(this.render.bind(this));\r\n    }\r\n    _draw(mesh) {\r\n        gl.useProgram(mesh.program);\r\n        gl.bindVertexArray(mesh.geometry.VAO);\r\n        gl.bindBufferBase(gl.UNIFORM_BUFFER, 0, mesh.geometry.UBO);\r\n        if (mesh.reflow) {\r\n            const normalMatrix = new _matrix__WEBPACK_IMPORTED_MODULE_1__[\"Matrix4\"](mesh.matrixWorld);\r\n            normalMatrix.invert().transpose();\r\n            const matrices = new Float32Array(32);\r\n            matrices.set(mesh.matrixWorld.elements);\r\n            matrices.set(normalMatrix.elements, 16);\r\n            gl.bufferSubData(gl.UNIFORM_BUFFER, 0, matrices);\r\n            mesh.reflow = false;\r\n        }\r\n        if (this.needUpdateView) {\r\n            gl.bufferSubData(gl.UNIFORM_BUFFER, 32 * Float32Array.BYTES_PER_ELEMENT, this._camera.matrixWorldInvert.elements);\r\n        }\r\n        if (this.needUpdateProjection) {\r\n            gl.bufferSubData(gl.UNIFORM_BUFFER, 48 * Float32Array.BYTES_PER_ELEMENT, this._camera.projection.elements);\r\n        }\r\n        if (mesh instanceof _objects__WEBPACK_IMPORTED_MODULE_0__[\"SkinnedMesh\"]) {\r\n            gl.bindBufferBase(gl.UNIFORM_BUFFER, 2, mesh.geometry.SKIN);\r\n            if (mesh.bones.some(bone => bone.reflow)) {\r\n                const jointMatrix = mesh.getJointMatrix();\r\n                const matrices = new Float32Array(jointMatrix.length * 16);\r\n                let i = 0;\r\n                for (const j of jointMatrix) {\r\n                    matrices.set(j.elements, 0 + 16 * i);\r\n                    i++;\r\n                }\r\n                gl.bufferSubData(gl.UNIFORM_BUFFER, 0, matrices);\r\n            }\r\n        }\r\n        if (mesh.material.UBO) {\r\n            gl.bindBufferBase(gl.UNIFORM_BUFFER, 1, mesh.material.UBO);\r\n            if (this.needUpdateView) {\r\n                gl.bufferSubData(gl.UNIFORM_BUFFER, 4 * Float32Array.BYTES_PER_ELEMENT, new Float32Array([this._camera.matrixWorld.elements[12], this._camera.matrixWorld.elements[13], this._camera.matrixWorld.elements[14]]));\r\n                gl.bufferSubData(gl.UNIFORM_BUFFER, 8 * Float32Array.BYTES_PER_ELEMENT, new Float32Array([this._camera.matrixWorld.elements[12], this._camera.matrixWorld.elements[13], this._camera.matrixWorld.elements[14]]));\r\n            }\r\n        }\r\n        if (mesh.material.pbrMetallicRoughness.baseColorTexture) {\r\n            gl.uniform1i(mesh.material.uniforms.baseColorTexture, mesh.material.pbrMetallicRoughness.baseColorTexture.count);\r\n        }\r\n        if (mesh.material.pbrMetallicRoughness.metallicRoughnessTexture) {\r\n            gl.uniform1i(mesh.material.uniforms.metallicRoughnessTexture, mesh.material.pbrMetallicRoughness.metallicRoughnessTexture.count);\r\n        }\r\n        if (mesh.material.normalTexture) {\r\n            gl.uniform1i(mesh.material.uniforms.normalTexture, mesh.material.normalTexture.count);\r\n        }\r\n        if (mesh.material.occlusionTexture) {\r\n            gl.uniform1i(mesh.material.uniforms.occlusionTexture, mesh.material.occlusionTexture.count);\r\n        }\r\n        if (mesh.material.emissiveTexture) {\r\n            gl.uniform1i(mesh.material.uniforms.emissiveTexture, mesh.material.emissiveTexture.count);\r\n        }\r\n        if (mesh.material.doubleSided) {\r\n            gl.disable(gl.CULL_FACE);\r\n        }\r\n        if (mesh.geometry.indicesBuffer) {\r\n            gl.drawElements(mesh.mode || gl.TRIANGLES, mesh.geometry.indicesBuffer.length, mesh.geometry.indicesBuffer.BYTES_PER_ELEMENT === 4 ? gl.UNSIGNED_INT : gl.UNSIGNED_SHORT, 0);\r\n        }\r\n        else {\r\n            gl.drawArrays(mesh.mode || gl.TRIANGLES, 0, mesh.geometry.attributes.POSITION.length / 3);\r\n        }\r\n        if (mesh.material.doubleSided) {\r\n            gl.enable(gl.CULL_FACE);\r\n        }\r\n    }\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcmVkY3ViZS50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL3JlZGN1YmUvLi9zcmMvcmVkY3ViZS50cz83MDIwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9Jy4uL2luZGV4LmQudHMnLz5cclxuaW1wb3J0IHsgU2NlbmUsIE1lc2gsIFNraW5uZWRNZXNoLCBDYW1lcmEsIEJvbmUgfSBmcm9tICcuL29iamVjdHMnO1xyXG5pbXBvcnQgeyBNYXRyaXg0LCBWZWN0b3IyLCBWZWN0b3IzLCBWZWN0b3I0IH0gZnJvbSAnLi9tYXRyaXgnO1xyXG5pbXBvcnQgeyBFdmVudHMgfSBmcm9tICcuL2V2ZW50cyc7XHJcbmltcG9ydCB7IEZQUyB9IGZyb20gJy4vZnBzJztcclxuaW1wb3J0IHsgUGFyc2UgfSBmcm9tICcuL3BhcnNlJztcclxuaW1wb3J0IHsgc2V0R2wsIGdldEFuaW1hdGlvbkNvbXBvbmVudCwgaW50ZXJwb2xhdGlvbiwgd2Fsaywgc2NlbmVUb0FyY0JhbGwsIGNhbnZhc1RvV29ybGQsIGNhbGN1bGF0ZVByb2plY3Rpb24sIGdldEF0dHJpYnV0ZUluZGV4IH0gZnJvbSAnLi91dGlscyc7XHJcbmxldCBnbDtcclxuY2xhc3MgUmVkQ3ViZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcih1cmwsIGNhbnZhcywgem5lYXIpIHtcclxuICAgICAgICB0aGlzLnJlZmxvdyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IG5ldyBTY2VuZSgpO1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBbMC44LCAwLjgsIDAuOCwgMS4wXTtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLmhvc3QgPSB1cmwuc3Vic3RyKDAsIHVybC5sYXN0SW5kZXhPZignLycpICsgMSk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XHJcbiAgICAgICAgdGhpcy5hc3BlY3QgPSB0aGlzLmNhbnZhcy5vZmZzZXRXaWR0aCAvIHRoaXMuY2FudmFzLm9mZnNldEhlaWdodDtcclxuICAgICAgICB0aGlzLl9jYW1lcmEgPSBuZXcgQ2FtZXJhO1xyXG4gICAgICAgIHRoaXMuX2NhbWVyYS5pc0luaXRpYWwgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX2NhbWVyYS5wcm9wcyA9IHtcclxuICAgICAgICAgICAgdHlwZTogJ3BlcnNwZWN0aXZlJyxcclxuICAgICAgICAgICAgcGVyc3BlY3RpdmU6IHtcclxuICAgICAgICAgICAgICAgIHlmb3Y6IDAuNixcclxuICAgICAgICAgICAgICAgIHpuZWFyOiB6bmVhciB8fCAxLFxyXG4gICAgICAgICAgICAgICAgemZhcjogMmU2LFxyXG4gICAgICAgICAgICAgICAgYXNwZWN0UmF0aW86IG51bGxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy56b29tID0gMTtcclxuICAgICAgICB0aGlzLl9jYW1lcmEuc2V0Wig1KTtcclxuICAgICAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudHModGhpcy5yZWRyYXcuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5mcHMgPSBuZXcgRlBTO1xyXG4gICAgICAgIC8vdGhpcy5lbnYgPSBuZXcgRW52O1xyXG4gICAgICAgIC8vdGhpcy5lbnYuc2V0Q2FtZXJhKHRoaXMuX2NhbWVyYSk7XHJcbiAgICAgICAgLy8gdGhpcy5QUCA9IG5ldyBQb3N0UHJvY2Vzc2luZztcclxuICAgICAgICAvLyB0aGlzLlBQLnNldENhbnZhcyh0aGlzLmNhbnZhcyk7XHJcbiAgICAgICAgLy8gdGhpcy5QUC5zZXRDYW1lcmEodGhpcy5fY2FtZXJhKTtcclxuICAgICAgICB0aGlzLnBhcnNlID0gbmV3IFBhcnNlKHVybCk7XHJcbiAgICAgICAgdGhpcy5wYXJzZS5zZXRTY2VuZSh0aGlzLnNjZW5lKTtcclxuICAgICAgICB0aGlzLnBhcnNlLnNldENhbWVyYSh0aGlzLl9jYW1lcmEsIHRoaXMuYXNwZWN0LCB0aGlzLnpvb20pO1xyXG4gICAgICAgIHRoaXMucGFyc2Uuc2V0VXBkYXRlQ2FtZXJhKHRoaXMudXBkYXRlQ2FtZXJhLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMucGFyc2Uuc2V0Q2FudmFzKHRoaXMuY2FudmFzKTtcclxuICAgICAgICB0aGlzLnBhcnNlLnNldFJlc2l6ZSh0aGlzLnJlc2l6ZS5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2UuZ2V0SnNvbigpXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMuZ2xJbml0LmJpbmQodGhpcykpXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMucGFyc2UuaW5pdFRleHR1cmVzLmJpbmQodGhpcy5wYXJzZSkpXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMucGFyc2UuZ2V0QnVmZmVyLmJpbmQodGhpcy5wYXJzZSkpXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMucGFyc2UuYnVpbGRTa2luLmJpbmQodGhpcy5wYXJzZSkpXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMucGFyc2UuYnVpbGRNZXNoLmJpbmQodGhpcy5wYXJzZSkpXHJcbiAgICAgICAgICAgIC50aGVuKHRoaXMucGFyc2UuYnVpbGRBbmltYXRpb24uYmluZCh0aGlzLnBhcnNlKSlcclxuICAgICAgICAgICAgLnRoZW4odGhpcy5kcmF3LmJpbmQodGhpcykpXHJcbiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuICAgIH1cclxuICAgIHVwZGF0ZUNhbWVyYShjYW1lcmEpIHtcclxuICAgICAgICB0aGlzLl9jYW1lcmEgPSBjYW1lcmE7XHJcbiAgICB9XHJcbiAgICBzZXRDb2xvcihjb2xvcikge1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIH1cclxuICAgIHJlZHJhdyh0eXBlLCBjb29yZHNTdGFydCwgY29vcmRzTW92ZSkge1xyXG4gICAgICAgIGlmICh0eXBlID09PSAnem9vbScpIHtcclxuICAgICAgICAgICAgdGhpcy56b29tID0gY29vcmRzU3RhcnQ7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbWVyYS5zZXRQcm9qZWN0aW9uKGNhbGN1bGF0ZVByb2plY3Rpb24odGhpcy5fY2FtZXJhLnByb3BzLCB0aGlzLmFzcGVjdCwgdGhpcy56b29tKS5lbGVtZW50cyk7XHJcbiAgICAgICAgICAgIHRoaXMubmVlZFVwZGF0ZVByb2plY3Rpb24gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ3JvdGF0ZScpIHtcclxuICAgICAgICAgICAgY29uc3QgY29vcmRzU3RhcnRXb3JsZCA9IGNhbnZhc1RvV29ybGQoY29vcmRzU3RhcnQsIHRoaXMuX2NhbWVyYS5wcm9qZWN0aW9uLCB0aGlzLmNhbnZhcy5vZmZzZXRXaWR0aCwgdGhpcy5jYW52YXMub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgY29uc3QgY29vcmRzTW92ZVdvcmxkID0gY2FudmFzVG9Xb3JsZChjb29yZHNNb3ZlLCB0aGlzLl9jYW1lcmEucHJvamVjdGlvbiwgdGhpcy5jYW52YXMub2Zmc2V0V2lkdGgsIHRoaXMuY2FudmFzLm9mZnNldEhlaWdodCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHAwID0gbmV3IFZlY3RvcjMoc2NlbmVUb0FyY0JhbGwoY29vcmRzU3RhcnRXb3JsZCkpO1xyXG4gICAgICAgICAgICBjb25zdCBwMSA9IG5ldyBWZWN0b3IzKHNjZW5lVG9BcmNCYWxsKGNvb3Jkc01vdmVXb3JsZCkpO1xyXG4gICAgICAgICAgICBjb25zdCBhbmdsZSA9IFZlY3RvcjMuYW5nbGUocDAsIHAxKSAqIDU7XHJcbiAgICAgICAgICAgIGlmIChhbmdsZSA8IDFlLTYgfHwgaXNOYU4oYW5nbGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdiA9IFZlY3RvcjMuY3Jvc3MocDAsIHAxKS5ub3JtYWxpemUoKTtcclxuICAgICAgICAgICAgY29uc3Qgc2luID0gTWF0aC5zaW4oYW5nbGUgLyAyKTtcclxuICAgICAgICAgICAgY29uc3QgcSA9IG5ldyBWZWN0b3I0KFt2LmVsZW1lbnRzWzBdICogc2luLCB2LmVsZW1lbnRzWzFdICogc2luLCB2LmVsZW1lbnRzWzJdICogc2luLCBNYXRoLmNvcyhhbmdsZSAvIDIpXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWF0cml4NCgpO1xyXG4gICAgICAgICAgICBtLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHEuZWxlbWVudHMpO1xyXG4gICAgICAgICAgICBtLm11bHRpcGx5KHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbWVyYS5zZXRNYXRyaXhXb3JsZChtLmVsZW1lbnRzKTtcclxuICAgICAgICAgICAgdGhpcy5uZWVkVXBkYXRlVmlldyA9IHRydWU7XHJcbiAgICAgICAgICAgIC8vIGNvbnN0IGRpZmYgPSBWZWN0b3IzLmFuZ2xlKG5ldyBWZWN0b3IzKFswLCAxLCAwXSkuYXBwbHlRdWF0ZXJuaW9uKG5ldyBWZWN0b3I0KCkuc2V0RnJvbVJvdGF0aW9uTWF0cml4KG0pKSwgbmV3IFZlY3RvcjMoWzAsIDEsIDBdKSk7XHJcbiAgICAgICAgICAgIC8vIGlmIChkaWZmIDw9IE1hdGguUEkgLyAyKSB7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLm5lZWRVcGRhdGVWaWV3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ3BhbicpIHtcclxuICAgICAgICAgICAgY29uc3QgY29vcmRzU3RhcnRXb3JsZCA9IGNhbnZhc1RvV29ybGQoY29vcmRzU3RhcnQsIHRoaXMuX2NhbWVyYS5wcm9qZWN0aW9uLCB0aGlzLmNhbnZhcy5vZmZzZXRXaWR0aCwgdGhpcy5jYW52YXMub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgY29uc3QgY29vcmRzTW92ZVdvcmxkID0gY2FudmFzVG9Xb3JsZChjb29yZHNNb3ZlLCB0aGlzLl9jYW1lcmEucHJvamVjdGlvbiwgdGhpcy5jYW52YXMub2Zmc2V0V2lkdGgsIHRoaXMuY2FudmFzLm9mZnNldEhlaWdodCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHAwID0gbmV3IFZlY3RvcjMoWy4uLmNvb3Jkc1N0YXJ0V29ybGQsIDBdKTtcclxuICAgICAgICAgICAgY29uc3QgcDEgPSBuZXcgVmVjdG9yMyhbLi4uY29vcmRzTW92ZVdvcmxkLCAwXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhbiA9IHRoaXMuX2NhbWVyYS5tb2RlbFNpemUgKiAxMDA7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gcDEuc3VidHJhY3QocDApLnNjYWxlKHBhbik7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC50cmFuc2xhdGUoZGVsdGEuZWxlbWVudHNbMF0sIGRlbHRhLmVsZW1lbnRzWzFdLCAwKTtcclxuICAgICAgICAgICAgdGhpcy5fY2FtZXJhLnNldE1hdHJpeFdvcmxkKHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZC5lbGVtZW50cyk7XHJcbiAgICAgICAgICAgIHRoaXMubmVlZFVwZGF0ZVZpZXcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ3Jlc2l6ZScpIHtcclxuICAgICAgICAgICAgdGhpcy5yZXNpemUoKTtcclxuICAgICAgICAgICAgdGhpcy5uZWVkVXBkYXRlUHJvamVjdGlvbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVmbG93ID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJlc2l6ZSgpIHtcclxuICAgICAgICB0aGlzLmFzcGVjdCA9IHRoaXMuY2FudmFzLm9mZnNldFdpZHRoIC8gdGhpcy5jYW52YXMub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5jYW52YXMub2Zmc2V0V2lkdGggKiBkZXZpY2VQaXhlbFJhdGlvO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuY2FudmFzLm9mZnNldEhlaWdodCAqIGRldmljZVBpeGVsUmF0aW87XHJcbiAgICAgICAgZ2wudmlld3BvcnQoMCwgMCwgdGhpcy5jYW52YXMub2Zmc2V0V2lkdGggKiBkZXZpY2VQaXhlbFJhdGlvLCB0aGlzLmNhbnZhcy5vZmZzZXRIZWlnaHQgKiBkZXZpY2VQaXhlbFJhdGlvKTtcclxuICAgICAgICB0aGlzLl9jYW1lcmEuc2V0UHJvamVjdGlvbihjYWxjdWxhdGVQcm9qZWN0aW9uKHRoaXMuX2NhbWVyYS5wcm9wcywgdGhpcy5hc3BlY3QsIHRoaXMuem9vbSkuZWxlbWVudHMpO1xyXG4gICAgICAgIGlmICh0aGlzLl9jYW1lcmEuaXNJbml0aWFsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHogPSAxIC8gdGhpcy5jYW52YXMud2lkdGggKiB0aGlzLl9jYW1lcmEubW9kZWxTaXplICogNTAwMDtcclxuICAgICAgICAgICAgdGhpcy5fY2FtZXJhLnNldFoodGhpcy56IHx8IHopO1xyXG4gICAgICAgICAgICB0aGlzLm5lZWRVcGRhdGVWaWV3ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBidWlsZEJ1ZmZlcihpbmRleEJ1ZmZlciwgLi4uYnVmZmVyKSB7XHJcbiAgICAgICAgaWYgKGluZGV4QnVmZmVyKSB7XHJcbiAgICAgICAgICAgIGlmIChpbmRleEJ1ZmZlci5idWZmZXIpIHtcclxuICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGluZGV4QnVmZmVyLmJ1ZmZlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXJHTCA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYnVmZmVyR0wpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaW5kZXhCdWZmZXIudmFsdWUsIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgICAgICAgICAgICAgIGluZGV4QnVmZmVyLmJ1ZmZlciA9IGJ1ZmZlckdMO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJ1ZmZlci5mb3JFYWNoKGIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWIuYnVmZmVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXJHTCA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlckdMKTtcclxuICAgICAgICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBiLnZhbHVlLCBnbC5TVEFUSUNfRFJBVyk7XHJcbiAgICAgICAgICAgICAgICBiLmJ1ZmZlciA9IGJ1ZmZlckdMO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnbEluaXQoKSB7XHJcbiAgICAgICAgZ2wgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbDInKSB8fCB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbCcpIHx8IHRoaXMuY2FudmFzLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcpO1xyXG4gICAgICAgIHNldEdsKGdsKTtcclxuICAgICAgICAvL3RoaXMuZW52LnNldEdsKGdsKTtcclxuICAgICAgICAvL3RoaXMuUFAuc2V0R2woZ2wpO1xyXG4gICAgICAgIHRoaXMucGFyc2Uuc2V0R2woZ2wpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgYW5pbWF0ZShzZWMpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdGhpcy5wYXJzZS50cmFja3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdmFsID0gaW50ZXJwb2xhdGlvbihzZWMsIHYua2V5cyk7XHJcbiAgICAgICAgICAgIGlmICh2YWxbMF0gPT09IC0xIHx8IHZhbFsxXSA9PT0gLTEgfHwgdi5zdG9wZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YWxbMF0gPT09IHYua2V5cy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICB2LnN0b3BlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRGcmFtZSA9IHYua2V5c1t2YWxbMF1dO1xyXG4gICAgICAgICAgICBjb25zdCBlbmRGcmFtZSA9IHYua2V5c1t2YWxbMV1dO1xyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcclxuICAgICAgICAgICAgY29uc3QgdCA9IHZhbFsyXTtcclxuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gZ2V0QW5pbWF0aW9uQ29tcG9uZW50KHYudHlwZSk7XHJcbiAgICAgICAgICAgIGxldCB2ZWN0b3JDO1xyXG4gICAgICAgICAgICBpZiAoY29tcG9uZW50ID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICB2ZWN0b3JDID0gVmVjdG9yMztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjb21wb25lbnQgPT09IDQpIHtcclxuICAgICAgICAgICAgICAgIHZlY3RvckMgPSBWZWN0b3I0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbXBvbmVudCA9PT0gMikge1xyXG4gICAgICAgICAgICAgICAgdmVjdG9yQyA9IFZlY3RvcjI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdmVjdG9yID0gbmV3IHZlY3RvckMoc3RhcnRGcmFtZS52YWx1ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZlY3RvcjIgPSBuZXcgdmVjdG9yQyhlbmRGcmFtZS52YWx1ZSk7XHJcbiAgICAgICAgICAgIGlmICh2LnR5cGUgPT09ICdyb3RhdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dCA9IG5ldyBWZWN0b3I0O1xyXG4gICAgICAgICAgICAgICAgb3V0LmxlcnAodmVjdG9yLmVsZW1lbnRzLCB2ZWN0b3IyLmVsZW1lbnRzLCB0KTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbWVzaCBvZiB2Lm1lc2hlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc2gubWF0cml4Lm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKG91dC5lbGVtZW50cyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodi50eXBlID09PSAnc2NhbGUnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXQgPSBuZXcgVmVjdG9yMztcclxuICAgICAgICAgICAgICAgIG91dC5sZXJwKHZlY3Rvci5lbGVtZW50cywgdmVjdG9yMi5lbGVtZW50cywgdCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1lc2ggb2Ygdi5tZXNoZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNoLm1hdHJpeC5zY2FsZShvdXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHYudHlwZSA9PT0gJ3dlaWdodHMnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXQgPSBuZXcgVmVjdG9yMjtcclxuICAgICAgICAgICAgICAgIG91dC5sZXJwKHZlY3Rvci5lbGVtZW50cywgdmVjdG9yMi5lbGVtZW50cywgdCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1lc2ggb2Ygdi5tZXNoZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnZW9tZXRyeSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgayBpbiBtZXNoLmdlb21ldHJ5LnRhcmdldHNbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlb21ldHJ5W2tdID0gbmV3IEZsb2F0MzJBcnJheShtZXNoLmdlb21ldHJ5LmF0dHJpYnV0ZXNba10ubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW9tZXRyeVtrXS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgPT09ICdUQU5HRU5UJyAmJiAoaSArIDEpICUgNCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VvbWV0cnlba11baV0gPSBtZXNoLmdlb21ldHJ5LmF0dHJpYnV0ZXNba11baV0gKyBvdXQuZWxlbWVudHNbMF0gKiBtZXNoLmdlb21ldHJ5LnRhcmdldHNbMF1ba11baSAtIG9mZnNldF0gKyBvdXQuZWxlbWVudHNbMV0gKiBtZXNoLmdlb21ldHJ5LnRhcmdldHNbMV1ba11baSAtIG9mZnNldF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KG1lc2guZ2VvbWV0cnkuVkFPKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGsgaW4gZ2VvbWV0cnkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgVkJPID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBWQk8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgZ2VvbWV0cnlba10sIGdsLlNUQVRJQ19EUkFXKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBnZXRBdHRyaWJ1dGVJbmRleChrKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoaW5kZXhbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGluZGV4WzBdLCBpbmRleFsxXSwgaW5kZXhbMl0sIGZhbHNlLCAwLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHYudHlwZSA9PT0gJ3RyYW5zbGF0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3V0ID0gbmV3IFZlY3RvcjM7XHJcbiAgICAgICAgICAgICAgICBvdXQubGVycCh2ZWN0b3IuZWxlbWVudHMsIHZlY3RvcjIuZWxlbWVudHMsIHQpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBtZXNoIG9mIHYubWVzaGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzaC5tYXRyaXguc2V0VHJhbnNsYXRlKG91dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFUlJPUicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgbWVzaCBvZiB2Lm1lc2hlcykge1xyXG4gICAgICAgICAgICAgICAgd2FsayhtZXNoLCBub2RlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1hdHJpeDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgbS5tdWx0aXBseShub2RlLnBhcmVudC5tYXRyaXhXb3JsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbS5tdWx0aXBseShub2RlLm1hdHJpeCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5zZXRNYXRyaXhXb3JsZChtLmVsZW1lbnRzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIEJvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZWZsb3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIE1lc2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZWZsb3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIENhbWVyYSAmJiBub2RlID09PSB0aGlzLl9jYW1lcmEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZWVkVXBkYXRlVmlldyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZWZsb3cgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGRyYXcoKSB7XHJcbiAgICAgICAgZ2wuY2xlYXJDb2xvciguLi50aGlzLmNvbG9yKTtcclxuICAgICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgfVxyXG4gICAgcmVuZGVyKHRpbWUgPSAwKSB7XHJcbiAgICAgICAgY29uc3Qgc2VjID0gdGltZSAvIDEwMDA7XHJcbiAgICAgICAgdGhpcy5hbmltYXRlKHNlYyk7XHJcbiAgICAgICAgaWYgKHRoaXMucmVmbG93KSB7XHJcbiAgICAgICAgICAgIC8vdGhpcy5QUC5iaW5kQnVmZmVyKCk7XHJcbiAgICAgICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQgfCBnbC5ERVBUSF9CVUZGRVJfQklUKTtcclxuICAgICAgICAgICAgLy90aGlzLmVudi5jcmVhdGVFbnZpcm9ubWVudCgpO1xyXG4gICAgICAgICAgICBnbC5lbmFibGUoZ2wuREVQVEhfVEVTVCk7XHJcbiAgICAgICAgICAgIGdsLmVuYWJsZShnbC5DVUxMX0ZBQ0UpO1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLm9wYXF1ZUNoaWxkcmVuLmZvckVhY2gobWVzaCA9PiB0aGlzLl9kcmF3KG1lc2gpKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NlbmUudHJhbnNwYXJlbnRDaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGdsLmVuYWJsZShnbC5CTEVORCk7XHJcbiAgICAgICAgICAgICAgICBnbC5kZXB0aE1hc2soZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYmxlbmRGdW5jU2VwYXJhdGUoZ2wuU1JDX0NPTE9SLCBnbC5EU1RfQ09MT1IsIGdsLk9ORSwgZ2wuWkVSTyk7XHJcbiAgICAgICAgICAgICAgICAvLyBnbC5ibGVuZEZ1bmNTZXBhcmF0ZShnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnRyYW5zcGFyZW50Q2hpbGRyZW4uZm9yRWFjaChtZXNoID0+IHRoaXMuX2RyYXcobWVzaCkpO1xyXG4gICAgICAgICAgICAgICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7XHJcbiAgICAgICAgICAgICAgICBnbC5kZXB0aE1hc2sodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBnbC5ibGVuZEZ1bmNTZXBhcmF0ZShnbC5PTkUsIGdsLlpFUk8sIGdsLk9ORSwgZ2wuWkVSTyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgd2Fsayh0aGlzLnNjZW5lLCBub2RlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgQm9uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUucmVmbG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLm5lZWRVcGRhdGVWaWV3ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubmVlZFVwZGF0ZVByb2plY3Rpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgLy90aGlzLlBQLnBvc3RQcm9jZXNzaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZnBzLnRpY2sodGltZSk7XHJcbiAgICAgICAgdGhpcy5yZWZsb3cgPSBmYWxzZTtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZW5kZXIuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcbiAgICBfZHJhdyhtZXNoKSB7XHJcbiAgICAgICAgZ2wudXNlUHJvZ3JhbShtZXNoLnByb2dyYW0pO1xyXG4gICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShtZXNoLmdlb21ldHJ5LlZBTyk7XHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlckJhc2UoZ2wuVU5JRk9STV9CVUZGRVIsIDAsIG1lc2guZ2VvbWV0cnkuVUJPKTtcclxuICAgICAgICBpZiAobWVzaC5yZWZsb3cpIHtcclxuICAgICAgICAgICAgY29uc3Qgbm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDQobWVzaC5tYXRyaXhXb3JsZCk7XHJcbiAgICAgICAgICAgIG5vcm1hbE1hdHJpeC5pbnZlcnQoKS50cmFuc3Bvc2UoKTtcclxuICAgICAgICAgICAgY29uc3QgbWF0cmljZXMgPSBuZXcgRmxvYXQzMkFycmF5KDMyKTtcclxuICAgICAgICAgICAgbWF0cmljZXMuc2V0KG1lc2gubWF0cml4V29ybGQuZWxlbWVudHMpO1xyXG4gICAgICAgICAgICBtYXRyaWNlcy5zZXQobm9ybWFsTWF0cml4LmVsZW1lbnRzLCAxNik7XHJcbiAgICAgICAgICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuVU5JRk9STV9CVUZGRVIsIDAsIG1hdHJpY2VzKTtcclxuICAgICAgICAgICAgbWVzaC5yZWZsb3cgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubmVlZFVwZGF0ZVZpZXcpIHtcclxuICAgICAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5VTklGT1JNX0JVRkZFUiwgMzIgKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHRoaXMuX2NhbWVyYS5tYXRyaXhXb3JsZEludmVydC5lbGVtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm5lZWRVcGRhdGVQcm9qZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuVU5JRk9STV9CVUZGRVIsIDQ4ICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCB0aGlzLl9jYW1lcmEucHJvamVjdGlvbi5lbGVtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtZXNoIGluc3RhbmNlb2YgU2tpbm5lZE1lc2gpIHtcclxuICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlckJhc2UoZ2wuVU5JRk9STV9CVUZGRVIsIDIsIG1lc2guZ2VvbWV0cnkuU0tJTik7XHJcbiAgICAgICAgICAgIGlmIChtZXNoLmJvbmVzLnNvbWUoYm9uZSA9PiBib25lLnJlZmxvdykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGpvaW50TWF0cml4ID0gbWVzaC5nZXRKb2ludE1hdHJpeCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0cmljZXMgPSBuZXcgRmxvYXQzMkFycmF5KGpvaW50TWF0cml4Lmxlbmd0aCAqIDE2KTtcclxuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaiBvZiBqb2ludE1hdHJpeCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdHJpY2VzLnNldChqLmVsZW1lbnRzLCAwICsgMTYgKiBpKTtcclxuICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBnbC5idWZmZXJTdWJEYXRhKGdsLlVOSUZPUk1fQlVGRkVSLCAwLCBtYXRyaWNlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1lc2gubWF0ZXJpYWwuVUJPKSB7XHJcbiAgICAgICAgICAgIGdsLmJpbmRCdWZmZXJCYXNlKGdsLlVOSUZPUk1fQlVGRkVSLCAxLCBtZXNoLm1hdGVyaWFsLlVCTyk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5lZWRVcGRhdGVWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICBnbC5idWZmZXJTdWJEYXRhKGdsLlVOSUZPUk1fQlVGRkVSLCA0ICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBuZXcgRmxvYXQzMkFycmF5KFt0aGlzLl9jYW1lcmEubWF0cml4V29ybGQuZWxlbWVudHNbMTJdLCB0aGlzLl9jYW1lcmEubWF0cml4V29ybGQuZWxlbWVudHNbMTNdLCB0aGlzLl9jYW1lcmEubWF0cml4V29ybGQuZWxlbWVudHNbMTRdXSkpO1xyXG4gICAgICAgICAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5VTklGT1JNX0JVRkZFUiwgOCAqIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgbmV3IEZsb2F0MzJBcnJheShbdGhpcy5fY2FtZXJhLm1hdHJpeFdvcmxkLmVsZW1lbnRzWzEyXSwgdGhpcy5fY2FtZXJhLm1hdHJpeFdvcmxkLmVsZW1lbnRzWzEzXSwgdGhpcy5fY2FtZXJhLm1hdHJpeFdvcmxkLmVsZW1lbnRzWzE0XV0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWVzaC5tYXRlcmlhbC5wYnJNZXRhbGxpY1JvdWdobmVzcy5iYXNlQ29sb3JUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIGdsLnVuaWZvcm0xaShtZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhc2VDb2xvclRleHR1cmUsIG1lc2gubWF0ZXJpYWwucGJyTWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yVGV4dHVyZS5jb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtZXNoLm1hdGVyaWFsLnBick1ldGFsbGljUm91Z2huZXNzLm1ldGFsbGljUm91Z2huZXNzVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBnbC51bmlmb3JtMWkobWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5tZXRhbGxpY1JvdWdobmVzc1RleHR1cmUsIG1lc2gubWF0ZXJpYWwucGJyTWV0YWxsaWNSb3VnaG5lc3MubWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlLmNvdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1lc2gubWF0ZXJpYWwubm9ybWFsVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBnbC51bmlmb3JtMWkobWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5ub3JtYWxUZXh0dXJlLCBtZXNoLm1hdGVyaWFsLm5vcm1hbFRleHR1cmUuY291bnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWVzaC5tYXRlcmlhbC5vY2NsdXNpb25UZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIGdsLnVuaWZvcm0xaShtZXNoLm1hdGVyaWFsLnVuaWZvcm1zLm9jY2x1c2lvblRleHR1cmUsIG1lc2gubWF0ZXJpYWwub2NjbHVzaW9uVGV4dHVyZS5jb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtZXNoLm1hdGVyaWFsLmVtaXNzaXZlVGV4dHVyZSkge1xyXG4gICAgICAgICAgICBnbC51bmlmb3JtMWkobWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5lbWlzc2l2ZVRleHR1cmUsIG1lc2gubWF0ZXJpYWwuZW1pc3NpdmVUZXh0dXJlLmNvdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1lc2gubWF0ZXJpYWwuZG91YmxlU2lkZWQpIHtcclxuICAgICAgICAgICAgZ2wuZGlzYWJsZShnbC5DVUxMX0ZBQ0UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWVzaC5nZW9tZXRyeS5pbmRpY2VzQnVmZmVyKSB7XHJcbiAgICAgICAgICAgIGdsLmRyYXdFbGVtZW50cyhtZXNoLm1vZGUgfHwgZ2wuVFJJQU5HTEVTLCBtZXNoLmdlb21ldHJ5LmluZGljZXNCdWZmZXIubGVuZ3RoLCBtZXNoLmdlb21ldHJ5LmluZGljZXNCdWZmZXIuQllURVNfUEVSX0VMRU1FTlQgPT09IDQgPyBnbC5VTlNJR05FRF9JTlQgOiBnbC5VTlNJR05FRF9TSE9SVCwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBnbC5kcmF3QXJyYXlzKG1lc2gubW9kZSB8fCBnbC5UUklBTkdMRVMsIDAsIG1lc2guZ2VvbWV0cnkuYXR0cmlidXRlcy5QT1NJVElPTi5sZW5ndGggLyAzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1lc2gubWF0ZXJpYWwuZG91YmxlU2lkZWQpIHtcclxuICAgICAgICAgICAgZ2wuZW5hYmxlKGdsLkNVTExfRkFDRSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydCB7IFJlZEN1YmUgfTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/redcube.ts\n");

/***/ }),

/***/ "./src/shaders/fragment.glsl":
/*!***********************************!*\
  !*** ./src/shaders/fragment.glsl ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"#version 300 es\\r\\nprecision highp float;\\r\\n\\r\\nin vec2 outUV;\\r\\nin vec3 outPosition;\\r\\n#ifdef TANGENT\\r\\n    in mat3 outTBN;\\r\\n#else\\r\\n    in vec3 outNormal;\\r\\n#endif\\r\\n\\r\\nout vec4 color;\\r\\n\\r\\nuniform Material {\\r\\n    vec4 baseColorFactor;\\r\\n    vec3 lightPos;\\r\\n    vec3 viewPos;\\r\\n};\\r\\nuniform sampler2D baseColorTexture;\\r\\nuniform sampler2D metallicRoughnessTexture;\\r\\nuniform sampler2D normalTexture;\\r\\nuniform sampler2D emissiveTexture;\\r\\nuniform sampler2D occlusionTexture;\\r\\n\\r\\nconst float PI = 3.14159265359;\\r\\nconst float ambientStrength = 0.1;\\r\\nconst float specularStrength = 0.5;\\r\\nconst float specularPower = 32.0;\\r\\nconst vec3 lightColor = vec3(1.0, 1.0, 1.0);\\r\\nconst vec3 emissiveFactor = vec3(1.0, 1.0, 1.0);\\r\\n\\r\\nvec3 srgbToLinear(vec4 srgbIn) {\\r\\n    return pow(srgbIn.rgb, vec3(2.2));\\r\\n}\\r\\n\\r\\nfloat DistributionGGX(vec3 N, vec3 H, float roughness) {\\r\\n    float a = roughness*roughness;\\r\\n    float a2 = max(a*a, 0.0001);\\r\\n    float NdotH = max(dot(N, H), 0.0);\\r\\n    float NdotH2 = NdotH*NdotH;\\r\\n\\r\\n    float nom   = a2;\\r\\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\\r\\n    denom = PI * denom * denom;\\r\\n\\r\\n    return nom / max(denom, 0.0001);\\r\\n}\\r\\n\\r\\nfloat GeometrySchlickGGX(float NdotV, float roughness) {\\r\\n    float r = (roughness + 1.0);\\r\\n    float k = (r*r) / 8.0;\\r\\n\\r\\n    float nom   = NdotV;\\r\\n    float denom = NdotV * (1.0 - k) + k;\\r\\n\\r\\n    return nom / denom;\\r\\n}\\r\\n\\r\\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\\r\\n    float NdotV = max(dot(N, V), 0.0);\\r\\n    float NdotL = max(dot(N, L), 0.0);\\r\\n    float ggx2 = GeometrySchlickGGX(NdotV, roughness);\\r\\n    float ggx1 = GeometrySchlickGGX(NdotL, roughness);\\r\\n\\r\\n    return ggx1 * ggx2;\\r\\n}\\r\\n\\r\\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\\r\\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n    #ifdef BASECOLORTEXTURE\\r\\n        vec3 baseColor = srgbToLinear(texture(baseColorTexture, outUV));\\r\\n        float alpha = texture(baseColorTexture, outUV).a;\\r\\n    #else\\r\\n        vec3 baseColor = baseColorFactor.rgb;\\r\\n        float alpha = baseColorFactor.a;\\r\\n    #endif\\r\\n\\r\\n    #ifdef OCCLUSIONMAP\\r\\n        float ao = texture(occlusionTexture, outUV).r;\\r\\n    #endif\\r\\n\\r\\n    #ifdef METALROUGHNESSMAP\\r\\n        float roughness = texture(metallicRoughnessTexture, outUV).g;\\r\\n        float metallic = texture(metallicRoughnessTexture, outUV).b;\\r\\n    #endif\\r\\n\\r\\n    #ifdef TANGENT\\r\\n        #ifdef NORMALMAP\\r\\n            vec3 n = texture(normalTexture, outUV).rgb;\\r\\n            n = normalize(outTBN * (2.0 * n - 1.0));\\r\\n        #else\\r\\n            vec3 n = outTBN[2].xyz;\\r\\n        #endif\\r\\n    #else\\r\\n        vec3 n = outNormal;\\r\\n    #endif\\r\\n\\r\\n    vec3 viewDir = normalize(viewPos - outPosition);\\r\\n    vec3 lightDir = normalize(lightPos - outPosition);\\r\\n    vec3 H = normalize(viewDir + lightDir);\\r\\n    float distance = length(lightPos - outPosition);\\r\\n    float attenuation = 1.0 / (distance * distance);\\r\\n    vec3 radiance = lightColor * 2.0;\\r\\n\\r\\n    #ifdef USE_PBR\\r\\n        vec3 F0 = vec3(0.04); \\r\\n        F0 = mix(F0, baseColor, metallic);\\r\\n\\r\\n        vec3 light = vec3(0.0);\\r\\n\\r\\n        float NDF = DistributionGGX(n, H, roughness);        \\r\\n        float G = GeometrySmith(n, viewDir, lightDir, roughness);      \\r\\n        vec3 F = fresnelSchlick(max(dot(H, viewDir), 0.0), F0);       \\r\\n        \\r\\n        vec3 kS = F;\\r\\n        vec3 kD = vec3(1.0) - kS;\\r\\n        kD *= 1.0 - metallic;     \\r\\n        \\r\\n        vec3 nominator = NDF * G * F;\\r\\n        float denominator = 4.0 * max(dot(n, viewDir), 0.0) * max(dot(n, lightDir), 0.0);\\r\\n        vec3 specular = nominator / max(denominator, 0.001);  \\r\\n\\r\\n        float NdotL = max(dot(n, lightDir), 0.0);                \\r\\n        light += (kD * baseColor / PI + specular) * radiance * NdotL;\\r\\n\\r\\n        #ifdef OCCLUSIONMAP\\r\\n            vec3 ambient = vec3(0.03) * baseColor * ao;\\r\\n        #else\\r\\n            vec3 ambient = baseColor;\\r\\n        #endif\\r\\n        baseColor = ambient + light;\\r\\n\\r\\n        #ifdef EMISSIVEMAP\\r\\n            vec3 emissive = srgbToLinear(texture(emissiveTexture, outUV)) * emissiveFactor;\\r\\n            baseColor.rgb += emissive;\\r\\n        #endif\\r\\n\\r\\n        baseColor = baseColor / (baseColor + vec3(1.0));\\r\\n        baseColor = pow(baseColor, vec3(1.0 / 2.2));  \\r\\n   \\r\\n        color = vec4(baseColor, 1.0);\\r\\n    #else\\r\\n        vec3 ambient = ambientStrength * lightColor;\\r\\n\\r\\n        float diff = max(dot(n, lightDir), 0.0);\\r\\n        vec3 diffuse = diff * lightColor;\\r\\n\\r\\n        vec3 reflectDir = reflect(-lightDir, n);\\r\\n        float spec = pow(max(dot(viewDir, reflectDir), 0.0), specularPower);\\r\\n        vec3 specular = specularStrength * spec * lightColor;\\r\\n\\r\\n        color = vec4(baseColor.rgb * (ambient + diffuse + specular), alpha);\\r\\n    #endif\\r\\n}\\r\\n\"//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2hhZGVycy9mcmFnbWVudC5nbHNsLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVkY3ViZS8uL3NyYy9zaGFkZXJzL2ZyYWdtZW50Lmdsc2w/OThmMyJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFwiI3ZlcnNpb24gMzAwIGVzXFxyXFxucHJlY2lzaW9uIGhpZ2hwIGZsb2F0O1xcclxcblxcclxcbmluIHZlYzIgb3V0VVY7XFxyXFxuaW4gdmVjMyBvdXRQb3NpdGlvbjtcXHJcXG4jaWZkZWYgVEFOR0VOVFxcclxcbiAgICBpbiBtYXQzIG91dFRCTjtcXHJcXG4jZWxzZVxcclxcbiAgICBpbiB2ZWMzIG91dE5vcm1hbDtcXHJcXG4jZW5kaWZcXHJcXG5cXHJcXG5vdXQgdmVjNCBjb2xvcjtcXHJcXG5cXHJcXG51bmlmb3JtIE1hdGVyaWFsIHtcXHJcXG4gICAgdmVjNCBiYXNlQ29sb3JGYWN0b3I7XFxyXFxuICAgIHZlYzMgbGlnaHRQb3M7XFxyXFxuICAgIHZlYzMgdmlld1BvcztcXHJcXG59O1xcclxcbnVuaWZvcm0gc2FtcGxlcjJEIGJhc2VDb2xvclRleHR1cmU7XFxyXFxudW5pZm9ybSBzYW1wbGVyMkQgbWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlO1xcclxcbnVuaWZvcm0gc2FtcGxlcjJEIG5vcm1hbFRleHR1cmU7XFxyXFxudW5pZm9ybSBzYW1wbGVyMkQgZW1pc3NpdmVUZXh0dXJlO1xcclxcbnVuaWZvcm0gc2FtcGxlcjJEIG9jY2x1c2lvblRleHR1cmU7XFxyXFxuXFxyXFxuY29uc3QgZmxvYXQgUEkgPSAzLjE0MTU5MjY1MzU5O1xcclxcbmNvbnN0IGZsb2F0IGFtYmllbnRTdHJlbmd0aCA9IDAuMTtcXHJcXG5jb25zdCBmbG9hdCBzcGVjdWxhclN0cmVuZ3RoID0gMC41O1xcclxcbmNvbnN0IGZsb2F0IHNwZWN1bGFyUG93ZXIgPSAzMi4wO1xcclxcbmNvbnN0IHZlYzMgbGlnaHRDb2xvciA9IHZlYzMoMS4wLCAxLjAsIDEuMCk7XFxyXFxuY29uc3QgdmVjMyBlbWlzc2l2ZUZhY3RvciA9IHZlYzMoMS4wLCAxLjAsIDEuMCk7XFxyXFxuXFxyXFxudmVjMyBzcmdiVG9MaW5lYXIodmVjNCBzcmdiSW4pIHtcXHJcXG4gICAgcmV0dXJuIHBvdyhzcmdiSW4ucmdiLCB2ZWMzKDIuMikpO1xcclxcbn1cXHJcXG5cXHJcXG5mbG9hdCBEaXN0cmlidXRpb25HR1godmVjMyBOLCB2ZWMzIEgsIGZsb2F0IHJvdWdobmVzcykge1xcclxcbiAgICBmbG9hdCBhID0gcm91Z2huZXNzKnJvdWdobmVzcztcXHJcXG4gICAgZmxvYXQgYTIgPSBtYXgoYSphLCAwLjAwMDEpO1xcclxcbiAgICBmbG9hdCBOZG90SCA9IG1heChkb3QoTiwgSCksIDAuMCk7XFxyXFxuICAgIGZsb2F0IE5kb3RIMiA9IE5kb3RIKk5kb3RIO1xcclxcblxcclxcbiAgICBmbG9hdCBub20gICA9IGEyO1xcclxcbiAgICBmbG9hdCBkZW5vbSA9IChOZG90SDIgKiAoYTIgLSAxLjApICsgMS4wKTtcXHJcXG4gICAgZGVub20gPSBQSSAqIGRlbm9tICogZGVub207XFxyXFxuXFxyXFxuICAgIHJldHVybiBub20gLyBtYXgoZGVub20sIDAuMDAwMSk7XFxyXFxufVxcclxcblxcclxcbmZsb2F0IEdlb21ldHJ5U2NobGlja0dHWChmbG9hdCBOZG90ViwgZmxvYXQgcm91Z2huZXNzKSB7XFxyXFxuICAgIGZsb2F0IHIgPSAocm91Z2huZXNzICsgMS4wKTtcXHJcXG4gICAgZmxvYXQgayA9IChyKnIpIC8gOC4wO1xcclxcblxcclxcbiAgICBmbG9hdCBub20gICA9IE5kb3RWO1xcclxcbiAgICBmbG9hdCBkZW5vbSA9IE5kb3RWICogKDEuMCAtIGspICsgaztcXHJcXG5cXHJcXG4gICAgcmV0dXJuIG5vbSAvIGRlbm9tO1xcclxcbn1cXHJcXG5cXHJcXG5mbG9hdCBHZW9tZXRyeVNtaXRoKHZlYzMgTiwgdmVjMyBWLCB2ZWMzIEwsIGZsb2F0IHJvdWdobmVzcykge1xcclxcbiAgICBmbG9hdCBOZG90ViA9IG1heChkb3QoTiwgViksIDAuMCk7XFxyXFxuICAgIGZsb2F0IE5kb3RMID0gbWF4KGRvdChOLCBMKSwgMC4wKTtcXHJcXG4gICAgZmxvYXQgZ2d4MiA9IEdlb21ldHJ5U2NobGlja0dHWChOZG90Viwgcm91Z2huZXNzKTtcXHJcXG4gICAgZmxvYXQgZ2d4MSA9IEdlb21ldHJ5U2NobGlja0dHWChOZG90TCwgcm91Z2huZXNzKTtcXHJcXG5cXHJcXG4gICAgcmV0dXJuIGdneDEgKiBnZ3gyO1xcclxcbn1cXHJcXG5cXHJcXG52ZWMzIGZyZXNuZWxTY2hsaWNrKGZsb2F0IGNvc1RoZXRhLCB2ZWMzIEYwKSB7XFxyXFxuICAgIHJldHVybiBGMCArICgxLjAgLSBGMCkgKiBwb3coMS4wIC0gY29zVGhldGEsIDUuMCk7XFxyXFxufVxcclxcblxcclxcbnZvaWQgbWFpbigpIHtcXHJcXG4gICAgI2lmZGVmIEJBU0VDT0xPUlRFWFRVUkVcXHJcXG4gICAgICAgIHZlYzMgYmFzZUNvbG9yID0gc3JnYlRvTGluZWFyKHRleHR1cmUoYmFzZUNvbG9yVGV4dHVyZSwgb3V0VVYpKTtcXHJcXG4gICAgICAgIGZsb2F0IGFscGhhID0gdGV4dHVyZShiYXNlQ29sb3JUZXh0dXJlLCBvdXRVVikuYTtcXHJcXG4gICAgI2Vsc2VcXHJcXG4gICAgICAgIHZlYzMgYmFzZUNvbG9yID0gYmFzZUNvbG9yRmFjdG9yLnJnYjtcXHJcXG4gICAgICAgIGZsb2F0IGFscGhhID0gYmFzZUNvbG9yRmFjdG9yLmE7XFxyXFxuICAgICNlbmRpZlxcclxcblxcclxcbiAgICAjaWZkZWYgT0NDTFVTSU9OTUFQXFxyXFxuICAgICAgICBmbG9hdCBhbyA9IHRleHR1cmUob2NjbHVzaW9uVGV4dHVyZSwgb3V0VVYpLnI7XFxyXFxuICAgICNlbmRpZlxcclxcblxcclxcbiAgICAjaWZkZWYgTUVUQUxST1VHSE5FU1NNQVBcXHJcXG4gICAgICAgIGZsb2F0IHJvdWdobmVzcyA9IHRleHR1cmUobWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlLCBvdXRVVikuZztcXHJcXG4gICAgICAgIGZsb2F0IG1ldGFsbGljID0gdGV4dHVyZShtZXRhbGxpY1JvdWdobmVzc1RleHR1cmUsIG91dFVWKS5iO1xcclxcbiAgICAjZW5kaWZcXHJcXG5cXHJcXG4gICAgI2lmZGVmIFRBTkdFTlRcXHJcXG4gICAgICAgICNpZmRlZiBOT1JNQUxNQVBcXHJcXG4gICAgICAgICAgICB2ZWMzIG4gPSB0ZXh0dXJlKG5vcm1hbFRleHR1cmUsIG91dFVWKS5yZ2I7XFxyXFxuICAgICAgICAgICAgbiA9IG5vcm1hbGl6ZShvdXRUQk4gKiAoMi4wICogbiAtIDEuMCkpO1xcclxcbiAgICAgICAgI2Vsc2VcXHJcXG4gICAgICAgICAgICB2ZWMzIG4gPSBvdXRUQk5bMl0ueHl6O1xcclxcbiAgICAgICAgI2VuZGlmXFxyXFxuICAgICNlbHNlXFxyXFxuICAgICAgICB2ZWMzIG4gPSBvdXROb3JtYWw7XFxyXFxuICAgICNlbmRpZlxcclxcblxcclxcbiAgICB2ZWMzIHZpZXdEaXIgPSBub3JtYWxpemUodmlld1BvcyAtIG91dFBvc2l0aW9uKTtcXHJcXG4gICAgdmVjMyBsaWdodERpciA9IG5vcm1hbGl6ZShsaWdodFBvcyAtIG91dFBvc2l0aW9uKTtcXHJcXG4gICAgdmVjMyBIID0gbm9ybWFsaXplKHZpZXdEaXIgKyBsaWdodERpcik7XFxyXFxuICAgIGZsb2F0IGRpc3RhbmNlID0gbGVuZ3RoKGxpZ2h0UG9zIC0gb3V0UG9zaXRpb24pO1xcclxcbiAgICBmbG9hdCBhdHRlbnVhdGlvbiA9IDEuMCAvIChkaXN0YW5jZSAqIGRpc3RhbmNlKTtcXHJcXG4gICAgdmVjMyByYWRpYW5jZSA9IGxpZ2h0Q29sb3IgKiAyLjA7XFxyXFxuXFxyXFxuICAgICNpZmRlZiBVU0VfUEJSXFxyXFxuICAgICAgICB2ZWMzIEYwID0gdmVjMygwLjA0KTsgXFxyXFxuICAgICAgICBGMCA9IG1peChGMCwgYmFzZUNvbG9yLCBtZXRhbGxpYyk7XFxyXFxuXFxyXFxuICAgICAgICB2ZWMzIGxpZ2h0ID0gdmVjMygwLjApO1xcclxcblxcclxcbiAgICAgICAgZmxvYXQgTkRGID0gRGlzdHJpYnV0aW9uR0dYKG4sIEgsIHJvdWdobmVzcyk7ICAgICAgICBcXHJcXG4gICAgICAgIGZsb2F0IEcgPSBHZW9tZXRyeVNtaXRoKG4sIHZpZXdEaXIsIGxpZ2h0RGlyLCByb3VnaG5lc3MpOyAgICAgIFxcclxcbiAgICAgICAgdmVjMyBGID0gZnJlc25lbFNjaGxpY2sobWF4KGRvdChILCB2aWV3RGlyKSwgMC4wKSwgRjApOyAgICAgICBcXHJcXG4gICAgICAgIFxcclxcbiAgICAgICAgdmVjMyBrUyA9IEY7XFxyXFxuICAgICAgICB2ZWMzIGtEID0gdmVjMygxLjApIC0ga1M7XFxyXFxuICAgICAgICBrRCAqPSAxLjAgLSBtZXRhbGxpYzsgICAgIFxcclxcbiAgICAgICAgXFxyXFxuICAgICAgICB2ZWMzIG5vbWluYXRvciA9IE5ERiAqIEcgKiBGO1xcclxcbiAgICAgICAgZmxvYXQgZGVub21pbmF0b3IgPSA0LjAgKiBtYXgoZG90KG4sIHZpZXdEaXIpLCAwLjApICogbWF4KGRvdChuLCBsaWdodERpciksIDAuMCk7XFxyXFxuICAgICAgICB2ZWMzIHNwZWN1bGFyID0gbm9taW5hdG9yIC8gbWF4KGRlbm9taW5hdG9yLCAwLjAwMSk7ICBcXHJcXG5cXHJcXG4gICAgICAgIGZsb2F0IE5kb3RMID0gbWF4KGRvdChuLCBsaWdodERpciksIDAuMCk7ICAgICAgICAgICAgICAgIFxcclxcbiAgICAgICAgbGlnaHQgKz0gKGtEICogYmFzZUNvbG9yIC8gUEkgKyBzcGVjdWxhcikgKiByYWRpYW5jZSAqIE5kb3RMO1xcclxcblxcclxcbiAgICAgICAgI2lmZGVmIE9DQ0xVU0lPTk1BUFxcclxcbiAgICAgICAgICAgIHZlYzMgYW1iaWVudCA9IHZlYzMoMC4wMykgKiBiYXNlQ29sb3IgKiBhbztcXHJcXG4gICAgICAgICNlbHNlXFxyXFxuICAgICAgICAgICAgdmVjMyBhbWJpZW50ID0gYmFzZUNvbG9yO1xcclxcbiAgICAgICAgI2VuZGlmXFxyXFxuICAgICAgICBiYXNlQ29sb3IgPSBhbWJpZW50ICsgbGlnaHQ7XFxyXFxuXFxyXFxuICAgICAgICAjaWZkZWYgRU1JU1NJVkVNQVBcXHJcXG4gICAgICAgICAgICB2ZWMzIGVtaXNzaXZlID0gc3JnYlRvTGluZWFyKHRleHR1cmUoZW1pc3NpdmVUZXh0dXJlLCBvdXRVVikpICogZW1pc3NpdmVGYWN0b3I7XFxyXFxuICAgICAgICAgICAgYmFzZUNvbG9yLnJnYiArPSBlbWlzc2l2ZTtcXHJcXG4gICAgICAgICNlbmRpZlxcclxcblxcclxcbiAgICAgICAgYmFzZUNvbG9yID0gYmFzZUNvbG9yIC8gKGJhc2VDb2xvciArIHZlYzMoMS4wKSk7XFxyXFxuICAgICAgICBiYXNlQ29sb3IgPSBwb3coYmFzZUNvbG9yLCB2ZWMzKDEuMCAvIDIuMikpOyAgXFxyXFxuICAgXFxyXFxuICAgICAgICBjb2xvciA9IHZlYzQoYmFzZUNvbG9yLCAxLjApO1xcclxcbiAgICAjZWxzZVxcclxcbiAgICAgICAgdmVjMyBhbWJpZW50ID0gYW1iaWVudFN0cmVuZ3RoICogbGlnaHRDb2xvcjtcXHJcXG5cXHJcXG4gICAgICAgIGZsb2F0IGRpZmYgPSBtYXgoZG90KG4sIGxpZ2h0RGlyKSwgMC4wKTtcXHJcXG4gICAgICAgIHZlYzMgZGlmZnVzZSA9IGRpZmYgKiBsaWdodENvbG9yO1xcclxcblxcclxcbiAgICAgICAgdmVjMyByZWZsZWN0RGlyID0gcmVmbGVjdCgtbGlnaHREaXIsIG4pO1xcclxcbiAgICAgICAgZmxvYXQgc3BlYyA9IHBvdyhtYXgoZG90KHZpZXdEaXIsIHJlZmxlY3REaXIpLCAwLjApLCBzcGVjdWxhclBvd2VyKTtcXHJcXG4gICAgICAgIHZlYzMgc3BlY3VsYXIgPSBzcGVjdWxhclN0cmVuZ3RoICogc3BlYyAqIGxpZ2h0Q29sb3I7XFxyXFxuXFxyXFxuICAgICAgICBjb2xvciA9IHZlYzQoYmFzZUNvbG9yLnJnYiAqIChhbWJpZW50ICsgZGlmZnVzZSArIHNwZWN1bGFyKSwgYWxwaGEpO1xcclxcbiAgICAjZW5kaWZcXHJcXG59XFxyXFxuXCIiXSwibWFwcGluZ3MiOiJBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/shaders/fragment.glsl\n");

/***/ }),

/***/ "./src/shaders/vertex.glsl":
/*!*********************************!*\
  !*** ./src/shaders/vertex.glsl ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"#version 300 es\\r\\nprecision highp float;\\r\\n\\r\\nlayout (location = 0) in vec3 inPosition;\\r\\nlayout (location = 1) in vec3 inNormal;\\r\\nlayout (location = 2) in vec2 inUV;\\r\\nlayout (location = 3) in vec4 inJoint;\\r\\nlayout (location = 4) in vec4 inWeight;\\r\\nlayout (location = 5) in vec4 inTangent;\\r\\n\\r\\nout vec2 outUV;\\r\\nout vec3 outPosition;\\r\\n#ifdef TANGENT\\r\\n    out mat3 outTBN;\\r\\n#else\\r\\n    out vec3 outNormal;\\r\\n#endif\\r\\n\\r\\nuniform Matrices {\\r\\n    mat4 model;\\r\\n    mat4 normalMatrix;\\r\\n    mat4 view;\\r\\n    mat4 projection;\\r\\n};\\r\\n\\r\\n#ifdef JOINTNUMBER\\r\\nuniform Skin {\\r\\n    mat4 joint[JOINTNUMBER];\\r\\n};\\r\\n#endif\\r\\n\\r\\nvoid main() {\\r\\n    #ifdef JOINTNUMBER\\r\\n        mat4 skin = inWeight.x * joint[int(inJoint.x)];\\r\\n        skin += inWeight.y * joint[int(inJoint.y)];\\r\\n        skin += inWeight.z * joint[int(inJoint.z)];\\r\\n        skin += inWeight.w * joint[int(inJoint.w)];\\r\\n    #else\\r\\n        mat4 skin = mat4(1.0);\\r\\n    #endif\\r\\n\\r\\n    outUV = inUV;\\r\\n    #ifdef TANGENT\\r\\n        vec3 normalW = normalize(vec3(model * vec4(inNormal.xyz, 0.0)));\\r\\n        vec3 tangentW = normalize(vec3(model * vec4(inTangent.xyz, 0.0)));\\r\\n        vec3 bitangentW = cross(normalW, tangentW) * inTangent.w;\\r\\n        outTBN = mat3(tangentW, bitangentW, normalW);\\r\\n    #else\\r\\n        outNormal = normalize(mat3(normalMatrix) * mat3(skin) * inNormal);\\r\\n    #endif\\r\\n    outPosition = vec3(model * skin * vec4(inPosition, 1.0));\\r\\n    gl_Position = projection * view * model * skin * vec4(inPosition, 1.0);\\r\\n}\\r\\n\"//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2hhZGVycy92ZXJ0ZXguZ2xzbC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL3JlZGN1YmUvLi9zcmMvc2hhZGVycy92ZXJ0ZXguZ2xzbD8wY2UwIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gXCIjdmVyc2lvbiAzMDAgZXNcXHJcXG5wcmVjaXNpb24gaGlnaHAgZmxvYXQ7XFxyXFxuXFxyXFxubGF5b3V0IChsb2NhdGlvbiA9IDApIGluIHZlYzMgaW5Qb3NpdGlvbjtcXHJcXG5sYXlvdXQgKGxvY2F0aW9uID0gMSkgaW4gdmVjMyBpbk5vcm1hbDtcXHJcXG5sYXlvdXQgKGxvY2F0aW9uID0gMikgaW4gdmVjMiBpblVWO1xcclxcbmxheW91dCAobG9jYXRpb24gPSAzKSBpbiB2ZWM0IGluSm9pbnQ7XFxyXFxubGF5b3V0IChsb2NhdGlvbiA9IDQpIGluIHZlYzQgaW5XZWlnaHQ7XFxyXFxubGF5b3V0IChsb2NhdGlvbiA9IDUpIGluIHZlYzQgaW5UYW5nZW50O1xcclxcblxcclxcbm91dCB2ZWMyIG91dFVWO1xcclxcbm91dCB2ZWMzIG91dFBvc2l0aW9uO1xcclxcbiNpZmRlZiBUQU5HRU5UXFxyXFxuICAgIG91dCBtYXQzIG91dFRCTjtcXHJcXG4jZWxzZVxcclxcbiAgICBvdXQgdmVjMyBvdXROb3JtYWw7XFxyXFxuI2VuZGlmXFxyXFxuXFxyXFxudW5pZm9ybSBNYXRyaWNlcyB7XFxyXFxuICAgIG1hdDQgbW9kZWw7XFxyXFxuICAgIG1hdDQgbm9ybWFsTWF0cml4O1xcclxcbiAgICBtYXQ0IHZpZXc7XFxyXFxuICAgIG1hdDQgcHJvamVjdGlvbjtcXHJcXG59O1xcclxcblxcclxcbiNpZmRlZiBKT0lOVE5VTUJFUlxcclxcbnVuaWZvcm0gU2tpbiB7XFxyXFxuICAgIG1hdDQgam9pbnRbSk9JTlROVU1CRVJdO1xcclxcbn07XFxyXFxuI2VuZGlmXFxyXFxuXFxyXFxudm9pZCBtYWluKCkge1xcclxcbiAgICAjaWZkZWYgSk9JTlROVU1CRVJcXHJcXG4gICAgICAgIG1hdDQgc2tpbiA9IGluV2VpZ2h0LnggKiBqb2ludFtpbnQoaW5Kb2ludC54KV07XFxyXFxuICAgICAgICBza2luICs9IGluV2VpZ2h0LnkgKiBqb2ludFtpbnQoaW5Kb2ludC55KV07XFxyXFxuICAgICAgICBza2luICs9IGluV2VpZ2h0LnogKiBqb2ludFtpbnQoaW5Kb2ludC56KV07XFxyXFxuICAgICAgICBza2luICs9IGluV2VpZ2h0LncgKiBqb2ludFtpbnQoaW5Kb2ludC53KV07XFxyXFxuICAgICNlbHNlXFxyXFxuICAgICAgICBtYXQ0IHNraW4gPSBtYXQ0KDEuMCk7XFxyXFxuICAgICNlbmRpZlxcclxcblxcclxcbiAgICBvdXRVViA9IGluVVY7XFxyXFxuICAgICNpZmRlZiBUQU5HRU5UXFxyXFxuICAgICAgICB2ZWMzIG5vcm1hbFcgPSBub3JtYWxpemUodmVjMyhtb2RlbCAqIHZlYzQoaW5Ob3JtYWwueHl6LCAwLjApKSk7XFxyXFxuICAgICAgICB2ZWMzIHRhbmdlbnRXID0gbm9ybWFsaXplKHZlYzMobW9kZWwgKiB2ZWM0KGluVGFuZ2VudC54eXosIDAuMCkpKTtcXHJcXG4gICAgICAgIHZlYzMgYml0YW5nZW50VyA9IGNyb3NzKG5vcm1hbFcsIHRhbmdlbnRXKSAqIGluVGFuZ2VudC53O1xcclxcbiAgICAgICAgb3V0VEJOID0gbWF0Myh0YW5nZW50VywgYml0YW5nZW50Vywgbm9ybWFsVyk7XFxyXFxuICAgICNlbHNlXFxyXFxuICAgICAgICBvdXROb3JtYWwgPSBub3JtYWxpemUobWF0Myhub3JtYWxNYXRyaXgpICogbWF0Myhza2luKSAqIGluTm9ybWFsKTtcXHJcXG4gICAgI2VuZGlmXFxyXFxuICAgIG91dFBvc2l0aW9uID0gdmVjMyhtb2RlbCAqIHNraW4gKiB2ZWM0KGluUG9zaXRpb24sIDEuMCkpO1xcclxcbiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb24gKiB2aWV3ICogbW9kZWwgKiBza2luICogdmVjNChpblBvc2l0aW9uLCAxLjApO1xcclxcbn1cXHJcXG5cIiJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/shaders/vertex.glsl\n");

/***/ }),

/***/ "./src/utils.ts":
/*!**********************!*\
  !*** ./src/utils.ts ***!
  \**********************/
/*! exports provided: setGl, isMatrix, random, getMatrixType, getDataType, getComponentType, getMethod, getAnimationComponent, range, interpolation, buildArray, compileShader, walk, sceneToArcBall, canvasToWorld, calculateProjection, calculateOffset, getAttributeIndex, calculateBinormals */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setGl\", function() { return setGl; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isMatrix\", function() { return isMatrix; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"random\", function() { return random; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getMatrixType\", function() { return getMatrixType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDataType\", function() { return getDataType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getComponentType\", function() { return getComponentType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getMethod\", function() { return getMethod; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAnimationComponent\", function() { return getAnimationComponent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"range\", function() { return range; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"interpolation\", function() { return interpolation; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"buildArray\", function() { return buildArray; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"compileShader\", function() { return compileShader; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"walk\", function() { return walk; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"sceneToArcBall\", function() { return sceneToArcBall; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"canvasToWorld\", function() { return canvasToWorld; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"calculateProjection\", function() { return calculateProjection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"calculateOffset\", function() { return calculateOffset; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAttributeIndex\", function() { return getAttributeIndex; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"calculateBinormals\", function() { return calculateBinormals; });\n/* harmony import */ var _matrix__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./matrix */ \"./src/matrix.ts\");\n\r\nconst glEnum = {};\r\nlet gl;\r\nfunction setGl(_gl) {\r\n    gl = _gl;\r\n    for (const k in gl) {\r\n        const v = gl[k];\r\n        if (typeof v === 'number') {\r\n            glEnum[v] = k;\r\n        }\r\n    }\r\n}\r\nfunction isMatrix(type) {\r\n    return glEnum[type] === 'FLOAT_MAT4' || glEnum[type] === 'FLOAT_MAT3' || glEnum[type] === 'FLOAT_MAT2';\r\n}\r\nfunction random(min, max) {\r\n    return Math.random() * (max - min) + min;\r\n}\r\nfunction getMatrixType(type) {\r\n    if (glEnum[type] === 'FLOAT_MAT4') {\r\n        return _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"];\r\n    }\r\n    if (glEnum[type] === 'FLOAT_MAT3') {\r\n        return _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix3\"];\r\n    }\r\n    if (glEnum[type] === 'FLOAT_MAT2') {\r\n        return _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix2\"];\r\n    }\r\n}\r\nfunction getDataType(type) {\r\n    let count;\r\n    switch (type) {\r\n        case 'MAT2':\r\n            count = 4;\r\n            break;\r\n        case 'MAT3':\r\n            count = 9;\r\n            break;\r\n        case 'MAT4':\r\n            count = 16;\r\n            break;\r\n        case 'VEC4':\r\n            count = 4;\r\n            break;\r\n        case 'VEC3':\r\n            count = 3;\r\n            break;\r\n        case 'VEC2':\r\n            count = 2;\r\n            break;\r\n        case 'SCALAR':\r\n            count = 1;\r\n            break;\r\n    }\r\n    return count;\r\n}\r\nfunction getComponentType(type) {\r\n    let count;\r\n    switch (glEnum[type]) {\r\n        case 'FLOAT_VEC4':\r\n            count = 4;\r\n            break;\r\n        case 'FLOAT_VEC3':\r\n            count = 3;\r\n            break;\r\n        case 'FLOAT_VEC2':\r\n            count = 2;\r\n            break;\r\n    }\r\n    return count;\r\n}\r\nfunction getMethod(type) {\r\n    let method;\r\n    switch (glEnum[type]) {\r\n        case 'FLOAT_VEC2':\r\n            method = 'uniform2f';\r\n            break;\r\n        case 'FLOAT_VEC4':\r\n            method = 'uniform4f';\r\n            break;\r\n        case 'FLOAT':\r\n            method = 'uniform1f';\r\n            break;\r\n        case 'FLOAT_VEC3':\r\n            method = 'uniform3f';\r\n            break;\r\n        case 'FLOAT_MAT4':\r\n            method = 'uniformMatrix4fv';\r\n            break;\r\n        case 'FLOAT_MAT3':\r\n            method = 'uniformMatrix3fv';\r\n            break;\r\n        case 'FLOAT_MAT2':\r\n            method = 'uniformMatrix2fv';\r\n            break;\r\n        case 'SAMPLER_2D':\r\n            method = 'uniform1i';\r\n            break;\r\n    }\r\n    return method;\r\n}\r\nfunction getAnimationComponent(type) {\r\n    if (type === 'rotation') {\r\n        return 4;\r\n    }\r\n    else if (type === 'weights') {\r\n        return 2;\r\n    }\r\n    else {\r\n        return 3;\r\n    }\r\n}\r\nfunction range(min, max, value) {\r\n    return (value - min) / (max - min);\r\n}\r\nfunction interpolation(time, frames) {\r\n    if (frames.length === 0) {\r\n        return [-1, -1, 0];\r\n    }\r\n    let prev = -1;\r\n    for (let i = frames.length - 1; i >= 0; i--) {\r\n        if (time >= frames[i].time) {\r\n            prev = i;\r\n            break;\r\n        }\r\n    }\r\n    if (prev === -1 || prev === frames.length - 1) {\r\n        if (prev < 0) {\r\n            prev = 0;\r\n        }\r\n        return [prev, prev, 0];\r\n    }\r\n    else {\r\n        const startFrame = frames[prev];\r\n        const endFrame = frames[prev + 1];\r\n        time = Math.max(startFrame.time, Math.min(time, endFrame.time));\r\n        const t = range(startFrame.time, endFrame.time, time);\r\n        return [prev, prev + 1, t];\r\n    }\r\n}\r\nfunction getCount(type) {\r\n    let arr;\r\n    switch (glEnum[type]) {\r\n        case 'BYTE':\r\n        case 'UNSIGNED_BYTE':\r\n            arr = 1;\r\n            break;\r\n        case 'SHORT':\r\n        case 'UNSIGNED_SHORT':\r\n            arr = 2;\r\n            break;\r\n        case 'UNSIGNED_INT':\r\n        case 'FLOAT':\r\n            arr = 4;\r\n            break;\r\n    }\r\n    return arr;\r\n}\r\nfunction buildArray(arrayBuffer, type, offset, length, stride, count) {\r\n    const l = length;\r\n    const c = length / count;\r\n    if (stride && stride !== getCount(type) * c) {\r\n        length = stride * count / getCount(type) - offset / getCount(type);\r\n    }\r\n    let arr;\r\n    switch (glEnum[type]) {\r\n        case 'BYTE':\r\n            arr = new Int8Array(arrayBuffer, offset, length);\r\n            break;\r\n        case 'UNSIGNED_BYTE':\r\n            arr = new Uint8Array(arrayBuffer, offset, length);\r\n            break;\r\n        case 'SHORT':\r\n            arr = new Int16Array(arrayBuffer, offset, length);\r\n            break;\r\n        case 'UNSIGNED_SHORT':\r\n            arr = new Uint16Array(arrayBuffer, offset, length);\r\n            break;\r\n        case 'UNSIGNED_INT':\r\n            arr = new Uint32Array(arrayBuffer, offset, length);\r\n            break;\r\n        case 'FLOAT':\r\n            arr = new Float32Array(arrayBuffer, offset, length);\r\n            break;\r\n    }\r\n    if (stride && stride !== getCount(type) * c) {\r\n        const stridedArr = new Float32Array(l);\r\n        let j = 0;\r\n        for (let i = 0; i < stridedArr.length; i = i + c) {\r\n            stridedArr[i] = arr[j];\r\n            stridedArr[i + 1] = arr[j + 1];\r\n            stridedArr[i + 2] = arr[j + 2];\r\n            j = j + c * (stride / getCount(type) / c);\r\n        }\r\n        return stridedArr;\r\n    }\r\n    return arr;\r\n}\r\nfunction compileShader(type, shaderSource, program) {\r\n    const shader = gl.createShader(type);\r\n    gl.shaderSource(shader, shaderSource);\r\n    gl.compileShader(shader);\r\n    gl.attachShader(program, shader);\r\n    const log = gl.getShaderInfoLog(shader);\r\n    if (log) {\r\n        console.error(log);\r\n    }\r\n}\r\nfunction walk(node, callback) {\r\n    function _walk(node) {\r\n        callback(node);\r\n        if (node.children) {\r\n            node.children.forEach(_walk);\r\n        }\r\n    }\r\n    _walk(node);\r\n}\r\nfunction sceneToArcBall(pos) {\r\n    let len = pos[0] * pos[0] + pos[1] * pos[1];\r\n    const sz = 0.04 * 0.04 - len;\r\n    if (sz > 0) {\r\n        return [pos[0], pos[1], Math.sqrt(sz)];\r\n    }\r\n    else {\r\n        len = Math.sqrt(len);\r\n        return [0.04 * pos[0] / len, 0.04 * pos[1] / len, 0];\r\n    }\r\n}\r\nfunction canvasToWorld(vec2, projection, width, height) {\r\n    const [x, y] = vec2;\r\n    const newM = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]();\r\n    newM.setTranslate(new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"]([0, 0, 0.05]));\r\n    const m = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"](projection);\r\n    m.multiply(newM);\r\n    const mp = m.multiplyVector4(new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector4\"]([0, 0, 0, 1]));\r\n    mp.elements[0] = (2 * x / width - 1) * mp.elements[3];\r\n    mp.elements[1] = (-2 * y / height + 1) * mp.elements[3];\r\n    const v = m.invert().multiplyVector4(mp);\r\n    return [v.elements[0], v.elements[1]];\r\n}\r\nfunction calculateProjection(cam, aspect, zoom) {\r\n    let proj;\r\n    if (cam.type === 'perspective' && cam.perspective) {\r\n        const { yfov } = cam.perspective;\r\n        const xfov = yfov * aspect;\r\n        proj = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]().setPerspective(xfov * zoom * (180 / Math.PI), aspect, cam.perspective.znear || 1, cam.perspective.zfar || 2e6);\r\n    }\r\n    else if (cam.type === 'orthographic' && cam.orthographic) {\r\n        proj = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Matrix4\"]().setOrtho(cam.orthographic.xmag, cam.orthographic.ymag, cam.orthographic.znear, cam.orthographic.zfar);\r\n    }\r\n    return proj;\r\n}\r\nfunction calculateOffset(a = 0, b = 0) {\r\n    return a + b;\r\n}\r\nfunction getAttributeIndex(name) {\r\n    let index;\r\n    switch (name) {\r\n        case 'POSITION':\r\n            index = [0, 3, gl.FLOAT];\r\n            break;\r\n        case 'NORMAL':\r\n            index = [1, 3, gl.FLOAT];\r\n            break;\r\n        case 'TEXCOORD_0':\r\n            index = [2, 2, gl.FLOAT];\r\n            break;\r\n        case 'JOINTS_0':\r\n            index = [3, 4, gl.UNSIGNED_SHORT];\r\n            break;\r\n        case 'WEIGHTS_0':\r\n            index = [4, 4, gl.FLOAT];\r\n            break;\r\n        case 'TANGENT':\r\n            index = [5, 4, gl.FLOAT];\r\n            break;\r\n    }\r\n    return index;\r\n}\r\nfunction calculateBinormals(index, vertex, normal, uv) {\r\n    const tangent = new Float32Array(normal.length / 3 * 4);\r\n    for (let i = 0; i < index.length; i += 3) {\r\n        const faceIndexes = [index[i], index[i + 1], index[i + 2]];\r\n        const faceVertices = faceIndexes.map(ix => vectorFromArray(vertex, ix));\r\n        const faceUVs = faceIndexes.map(ix => vectorFromArray(uv, ix, 2));\r\n        const dv1 = faceVertices[1].subtract(faceVertices[0]);\r\n        const dv2 = faceVertices[2].subtract(faceVertices[0]);\r\n        const duv1 = faceUVs[1].subtract(faceUVs[0]);\r\n        const duv2 = faceUVs[2].subtract(faceUVs[0]);\r\n        let r = (duv1.elements[0] * duv2.elements[1] - duv1.elements[1] * duv2.elements[0]);\r\n        r = (r !== 0) ? 1.0 / r : 1.0;\r\n        const udir = new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"]([\r\n            (duv2.elements[1] * dv1.elements[0] - duv1.elements[1] * dv2.elements[0]) * r,\r\n            (duv2.elements[1] * dv1.elements[1] - duv1.elements[1] * dv2.elements[1]) * r,\r\n            (duv2.elements[1] * dv1.elements[2] - duv1.elements[1] * dv2.elements[2]) * r\r\n        ]);\r\n        udir.normalize();\r\n        faceIndexes.forEach(ix => {\r\n            accumulateVectorInArray(tangent, ix, udir);\r\n        });\r\n    }\r\n    return tangent;\r\n    function vectorFromArray(array, index, elements = 3) {\r\n        index = index * elements;\r\n        if (elements === 3) {\r\n            return new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector3\"]([array[index], array[index + 1], array[index + 2]]);\r\n        }\r\n        if (elements === 2) {\r\n            return new _matrix__WEBPACK_IMPORTED_MODULE_0__[\"Vector2\"]([array[index], array[index + 1]]);\r\n        }\r\n    }\r\n    function accumulateVectorInArray(array, index, vector, elements = 4, accumulator = (acc, x) => acc + x) {\r\n        index = index * elements;\r\n        for (let i = 0; i < elements; ++i) {\r\n            if (i === 3) {\r\n                array[index + i] = -1;\r\n            }\r\n            else {\r\n                array[index + i] = accumulator(array[index + i], vector.elements[i]);\r\n            }\r\n        }\r\n    }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdXRpbHMudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZWRjdWJlLy4vc3JjL3V0aWxzLnRzPzhkYjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWF0cml4MiwgTWF0cml4MywgTWF0cml4NCwgVmVjdG9yMiwgVmVjdG9yMywgVmVjdG9yNCB9IGZyb20gJy4vbWF0cml4JztcclxuY29uc3QgZ2xFbnVtID0ge307XHJcbmxldCBnbDtcclxuZXhwb3J0IGZ1bmN0aW9uIHNldEdsKF9nbCkge1xyXG4gICAgZ2wgPSBfZ2w7XHJcbiAgICBmb3IgKGNvbnN0IGsgaW4gZ2wpIHtcclxuICAgICAgICBjb25zdCB2ID0gZ2xba107XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICBnbEVudW1bdl0gPSBrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5leHBvcnQgZnVuY3Rpb24gaXNNYXRyaXgodHlwZSkge1xyXG4gICAgcmV0dXJuIGdsRW51bVt0eXBlXSA9PT0gJ0ZMT0FUX01BVDQnIHx8IGdsRW51bVt0eXBlXSA9PT0gJ0ZMT0FUX01BVDMnIHx8IGdsRW51bVt0eXBlXSA9PT0gJ0ZMT0FUX01BVDInO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiByYW5kb20obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW47XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIGdldE1hdHJpeFR5cGUodHlwZSkge1xyXG4gICAgaWYgKGdsRW51bVt0eXBlXSA9PT0gJ0ZMT0FUX01BVDQnKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdHJpeDQ7XHJcbiAgICB9XHJcbiAgICBpZiAoZ2xFbnVtW3R5cGVdID09PSAnRkxPQVRfTUFUMycpIHtcclxuICAgICAgICByZXR1cm4gTWF0cml4MztcclxuICAgIH1cclxuICAgIGlmIChnbEVudW1bdHlwZV0gPT09ICdGTE9BVF9NQVQyJykge1xyXG4gICAgICAgIHJldHVybiBNYXRyaXgyO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREYXRhVHlwZSh0eXBlKSB7XHJcbiAgICBsZXQgY291bnQ7XHJcbiAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICBjYXNlICdNQVQyJzpcclxuICAgICAgICAgICAgY291bnQgPSA0O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdNQVQzJzpcclxuICAgICAgICAgICAgY291bnQgPSA5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdNQVQ0JzpcclxuICAgICAgICAgICAgY291bnQgPSAxNjtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnVkVDNCc6XHJcbiAgICAgICAgICAgIGNvdW50ID0gNDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnVkVDMyc6XHJcbiAgICAgICAgICAgIGNvdW50ID0gMztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnVkVDMic6XHJcbiAgICAgICAgICAgIGNvdW50ID0gMjtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnU0NBTEFSJzpcclxuICAgICAgICAgICAgY291bnQgPSAxO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiBjb3VudDtcclxufVxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50VHlwZSh0eXBlKSB7XHJcbiAgICBsZXQgY291bnQ7XHJcbiAgICBzd2l0Y2ggKGdsRW51bVt0eXBlXSkge1xyXG4gICAgICAgIGNhc2UgJ0ZMT0FUX1ZFQzQnOlxyXG4gICAgICAgICAgICBjb3VudCA9IDQ7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0ZMT0FUX1ZFQzMnOlxyXG4gICAgICAgICAgICBjb3VudCA9IDM7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0ZMT0FUX1ZFQzInOlxyXG4gICAgICAgICAgICBjb3VudCA9IDI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvdW50O1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNZXRob2QodHlwZSkge1xyXG4gICAgbGV0IG1ldGhvZDtcclxuICAgIHN3aXRjaCAoZ2xFbnVtW3R5cGVdKSB7XHJcbiAgICAgICAgY2FzZSAnRkxPQVRfVkVDMic6XHJcbiAgICAgICAgICAgIG1ldGhvZCA9ICd1bmlmb3JtMmYnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdGTE9BVF9WRUM0JzpcclxuICAgICAgICAgICAgbWV0aG9kID0gJ3VuaWZvcm00Zic7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0ZMT0FUJzpcclxuICAgICAgICAgICAgbWV0aG9kID0gJ3VuaWZvcm0xZic7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0ZMT0FUX1ZFQzMnOlxyXG4gICAgICAgICAgICBtZXRob2QgPSAndW5pZm9ybTNmJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnRkxPQVRfTUFUNCc6XHJcbiAgICAgICAgICAgIG1ldGhvZCA9ICd1bmlmb3JtTWF0cml4NGZ2JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnRkxPQVRfTUFUMyc6XHJcbiAgICAgICAgICAgIG1ldGhvZCA9ICd1bmlmb3JtTWF0cml4M2Z2JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnRkxPQVRfTUFUMic6XHJcbiAgICAgICAgICAgIG1ldGhvZCA9ICd1bmlmb3JtTWF0cml4MmZ2JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnU0FNUExFUl8yRCc6XHJcbiAgICAgICAgICAgIG1ldGhvZCA9ICd1bmlmb3JtMWknO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiBtZXRob2Q7XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEFuaW1hdGlvbkNvbXBvbmVudCh0eXBlKSB7XHJcbiAgICBpZiAodHlwZSA9PT0gJ3JvdGF0aW9uJykge1xyXG4gICAgICAgIHJldHVybiA0O1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAodHlwZSA9PT0gJ3dlaWdodHMnKSB7XHJcbiAgICAgICAgcmV0dXJuIDI7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gMztcclxuICAgIH1cclxufVxyXG5leHBvcnQgZnVuY3Rpb24gcmFuZ2UobWluLCBtYXgsIHZhbHVlKSB7XHJcbiAgICByZXR1cm4gKHZhbHVlIC0gbWluKSAvIChtYXggLSBtaW4pO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBpbnRlcnBvbGF0aW9uKHRpbWUsIGZyYW1lcykge1xyXG4gICAgaWYgKGZyYW1lcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gWy0xLCAtMSwgMF07XHJcbiAgICB9XHJcbiAgICBsZXQgcHJldiA9IC0xO1xyXG4gICAgZm9yIChsZXQgaSA9IGZyYW1lcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgIGlmICh0aW1lID49IGZyYW1lc1tpXS50aW1lKSB7XHJcbiAgICAgICAgICAgIHByZXYgPSBpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAocHJldiA9PT0gLTEgfHwgcHJldiA9PT0gZnJhbWVzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICBpZiAocHJldiA8IDApIHtcclxuICAgICAgICAgICAgcHJldiA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbcHJldiwgcHJldiwgMF07XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBjb25zdCBzdGFydEZyYW1lID0gZnJhbWVzW3ByZXZdO1xyXG4gICAgICAgIGNvbnN0IGVuZEZyYW1lID0gZnJhbWVzW3ByZXYgKyAxXTtcclxuICAgICAgICB0aW1lID0gTWF0aC5tYXgoc3RhcnRGcmFtZS50aW1lLCBNYXRoLm1pbih0aW1lLCBlbmRGcmFtZS50aW1lKSk7XHJcbiAgICAgICAgY29uc3QgdCA9IHJhbmdlKHN0YXJ0RnJhbWUudGltZSwgZW5kRnJhbWUudGltZSwgdGltZSk7XHJcbiAgICAgICAgcmV0dXJuIFtwcmV2LCBwcmV2ICsgMSwgdF07XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0Q291bnQodHlwZSkge1xyXG4gICAgbGV0IGFycjtcclxuICAgIHN3aXRjaCAoZ2xFbnVtW3R5cGVdKSB7XHJcbiAgICAgICAgY2FzZSAnQllURSc6XHJcbiAgICAgICAgY2FzZSAnVU5TSUdORURfQllURSc6XHJcbiAgICAgICAgICAgIGFyciA9IDE7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1NIT1JUJzpcclxuICAgICAgICBjYXNlICdVTlNJR05FRF9TSE9SVCc6XHJcbiAgICAgICAgICAgIGFyciA9IDI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1VOU0lHTkVEX0lOVCc6XHJcbiAgICAgICAgY2FzZSAnRkxPQVQnOlxyXG4gICAgICAgICAgICBhcnIgPSA0O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQXJyYXkoYXJyYXlCdWZmZXIsIHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBzdHJpZGUsIGNvdW50KSB7XHJcbiAgICBjb25zdCBsID0gbGVuZ3RoO1xyXG4gICAgY29uc3QgYyA9IGxlbmd0aCAvIGNvdW50O1xyXG4gICAgaWYgKHN0cmlkZSAmJiBzdHJpZGUgIT09IGdldENvdW50KHR5cGUpICogYykge1xyXG4gICAgICAgIGxlbmd0aCA9IHN0cmlkZSAqIGNvdW50IC8gZ2V0Q291bnQodHlwZSkgLSBvZmZzZXQgLyBnZXRDb3VudCh0eXBlKTtcclxuICAgIH1cclxuICAgIGxldCBhcnI7XHJcbiAgICBzd2l0Y2ggKGdsRW51bVt0eXBlXSkge1xyXG4gICAgICAgIGNhc2UgJ0JZVEUnOlxyXG4gICAgICAgICAgICBhcnIgPSBuZXcgSW50OEFycmF5KGFycmF5QnVmZmVyLCBvZmZzZXQsIGxlbmd0aCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1VOU0lHTkVEX0JZVEUnOlxyXG4gICAgICAgICAgICBhcnIgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdTSE9SVCc6XHJcbiAgICAgICAgICAgIGFyciA9IG5ldyBJbnQxNkFycmF5KGFycmF5QnVmZmVyLCBvZmZzZXQsIGxlbmd0aCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1VOU0lHTkVEX1NIT1JUJzpcclxuICAgICAgICAgICAgYXJyID0gbmV3IFVpbnQxNkFycmF5KGFycmF5QnVmZmVyLCBvZmZzZXQsIGxlbmd0aCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1VOU0lHTkVEX0lOVCc6XHJcbiAgICAgICAgICAgIGFyciA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdGTE9BVCc6XHJcbiAgICAgICAgICAgIGFyciA9IG5ldyBGbG9hdDMyQXJyYXkoYXJyYXlCdWZmZXIsIG9mZnNldCwgbGVuZ3RoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBpZiAoc3RyaWRlICYmIHN0cmlkZSAhPT0gZ2V0Q291bnQodHlwZSkgKiBjKSB7XHJcbiAgICAgICAgY29uc3Qgc3RyaWRlZEFyciA9IG5ldyBGbG9hdDMyQXJyYXkobCk7XHJcbiAgICAgICAgbGV0IGogPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyaWRlZEFyci5sZW5ndGg7IGkgPSBpICsgYykge1xyXG4gICAgICAgICAgICBzdHJpZGVkQXJyW2ldID0gYXJyW2pdO1xyXG4gICAgICAgICAgICBzdHJpZGVkQXJyW2kgKyAxXSA9IGFycltqICsgMV07XHJcbiAgICAgICAgICAgIHN0cmlkZWRBcnJbaSArIDJdID0gYXJyW2ogKyAyXTtcclxuICAgICAgICAgICAgaiA9IGogKyBjICogKHN0cmlkZSAvIGdldENvdW50KHR5cGUpIC8gYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHJpZGVkQXJyO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxufVxyXG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZVNoYWRlcih0eXBlLCBzaGFkZXJTb3VyY2UsIHByb2dyYW0pIHtcclxuICAgIGNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcih0eXBlKTtcclxuICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIHNoYWRlclNvdXJjZSk7XHJcbiAgICBnbC5jb21waWxlU2hhZGVyKHNoYWRlcik7XHJcbiAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgc2hhZGVyKTtcclxuICAgIGNvbnN0IGxvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTtcclxuICAgIGlmIChsb2cpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGxvZyk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIHdhbGsobm9kZSwgY2FsbGJhY2spIHtcclxuICAgIGZ1bmN0aW9uIF93YWxrKG5vZGUpIHtcclxuICAgICAgICBjYWxsYmFjayhub2RlKTtcclxuICAgICAgICBpZiAobm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2goX3dhbGspO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIF93YWxrKG5vZGUpO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBzY2VuZVRvQXJjQmFsbChwb3MpIHtcclxuICAgIGxldCBsZW4gPSBwb3NbMF0gKiBwb3NbMF0gKyBwb3NbMV0gKiBwb3NbMV07XHJcbiAgICBjb25zdCBzeiA9IDAuMDQgKiAwLjA0IC0gbGVuO1xyXG4gICAgaWYgKHN6ID4gMCkge1xyXG4gICAgICAgIHJldHVybiBbcG9zWzBdLCBwb3NbMV0sIE1hdGguc3FydChzeildO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgbGVuID0gTWF0aC5zcXJ0KGxlbik7XHJcbiAgICAgICAgcmV0dXJuIFswLjA0ICogcG9zWzBdIC8gbGVuLCAwLjA0ICogcG9zWzFdIC8gbGVuLCAwXTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgZnVuY3Rpb24gY2FudmFzVG9Xb3JsZCh2ZWMyLCBwcm9qZWN0aW9uLCB3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICBjb25zdCBbeCwgeV0gPSB2ZWMyO1xyXG4gICAgY29uc3QgbmV3TSA9IG5ldyBNYXRyaXg0KCk7XHJcbiAgICBuZXdNLnNldFRyYW5zbGF0ZShuZXcgVmVjdG9yMyhbMCwgMCwgMC4wNV0pKTtcclxuICAgIGNvbnN0IG0gPSBuZXcgTWF0cml4NChwcm9qZWN0aW9uKTtcclxuICAgIG0ubXVsdGlwbHkobmV3TSk7XHJcbiAgICBjb25zdCBtcCA9IG0ubXVsdGlwbHlWZWN0b3I0KG5ldyBWZWN0b3I0KFswLCAwLCAwLCAxXSkpO1xyXG4gICAgbXAuZWxlbWVudHNbMF0gPSAoMiAqIHggLyB3aWR0aCAtIDEpICogbXAuZWxlbWVudHNbM107XHJcbiAgICBtcC5lbGVtZW50c1sxXSA9ICgtMiAqIHkgLyBoZWlnaHQgKyAxKSAqIG1wLmVsZW1lbnRzWzNdO1xyXG4gICAgY29uc3QgdiA9IG0uaW52ZXJ0KCkubXVsdGlwbHlWZWN0b3I0KG1wKTtcclxuICAgIHJldHVybiBbdi5lbGVtZW50c1swXSwgdi5lbGVtZW50c1sxXV07XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVByb2plY3Rpb24oY2FtLCBhc3BlY3QsIHpvb20pIHtcclxuICAgIGxldCBwcm9qO1xyXG4gICAgaWYgKGNhbS50eXBlID09PSAncGVyc3BlY3RpdmUnICYmIGNhbS5wZXJzcGVjdGl2ZSkge1xyXG4gICAgICAgIGNvbnN0IHsgeWZvdiB9ID0gY2FtLnBlcnNwZWN0aXZlO1xyXG4gICAgICAgIGNvbnN0IHhmb3YgPSB5Zm92ICogYXNwZWN0O1xyXG4gICAgICAgIHByb2ogPSBuZXcgTWF0cml4NCgpLnNldFBlcnNwZWN0aXZlKHhmb3YgKiB6b29tICogKDE4MCAvIE1hdGguUEkpLCBhc3BlY3QsIGNhbS5wZXJzcGVjdGl2ZS56bmVhciB8fCAxLCBjYW0ucGVyc3BlY3RpdmUuemZhciB8fCAyZTYpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoY2FtLnR5cGUgPT09ICdvcnRob2dyYXBoaWMnICYmIGNhbS5vcnRob2dyYXBoaWMpIHtcclxuICAgICAgICBwcm9qID0gbmV3IE1hdHJpeDQoKS5zZXRPcnRobyhjYW0ub3J0aG9ncmFwaGljLnhtYWcsIGNhbS5vcnRob2dyYXBoaWMueW1hZywgY2FtLm9ydGhvZ3JhcGhpYy56bmVhciwgY2FtLm9ydGhvZ3JhcGhpYy56ZmFyKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwcm9qO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVPZmZzZXQoYSA9IDAsIGIgPSAwKSB7XHJcbiAgICByZXR1cm4gYSArIGI7XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEF0dHJpYnV0ZUluZGV4KG5hbWUpIHtcclxuICAgIGxldCBpbmRleDtcclxuICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgIGNhc2UgJ1BPU0lUSU9OJzpcclxuICAgICAgICAgICAgaW5kZXggPSBbMCwgMywgZ2wuRkxPQVRdO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdOT1JNQUwnOlxyXG4gICAgICAgICAgICBpbmRleCA9IFsxLCAzLCBnbC5GTE9BVF07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1RFWENPT1JEXzAnOlxyXG4gICAgICAgICAgICBpbmRleCA9IFsyLCAyLCBnbC5GTE9BVF07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0pPSU5UU18wJzpcclxuICAgICAgICAgICAgaW5kZXggPSBbMywgNCwgZ2wuVU5TSUdORURfU0hPUlRdO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdXRUlHSFRTXzAnOlxyXG4gICAgICAgICAgICBpbmRleCA9IFs0LCA0LCBnbC5GTE9BVF07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1RBTkdFTlQnOlxyXG4gICAgICAgICAgICBpbmRleCA9IFs1LCA0LCBnbC5GTE9BVF07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGluZGV4O1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVCaW5vcm1hbHMoaW5kZXgsIHZlcnRleCwgbm9ybWFsLCB1dikge1xyXG4gICAgY29uc3QgdGFuZ2VudCA9IG5ldyBGbG9hdDMyQXJyYXkobm9ybWFsLmxlbmd0aCAvIDMgKiA0KTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXgubGVuZ3RoOyBpICs9IDMpIHtcclxuICAgICAgICBjb25zdCBmYWNlSW5kZXhlcyA9IFtpbmRleFtpXSwgaW5kZXhbaSArIDFdLCBpbmRleFtpICsgMl1dO1xyXG4gICAgICAgIGNvbnN0IGZhY2VWZXJ0aWNlcyA9IGZhY2VJbmRleGVzLm1hcChpeCA9PiB2ZWN0b3JGcm9tQXJyYXkodmVydGV4LCBpeCkpO1xyXG4gICAgICAgIGNvbnN0IGZhY2VVVnMgPSBmYWNlSW5kZXhlcy5tYXAoaXggPT4gdmVjdG9yRnJvbUFycmF5KHV2LCBpeCwgMikpO1xyXG4gICAgICAgIGNvbnN0IGR2MSA9IGZhY2VWZXJ0aWNlc1sxXS5zdWJ0cmFjdChmYWNlVmVydGljZXNbMF0pO1xyXG4gICAgICAgIGNvbnN0IGR2MiA9IGZhY2VWZXJ0aWNlc1syXS5zdWJ0cmFjdChmYWNlVmVydGljZXNbMF0pO1xyXG4gICAgICAgIGNvbnN0IGR1djEgPSBmYWNlVVZzWzFdLnN1YnRyYWN0KGZhY2VVVnNbMF0pO1xyXG4gICAgICAgIGNvbnN0IGR1djIgPSBmYWNlVVZzWzJdLnN1YnRyYWN0KGZhY2VVVnNbMF0pO1xyXG4gICAgICAgIGxldCByID0gKGR1djEuZWxlbWVudHNbMF0gKiBkdXYyLmVsZW1lbnRzWzFdIC0gZHV2MS5lbGVtZW50c1sxXSAqIGR1djIuZWxlbWVudHNbMF0pO1xyXG4gICAgICAgIHIgPSAociAhPT0gMCkgPyAxLjAgLyByIDogMS4wO1xyXG4gICAgICAgIGNvbnN0IHVkaXIgPSBuZXcgVmVjdG9yMyhbXHJcbiAgICAgICAgICAgIChkdXYyLmVsZW1lbnRzWzFdICogZHYxLmVsZW1lbnRzWzBdIC0gZHV2MS5lbGVtZW50c1sxXSAqIGR2Mi5lbGVtZW50c1swXSkgKiByLFxyXG4gICAgICAgICAgICAoZHV2Mi5lbGVtZW50c1sxXSAqIGR2MS5lbGVtZW50c1sxXSAtIGR1djEuZWxlbWVudHNbMV0gKiBkdjIuZWxlbWVudHNbMV0pICogcixcclxuICAgICAgICAgICAgKGR1djIuZWxlbWVudHNbMV0gKiBkdjEuZWxlbWVudHNbMl0gLSBkdXYxLmVsZW1lbnRzWzFdICogZHYyLmVsZW1lbnRzWzJdKSAqIHJcclxuICAgICAgICBdKTtcclxuICAgICAgICB1ZGlyLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgIGZhY2VJbmRleGVzLmZvckVhY2goaXggPT4ge1xyXG4gICAgICAgICAgICBhY2N1bXVsYXRlVmVjdG9ySW5BcnJheSh0YW5nZW50LCBpeCwgdWRpcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGFuZ2VudDtcclxuICAgIGZ1bmN0aW9uIHZlY3RvckZyb21BcnJheShhcnJheSwgaW5kZXgsIGVsZW1lbnRzID0gMykge1xyXG4gICAgICAgIGluZGV4ID0gaW5kZXggKiBlbGVtZW50cztcclxuICAgICAgICBpZiAoZWxlbWVudHMgPT09IDMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IzKFthcnJheVtpbmRleF0sIGFycmF5W2luZGV4ICsgMV0sIGFycmF5W2luZGV4ICsgMl1dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGVsZW1lbnRzID09PSAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMihbYXJyYXlbaW5kZXhdLCBhcnJheVtpbmRleCArIDFdXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gYWNjdW11bGF0ZVZlY3RvckluQXJyYXkoYXJyYXksIGluZGV4LCB2ZWN0b3IsIGVsZW1lbnRzID0gNCwgYWNjdW11bGF0b3IgPSAoYWNjLCB4KSA9PiBhY2MgKyB4KSB7XHJcbiAgICAgICAgaW5kZXggPSBpbmRleCAqIGVsZW1lbnRzO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHM7ICsraSkge1xyXG4gICAgICAgICAgICBpZiAoaSA9PT0gMykge1xyXG4gICAgICAgICAgICAgICAgYXJyYXlbaW5kZXggKyBpXSA9IC0xO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXJyYXlbaW5kZXggKyBpXSA9IGFjY3VtdWxhdG9yKGFycmF5W2luZGV4ICsgaV0sIHZlY3Rvci5lbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/utils.ts\n");

/***/ })

/******/ });
});